var fabric=fabric||{version:"1.7.12"};"undefined"!==typeof exports&&(exports.fabric=fabric),"undefined"!==typeof document&&"undefined"!==typeof window?(fabric.document=document,fabric.window=window,window.fabric=fabric):(fabric.document=require("jsdom").jsdom(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E")),fabric.window=fabric.document.createWindow?fabric.document.createWindow():fabric.document.parentWindow),fabric.isTouchSupported="ontouchstart"in fabric.document.documentElement,fabric.isLikelyNode="undefined"!==typeof Buffer&&"undefined"===typeof window,fabric.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id"],fabric.DPI=96,fabric.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)",fabric.fontPaths={},fabric.iMatrix=[1,0,0,1,0,0],fabric.charWidthsCache={},fabric.devicePixelRatio=fabric.window.devicePixelRatio||fabric.window.webkitDevicePixelRatio||fabric.window.mozDevicePixelRatio||1,function(){function a(a,b){if(this.__eventListeners[a]){var c=this.__eventListeners[a];b?c[c.indexOf(b)]=!1:fabric.util.array.fill(c,!1)}}function b(a,b){if(this.__eventListeners||(this.__eventListeners={}),1===arguments.length)for(var c in a)this.on(c,a[c]);else this.__eventListeners[a]||(this.__eventListeners[a]=[]),this.__eventListeners[a].push(b);return this}function c(b,c){if(this.__eventListeners){if(0===arguments.length)for(b in this.__eventListeners)a.call(this,b);else if(1===arguments.length&&"object"===typeof arguments[0])for(var d in b)a.call(this,d,b[d]);else a.call(this,b,c);return this}}function d(a,b){if(this.__eventListeners){var c=this.__eventListeners[a];if(c){for(var d=0,e=c.length;d<e;d++)c[d]&&c[d].call(this,b||{});return this.__eventListeners[a]=c.filter(function(a){return a!==!1}),this}}}fabric.Observable={observe:b,stopObserving:c,fire:d,on:b,off:c,trigger:d}}(),fabric.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var a=0,b=arguments.length;a<b;a++)this._onObjectAdded(arguments[a]);return this.renderOnAddRemove&&this.renderAll(),this},insertAt:function(a,b,c){var d=this.getObjects();return c?d[b]=a:d.splice(b,0,a),this._onObjectAdded&&this._onObjectAdded(a),this.renderOnAddRemove&&this.renderAll(),this},remove:function(){for(var b,a=this.getObjects(),c=!1,d=0,e=arguments.length;d<e;d++)b=a.indexOf(arguments[d]),-1!==b&&(c=!0,a.splice(b,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[d]));return this.renderOnAddRemove&&c&&this.renderAll(),this},forEachObject:function(a,b){for(var c=this.getObjects(),d=0,e=c.length;d<e;d++)a.call(b,c[d],d,c);return this},getObjects:function(a){return"undefined"===typeof a?this._objects:this._objects.filter(function(b){return b.type===a})},item:function(a){return this.getObjects()[a]},isEmpty:function(){return 0===this.getObjects().length},size:function(){return this.getObjects().length},contains:function(a){return this.getObjects().indexOf(a)>-1},complexity:function(){return this.getObjects().reduce(function(a,b){return a+=b.complexity?b.complexity():0},0)}},fabric.CommonMethods={_setOptions:function(a){for(var b in a)this.set(b,a[b])},_initGradient:function(a,b){!a||!a.colorStops||a instanceof fabric.Gradient||this.set(b,new fabric.Gradient(a))},_initPattern:function(a,b,c){!a||!a.source||a instanceof fabric.Pattern?c&&c():this.set(b,new fabric.Pattern(a,c))},_initClipping:function(a){if(a.clipTo&&"string"===typeof a.clipTo){var b=fabric.util.getFunctionBody(a.clipTo);"undefined"!==typeof b&&(this.clipTo=new Function("ctx",b))}},_setObject:function(a){for(var b in a)this._set(b,a[b])},set:function(a,b){return"object"===typeof a?this._setObject(a):"function"===typeof b&&"clipTo"!==a?this._set(a,b(this.get(a))):this._set(a,b),this},_set:function(a,b){this[a]=b},toggle:function(a){var b=this.get(a);return"boolean"===typeof b&&this.set(a,!b),this},get:function(a){return this[a]}},function(a){var b=Math.sqrt,c=Math.atan2,d=Math.pow,e=Math.abs,f=Math.PI/180;fabric.util={removeFromArray:function(a,b){var c=a.indexOf(b);return-1!==c&&a.splice(c,1),a},getRandomInt:function(a,b){return Math.floor(Math.random()*(b-a+1))+a},degreesToRadians:function(a){return a*f},radiansToDegrees:function(a){return a/f},rotatePoint:function(a,b,c){a.subtractEquals(b);var d=fabric.util.rotateVector(a,c);return new fabric.Point(d.x,d.y).addEquals(b)},rotateVector:function(a,b){var c=Math.sin(b),d=Math.cos(b),e=a.x*d-a.y*c,f=a.x*c+a.y*d;return{x:e,y:f}},transformPoint:function(a,b,c){return c?new fabric.Point(b[0]*a.x+b[2]*a.y,b[1]*a.x+b[3]*a.y):new fabric.Point(b[0]*a.x+b[2]*a.y+b[4],b[1]*a.x+b[3]*a.y+b[5])},makeBoundingBoxFromPoints:function(a){var b=[a[0].x,a[1].x,a[2].x,a[3].x],c=fabric.util.array.min(b),d=fabric.util.array.max(b),e=Math.abs(c-d),f=[a[0].y,a[1].y,a[2].y,a[3].y],g=fabric.util.array.min(f),h=fabric.util.array.max(f),i=Math.abs(g-h);return{left:c,top:g,width:e,height:i}},invertTransform:function(a){var b=1/(a[0]*a[3]-a[1]*a[2]),c=[b*a[3],-b*a[1],-b*a[2],b*a[0]],d=fabric.util.transformPoint({x:a[4],y:a[5]},c,!0);return c[4]=-d.x,c[5]=-d.y,c},toFixed:function(a,b){return parseFloat(Number(a).toFixed(b))},parseUnit:function(a,b){var c=/\D{0,2}$/.exec(a),d=parseFloat(a);switch(b||(b=fabric.Text.DEFAULT_SVG_FONT_SIZE),c[0]){case"mm":return d*fabric.DPI/25.4;case"cm":return d*fabric.DPI/2.54;case"in":return d*fabric.DPI;case"pt":return d*fabric.DPI/72;case"pc":return d*fabric.DPI/72*12;case"em":return d*b;default:return d}},falseFunction:function(){return!1},getKlass:function(a,b){return a=fabric.util.string.camelize(a.charAt(0).toUpperCase()+a.slice(1)),fabric.util.resolveNamespace(b)[a]},resolveNamespace:function(b){if(!b)return fabric;var e,c=b.split("."),d=c.length,f=a||fabric.window;for(e=0;e<d;++e)f=f[c[e]];return f},loadImage:function(a,b,c,d){if(!a)return void(b&&b.call(c,a));var e=fabric.util.createImage();e.onload=function(){b&&b.call(c,e),e=e.onload=e.onerror=null},e.onerror=function(){fabric.log("Error loading "+e.src),b&&b.call(c,null,!0),e=e.onload=e.onerror=null},0!==a.indexOf("data")&&d&&(e.crossOrigin=d),e.src=a},enlivenObjects:function(a,b,c,d){function e(){++g===h&&b&&b(f)}a=a||[];var f=[],g=0,h=a.length,i=!0;return h?void a.forEach(function(a,b){if(!a||!a.type)return void e();var g=fabric.util.getKlass(a.type,c);g.fromObject(a,function(c,g){g||(f[b]=c),d&&d(a,c,g),e()},i)}):void(b&&b(f))},enlivenPatterns:function(a,b){function c(){++e===f&&b&&b(d)}a=a||[];var d=[],e=0,f=a.length;return f?void a.forEach(function(a,b){a&&a.source?new fabric.Pattern(a,function(a){d[b]=a,c()}):(d[b]=a,c())}):void(b&&b(d))},groupSVGElements:function(a,b,c){var d;return d=new fabric.PathGroup(a,b),"undefined"!==typeof c&&(d.sourcePath=c),d},populateWithProperties:function(a,b,c){if(c&&"[object Array]"===Object.prototype.toString.call(c))for(var d=0,e=c.length;d<e;d++)c[d]in a&&(b[c[d]]=a[c[d]])},drawDashedLine:function(a,d,e,f,g,h){var i=f-d,j=g-e,k=b(i*i+j*j),l=c(j,i),m=h.length,n=0,o=!0;for(a.save(),a.translate(d,e),a.moveTo(0,0),a.rotate(l),d=0;k>d;)d+=h[n++%m],d>k&&(d=k),a[o?"lineTo":"moveTo"](d,0),o=!o;a.restore()},createCanvasElement:function(a){return a||(a=fabric.document.createElement("canvas")),a.getContext||"undefined"===typeof G_vmlCanvasManager||G_vmlCanvasManager.initElement(a),a},createImage:function(){return fabric.isLikelyNode?new(require("canvas").Image):fabric.document.createElement("img")},createAccessors:function(a){var c,d,e,f,g,b=a.prototype;for(c=b.stateProperties.length;c--;)d=b.stateProperties[c],e=d.charAt(0).toUpperCase()+d.slice(1),f="set"+e,g="get"+e,b[g]||(b[g]=function(a){return new Function('return this.get("'+a+'")')}(d)),b[f]||(b[f]=function(a){return new Function("value",'return this.set("'+a+'", value)')}(d))},clipContext:function(a,b){b.save(),b.beginPath(),a.clipTo(b),b.clip()},multiplyTransformMatrices:function(a,b,c){return[a[0]*b[0]+a[2]*b[1],a[1]*b[0]+a[3]*b[1],a[0]*b[2]+a[2]*b[3],a[1]*b[2]+a[3]*b[3],c?0:a[0]*b[4]+a[2]*b[5]+a[4],c?0:a[1]*b[4]+a[3]*b[5]+a[5]]},qrDecompose:function(a){var e=c(a[1],a[0]),g=d(a[0],2)+d(a[1],2),h=b(g),i=(a[0]*a[3]-a[2]*a[1])/h,j=c(a[0]*a[2]+a[1]*a[3],g);return{angle:e/f,scaleX:h,scaleY:i,skewX:j/f,skewY:0,translateX:a[4],translateY:a[5]}},customTransformMatrix:function(a,b,c){var d=[1,0,e(Math.tan(c*f)),1],g=[e(a),0,0,e(b)];return fabric.util.multiplyTransformMatrices(g,d,!0)},resetObjectTransform:function(a){a.scaleX=1,a.scaleY=1,a.skewX=0,a.skewY=0,a.flipX=!1,a.flipY=!1,a.setAngle(0)},getFunctionBody:function(a){return(String(a).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},isTransparent:function(a,b,c,d){d>0&&(b>d?b-=d:b=0,c>d?c-=d:c=0);var f,g,e=!0,h=a.getImageData(b,c,2*d||1,2*d||1),i=h.data.length;for(f=3;f<i&&(g=h.data[f],e=g<=0,e!==!1);f+=4);return h=null,e},parsePreserveAspectRatioAttribute:function(a){var f,b="meet",c="Mid",d="Mid",e=a.split(" ");return e&&e.length&&(b=e.pop(),"meet"!==b&&"slice"!==b?(f=b,b="meet"):e.length&&(f=e.pop())),c="none"!==f?f.slice(1,4):"none",d="none"!==f?f.slice(5,8):"none",{meetOrSlice:b,alignX:c,alignY:d}},clearFabricFontCache:function(a){a?fabric.charWidthsCache[a]&&delete fabric.charWidthsCache[a]:fabric.charWidthsCache={}}}}("undefined"!==typeof exports?exports:this),function(){function e(b,c,e,h,i,j,k){var l=d.call(arguments);if(a[l])return a[l];var m=Math.PI,n=k*m/180,o=Math.sin(n),p=Math.cos(n),q=0,r=0;e=Math.abs(e),h=Math.abs(h);var s=-p*b*.5-o*c*.5,t=-p*c*.5+o*b*.5,u=e*e,v=h*h,w=t*t,x=s*s,y=u*v-u*w-v*x,z=0;if(y<0){var A=Math.sqrt(1-y/(u*v));e*=A,h*=A}else z=(i===j?-1:1)*Math.sqrt(y/(u*w+v*x));var B=z*e*t/h,C=-z*h*s/e,D=p*B-o*C+.5*b,E=o*B+p*C+.5*c,F=g(1,0,(s-B)/e,(t-C)/h),G=g((s-B)/e,(t-C)/h,(-s-B)/e,(-t-C)/h);0===j&&G>0?G-=2*m:1===j&&G<0&&(G+=2*m);for(var H=Math.ceil(Math.abs(G/m*2)),I=[],J=G/H,K=8/3*Math.sin(J/4)*Math.sin(J/4)/Math.sin(J/2),L=F+J,M=0;M<H;M++)I[M]=f(F,L,p,o,e,h,D,E,K,q,r),q=I[M][4],r=I[M][5],F=L,L+=J;return a[l]=I,I}function f(a,c,e,f,g,h,i,j,k,l,m){var n=d.call(arguments);if(b[n])return b[n];var o=Math.cos(a),p=Math.sin(a),q=Math.cos(c),r=Math.sin(c),s=e*g*q-f*h*r+i,t=f*g*q+e*h*r+j,u=l+k*(-e*g*p-f*h*o),v=m+k*(-f*g*p+e*h*o),w=s+k*(e*g*r+f*h*q),x=t+k*(f*g*r-e*h*q);return b[n]=[u,v,w,x,s,t],b[n]}function g(a,b,c,d){var e=Math.atan2(b,a),f=Math.atan2(d,c);return f>=e?f-e:2*Math.PI-(e-f)}function h(a,b,e,f,g,h,i,j){var k=d.call(arguments);if(c[k])return c[k];var r,s,t,u,v,w,x,y,l=Math.sqrt,m=Math.min,n=Math.max,o=Math.abs,p=[],q=[[],[]];s=6*a-12*e+6*g,r=-3*a+9*e-9*g+3*i,t=3*e-3*a;for(var z=0;z<2;++z)if(z>0&&(s=6*b-12*f+6*h,r=-3*b+9*f-9*h+3*j,t=3*f-3*b),o(r)<1e-12){if(o(s)<1e-12)continue;u=-t/s,0<u&&u<1&&p.push(u)}else x=s*s-4*t*r,x<0||(y=l(x),v=(-s+y)/(2*r),0<v&&v<1&&p.push(v),w=(-s-y)/(2*r),0<w&&w<1&&p.push(w));for(var A,B,E,C=p.length,D=C;C--;)u=p[C],E=1-u,A=E*E*E*a+3*E*E*u*e+3*E*u*u*g+u*u*u*i,q[0][C]=A,B=E*E*E*b+3*E*E*u*f+3*E*u*u*h+u*u*u*j,q[1][C]=B;q[0][D]=a,q[1][D]=b,q[0][D+1]=i,q[1][D+1]=j;var F=[{x:m.apply(null,q[0]),y:m.apply(null,q[1])},{x:n.apply(null,q[0]),y:n.apply(null,q[1])}];return c[k]=F,F}var a={},b={},c={},d=Array.prototype.join;fabric.util.drawArc=function(a,b,c,d){for(var f=d[0],g=d[1],h=d[2],i=d[3],j=d[4],k=d[5],l=d[6],m=[[],[],[],[]],n=e(k-b,l-c,f,g,i,j,h),o=0,p=n.length;o<p;o++)m[o][0]=n[o][0]+b,m[o][1]=n[o][1]+c,m[o][2]=n[o][2]+b,m[o][3]=n[o][3]+c,m[o][4]=n[o][4]+b,m[o][5]=n[o][5]+c,a.bezierCurveTo.apply(a,m[o])},fabric.util.getBoundsOfArc=function(a,b,c,d,f,g,i,j,k){for(var n,l=0,m=0,o=[],p=e(j-a,k-b,c,d,g,i,f),q=0,r=p.length;q<r;q++)n=h(l,m,p[q][0],p[q][1],p[q][2],p[q][3],p[q][4],p[q][5]),o.push({x:n[0].x+a,y:n[0].y+b}),o.push({x:n[1].x+a,y:n[1].y+b}),l=p[q][4],m=p[q][5];return o},fabric.util.getBoundsOfCurve=h}(),function(){function b(b,c){for(var d=a.call(arguments,2),e=[],f=0,g=b.length;f<g;f++)e[f]=d.length?b[f][c].apply(b[f],d):b[f][c].call(b[f]);return e}function c(a,b){return f(a,b,function(a,b){return a>=b})}function d(a,b){return f(a,b,function(a,b){return a<b})}function e(a,b){for(var c=a.length;c--;)a[c]=b;return a}function f(a,b,c){if(a&&0!==a.length){var d=a.length-1,e=b?a[d][b]:a[d];if(b)for(;d--;)c(a[d][b],e)&&(e=a[d][b]);else for(;d--;)c(a[d],e)&&(e=a[d]);return e}}var a=Array.prototype.slice;Array.prototype.indexOf||(Array.prototype.indexOf=function(a){if(void 0===this||null===this)throw new TypeError;var b=Object(this),c=b.length>>>0;if(0===c)return-1;var d=0;if(arguments.length>0&&(d=Number(arguments[1]),d!==d?d=0:0!==d&&d!==Number.POSITIVE_INFINITY&&d!==Number.NEGATIVE_INFINITY&&(d=(d>0||-1)*Math.floor(Math.abs(d)))),d>=c)return-1;for(var e=d>=0?d:Math.max(c-Math.abs(d),0);e<c;e++)if(e in b&&b[e]===a)return e;return-1}),Array.prototype.forEach||(Array.prototype.forEach=function(a,b){for(var c=0,d=this.length>>>0;c<d;c++)c in this&&a.call(b,this[c],c,this)}),Array.prototype.map||(Array.prototype.map=function(a,b){for(var c=[],d=0,e=this.length>>>0;d<e;d++)d in this&&(c[d]=a.call(b,this[d],d,this));return c}),Array.prototype.every||(Array.prototype.every=function(a,b){for(var c=0,d=this.length>>>0;c<d;c++)if(c in this&&!a.call(b,this[c],c,this))return!1;return!0}),Array.prototype.some||(Array.prototype.some=function(a,b){for(var c=0,d=this.length>>>0;c<d;c++)if(c in this&&a.call(b,this[c],c,this))return!0;return!1}),Array.prototype.filter||(Array.prototype.filter=function(a,b){for(var d,c=[],e=0,f=this.length>>>0;e<f;e++)e in this&&(d=this[e],a.call(b,d,e,this)&&c.push(d));return c}),Array.prototype.reduce||(Array.prototype.reduce=function(a){var d,b=this.length>>>0,c=0;if(arguments.length>1)d=arguments[1];else for(;;){if(c in this){d=this[c++];break}if(++c>=b)throw new TypeError}for(;c<b;c++)c in this&&(d=a.call(null,d,this[c],c,this));return d}),fabric.util.array={fill:e,invoke:b,min:d,max:c}}(),function(){function a(b,c,d){if(d)if(!fabric.isLikelyNode&&c instanceof Element)b=c;else if(c instanceof Array){b=[];for(var e=0,f=c.length;e<f;e++)b[e]=a({},c[e],d)}else if(c&&"object"===typeof c)for(var g in c)c.hasOwnProperty(g)&&(b[g]=a({},c[g],d));else b=c;else for(var g in c)b[g]=c[g];return b}function b(b,c){return a({},b,c)}fabric.util.object={extend:a,clone:b}}(),function(){function a(a){return a.replace(/-+(.)?/g,function(a,b){return b?b.toUpperCase():""})}function b(a,b){return a.charAt(0).toUpperCase()+(b?a.slice(1):a.slice(1).toLowerCase())}function c(a){return a.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")}),fabric.util.string={camelize:a,capitalize:b,escapeXml:c}}(),function(){var a=Array.prototype.slice,b=Function.prototype.apply,c=function(){};Function.prototype.bind||(Function.prototype.bind=function(d){var g,e=this,f=a.call(arguments,1);return g=f.length?function(){return b.call(e,this instanceof c?this:d,f.concat(a.call(arguments)))}:function(){return b.call(e,this instanceof c?this:d,arguments)},c.prototype=this.prototype,g.prototype=new c,g})}(),function(){function e(){}function f(b){for(var c=null,d=this;d.constructor.superclass;){var e=d.constructor.superclass.prototype[b];if(d[b]!==e){c=e;break}d=d.constructor.superclass.prototype}return c?arguments.length>1?c.apply(this,a.call(arguments,1)):c.call(this):console.log("tried to callSuper "+b+", method not found in prototype chain",this)}function g(){function h(){this.initialize.apply(this,arguments)}var c=null,g=a.call(arguments,0);"function"===typeof g[0]&&(c=g.shift()),h.superclass=c,h.subclasses=[],c&&(e.prototype=c.prototype,h.prototype=new e,c.subclasses.push(h));for(var i=0,j=g.length;i<j;i++)d(h,g[i],c);return h.prototype.initialize||(h.prototype.initialize=b),h.prototype.constructor=h,h.prototype.callSuper=f,h}var a=Array.prototype.slice,b=function(){},c=function(){for(var a in{toString:1})if("toString"===a)return!1;return!0}(),d=function(a,b,d){for(var e in b)a.prototype[e]=e in a.prototype&&"function"===typeof a.prototype[e]&&(b[e]+"").indexOf("callSuper")>-1?function(a){return function(){var c=this.constructor.superclass;this.constructor.superclass=d;var e=b[a].apply(this,arguments);return this.constructor.superclass=c,"initialize"!==a?e:void 0}}(e):b[e],c&&(b.toString!==Object.prototype.toString&&(a.prototype.toString=b.toString),b.valueOf!==Object.prototype.valueOf&&(a.prototype.valueOf=b.valueOf))};fabric.util.createClass=g}(),function(){function b(a){var c,d,b=Array.prototype.slice.call(arguments,1),e=b.length;for(d=0;d<e;d++)if(c=typeof a[b[d]],!/^(?:function|object|unknown)$/.test(c))return!1;return!0}function f(a,b){return{handler:b,wrappedHandler:g(a,b)}}function g(a,b){return function(d){b.call(c(a),d||fabric.window.event)}}function h(a,b){return function(c){if(l[a]&&l[a][b])for(var d=l[a][b],e=0,f=d.length;e<f;e++)d[e].call(this,c||fabric.window.event)}}function o(b){b||(b=fabric.window.event);var c=b.target||(typeof b.srcElement!==a?b.srcElement:null),d=fabric.util.getScrollLeftTop(c);return{x:p(b)+d.left,y:q(b)+d.top}}function r(a,b,c){var d="touchend"===a.type?"changedTouches":"touches";return a[d]&&a[d][0]?a[d][0][b]-(a[d][0][b]-a[d][0][c])||a[c]:a[c]}var c,d,a="unknown",e=function(){var a=0;return function(b){return b.__uniqueID||(b.__uniqueID="uniqueID__"+a++)}}();!function(){var a={};c=function(b){return a[b]},d=function(b,c){a[b]=c}}();var m,n,i=b(fabric.document.documentElement,"addEventListener","removeEventListener")&&b(fabric.window,"addEventListener","removeEventListener"),j=b(fabric.document.documentElement,"attachEvent","detachEvent")&&b(fabric.window,"attachEvent","detachEvent"),k={},l={};i?(m=function(a,b,c,d){a.addEventListener(b,c,j?!1:d)},n=function(a,b,c,d){a.removeEventListener(b,c,j?!1:d)}):j?(m=function(a,b,c){var g=e(a);d(g,a),k[g]||(k[g]={}),k[g][b]||(k[g][b]=[]);var h=f(g,c);k[g][b].push(h),a.attachEvent("on"+b,h.wrappedHandler)},n=function(a,b,c){var f,d=e(a);if(k[d]&&k[d][b])for(var g=0,h=k[d][b].length;g<h;g++)f=k[d][b][g],f&&f.handler===c&&(a.detachEvent("on"+b,f.wrappedHandler),k[d][b][g]=null)}):(m=function(a,b,c){var d=e(a);if(l[d]||(l[d]={}),!l[d][b]){l[d][b]=[];var f=a["on"+b];f&&l[d][b].push(f),a["on"+b]=h(d,b)}l[d][b].push(c)},n=function(a,b,c){var d=e(a);if(l[d]&&l[d][b])for(var f=l[d][b],g=0,h=f.length;g<h;g++)f[g]===c&&f.splice(g,1)}),fabric.util.addListener=m,fabric.util.removeListener=n;var p=function(b){return typeof b.clientX!==a?b.clientX:0},q=function(b){return typeof b.clientY!==a?b.clientY:0};fabric.isTouchSupported&&(p=function(a){return r(a,"pageX","clientX")},q=function(a){return r(a,"pageY","clientY")}),fabric.util.getPointer=o,fabric.util.object.extend(fabric.util,fabric.Observable)}(),function(){function a(a,b){var c=a.style;if(!c)return a;if("string"===typeof b)return a.style.cssText+=";"+b,b.indexOf("opacity")>-1?f(a,b.match(/opacity:\s*(\d?\.?\d*)/)[1]):a;for(var d in b)if("opacity"===d)f(a,b[d]);else{var e="float"===d||"cssFloat"===d?"undefined"===typeof c.styleFloat?"cssFloat":"styleFloat":d;c[e]=b[d]}return a}var b=fabric.document.createElement("div"),c="string"===typeof b.style.opacity,d="string"===typeof b.style.filter,e=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,f=function(a){return a};c?f=function(a,b){return a.style.opacity=b,a}:d&&(f=function(a,b){var c=a.style;return a.currentStyle&&!a.currentStyle.hasLayout&&(c.zoom=1),e.test(c.filter)?(b=b>=.9999?"":"alpha(opacity="+100*b+")",c.filter=c.filter.replace(e,b)):c.filter+=" alpha(opacity="+100*b+")",a}),fabric.util.setStyle=a}(),function(){function b(a){return"string"===typeof a?fabric.document.getElementById(a):a}function f(a,b){var c=fabric.document.createElement(a);for(var d in b)"class"===d?c.className=b[d]:"for"===d?c.htmlFor=b[d]:c.setAttribute(d,b[d]);return c}function g(a,b){a&&-1===(" "+a.className+" ").indexOf(" "+b+" ")&&(a.className+=(a.className?" ":"")+b)}function h(a,b,c){return"string"===typeof b&&(b=f(b,c)),a.parentNode&&a.parentNode.replaceChild(b,a),b.appendChild(a),b}function i(a){for(var b=0,c=0,d=fabric.document.documentElement,e=fabric.document.body||{scrollLeft:0,scrollTop:0};a&&(a.parentNode||a.host)&&(a=a.parentNode||a.host,a===fabric.document?(b=e.scrollLeft||d.scrollLeft||0,c=e.scrollTop||d.scrollTop||0):(b+=a.scrollLeft||0,c+=a.scrollTop||0),1!==a.nodeType||"fixed"!==fabric.util.getElementStyle(a,"position")););return{left:b,top:c}}function j(a){var b,f,c=a&&a.ownerDocument,d={left:0,top:0},e={left:0,top:0},g={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!c)return e;for(var h in g)e[g[h]]+=parseInt(k(a,h),10)||0;return b=c.documentElement,"undefined"!==typeof a.getBoundingClientRect&&(d=a.getBoundingClientRect()),f=i(a),{left:d.left+f.left-(b.clientLeft||0)+e.left,top:d.top+f.top-(b.clientTop||0)+e.top}}var c,a=Array.prototype.slice,d=function(b){return a.call(b,0)};try{c=d(fabric.document.childNodes)instanceof Array}catch(e){}c||(d=function(a){for(var b=new Array(a.length),c=a.length;c--;)b[c]=a[c];return b});var k;k=fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle?function(a,b){var c=fabric.document.defaultView.getComputedStyle(a,null);return c?c[b]:void 0}:function(a,b){var c=a.style[b];return!c&&a.currentStyle&&(c=a.currentStyle[b]),c},function(){function c(a){return"undefined"!==typeof a.onselectstart&&(a.onselectstart=fabric.util.falseFunction),b?a.style[b]="none":"string"===typeof a.unselectable&&(a.unselectable="on"),a}function d(a){return"undefined"!==typeof a.onselectstart&&(a.onselectstart=null),b?a.style[b]="":"string"===typeof a.unselectable&&(a.unselectable=""),a}var a=fabric.document.documentElement.style,b="userSelect"in a?"userSelect":"MozUserSelect"in a?"MozUserSelect":"WebkitUserSelect"in a?"WebkitUserSelect":"KhtmlUserSelect"in a?"KhtmlUserSelect":"";fabric.util.makeElementUnselectable=c,fabric.util.makeElementSelectable=d}(),function(){function a(a,b){var c=fabric.document.getElementsByTagName("head")[0],d=fabric.document.createElement("script"),e=!0;d.onload=d.onreadystatechange=function(a){if(e){if("string"===typeof this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState)return;e=!1,b(a||fabric.window.event),d=d.onload=d.onreadystatechange=null}},d.src=a,c.appendChild(d)}fabric.util.getScript=a}(),fabric.util.getById=b,fabric.util.toArray=d,fabric.util.makeElement=f,fabric.util.addClass=g,fabric.util.wrapElement=h,fabric.util.getScrollLeftTop=i,fabric.util.getElementOffset=j,fabric.util.getElementStyle=k}(),function(){function a(a,b){return a+(/\?/.test(a)?"&":"?")+b}function c(){}function d(d,e){e||(e={});var f=e.method?e.method.toUpperCase():"GET",g=e.onComplete||function(){},h=b(),i=e.body||e.parameters;return h.onreadystatechange=function(){4===h.readyState&&(g(h),h.onreadystatechange=c)},"GET"===f&&(i=null,"string"===typeof e.parameters&&(d=a(d,e.parameters))),h.open(f,d,!0),("POST"===f||"PUT"===f)&&h.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),h.send(i),h}var b=function(){for(var a=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest}],b=a.length;b--;)try{var c=a[b]();if(c)return a[b]}catch(d){}}();fabric.util.request=d}(),fabric.log=function(){},fabric.warn=function(){},"undefined"!==typeof console&&["log","warn"].forEach(function(a){"undefined"!==typeof console[a]&&"function"===typeof console[a].apply&&(fabric[a]=function(){return console[a].apply(console,arguments)})}),function(){function a(a){c(function(b){a||(a={});var g,d=b||+new Date,e=a.duration||500,f=d+e,h=a.onChange||function(){},i=a.abort||function(){return!1},j=a.easing||function(a,b,c,d){return-c*Math.cos(a/d*(Math.PI/2))+c+b},k="startValue"in a?a.startValue:0,l="endValue"in a?a.endValue:100,m=a.byValue||l-k;a.onStart&&a.onStart(),function n(b){g=b||+new Date;var l=g>f?e:g-d;return i()?void(a.onComplete&&a.onComplete()):(h(j(l,k,m,e)),g>f?void(a.onComplete&&a.onComplete()):void c(n))}(d)})}function c(){return b.apply(fabric.window,arguments)}var b=fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(a){fabric.window.setTimeout(a,1e3/60)};fabric.util.animate=a,fabric.util.requestAnimFrame=c}(),function(){function a(a,b,c){var d="rgba("+parseInt(a[0]+c*(b[0]-a[0]),10)+","+parseInt(a[1]+c*(b[1]-a[1]),10)+","+parseInt(a[2]+c*(b[2]-a[2]),10);return d+=","+(a&&b?parseFloat(a[3]+c*(b[3]-a[3])):1),d+=")"}function b(b,c,d,e){var f=new fabric.Color(b).getSource(),g=new fabric.Color(c).getSource();e=e||{},fabric.util.animate(fabric.util.object.extend(e,{duration:d||500,startValue:f,endValue:g,byValue:g,easing:function(b,c,d,f){var g=e.colorEasing?e.colorEasing(b,f):1-Math.cos(b/f*(Math.PI/2));return a(c,d,g)}}))}fabric.util.animateColor=b}(),function(){function a(a,b,c,d){return a<Math.abs(b)?(a=b,d=c/4):d=0===b&&0===a?c/(2*Math.PI)*Math.asin(1):c/(2*Math.PI)*Math.asin(b/a),{a:a,c:b,p:c,s:d}}function b(a,b,c){return a.a*Math.pow(2,10*(b-=1))*Math.sin(2*(b*c-a.s)*Math.PI/a.p)}function c(a,b,c,d){return c*((a=a/d-1)*a*a+1)+b}function d(a,b,c,d){return a/=d/2,a<1?c/2*a*a*a+b:c/2*((a-=2)*a*a+2)+b}function e(a,b,c,d){return c*(a/=d)*a*a*a+b}function f(a,b,c,d){return-c*((a=a/d-1)*a*a*a-1)+b}function g(a,b,c,d){return a/=d/2,a<1?c/2*a*a*a*a+b:-c/2*((a-=2)*a*a*a-2)+b}function h(a,b,c,d){return c*(a/=d)*a*a*a*a+b}function i(a,b,c,d){return c*((a=a/d-1)*a*a*a*a+1)+b}function j(a,b,c,d){return a/=d/2,a<1?c/2*a*a*a*a*a+b:c/2*((a-=2)*a*a*a*a+2)+b}function k(a,b,c,d){return-c*Math.cos(a/d*(Math.PI/2))+c+b}function l(a,b,c,d){return c*Math.sin(a/d*(Math.PI/2))+b}function m(a,b,c,d){return-c/2*(Math.cos(Math.PI*a/d)-1)+b}function n(a,b,c,d){return 0===a?b:c*Math.pow(2,10*(a/d-1))+b}function o(a,b,c,d){return a===d?b+c:c*(-Math.pow(2,-10*a/d)+1)+b}function p(a,b,c,d){return 0===a?b:a===d?b+c:(a/=d/2,a<1?c/2*Math.pow(2,10*(a-1))+b:c/2*(-Math.pow(2,-10*--a)+2)+b)}function q(a,b,c,d){return-c*(Math.sqrt(1-(a/=d)*a)-1)+b}function r(a,b,c,d){return c*Math.sqrt(1-(a=a/d-1)*a)+b}function s(a,b,c,d){return a/=d/2,a<1?-c/2*(Math.sqrt(1-a*a)-1)+b:c/2*(Math.sqrt(1-(a-=2)*a)+1)+b}function t(c,d,e,f){var g=1.70158,h=0,i=e;if(0===c)return d;if(c/=f,1===c)return d+e;h||(h=.3*f);var j=a(i,e,h,g);return-b(j,c,f)+d}function u(b,c,d,e){var f=1.70158,g=0,h=d;if(0===b)return c;if(b/=e,1===b)return c+d;g||(g=.3*e);var i=a(h,d,g,f);return i.a*Math.pow(2,-10*b)*Math.sin(2*(b*e-i.s)*Math.PI/i.p)+i.c+c}function v(c,d,e,f){var g=1.70158,h=0,i=e;if(0===c)return d;if(c/=f/2,2===c)return d+e;h||(h=.3*f*1.5);var j=a(i,e,h,g);return c<1?-.5*b(j,c,f)+d:j.a*Math.pow(2,-10*(c-=1))*Math.sin(2*(c*f-j.s)*Math.PI/j.p)*.5+j.c+d}function w(a,b,c,d,e){return void 0===e&&(e=1.70158),c*(a/=d)*a*((e+1)*a-e)+b}function x(a,b,c,d,e){return void 0===e&&(e=1.70158),c*((a=a/d-1)*a*((e+1)*a+e)+1)+b}function y(a,b,c,d,e){return void 0===e&&(e=1.70158),a/=d/2,a<1?c/2*a*a*(((e*=1.525)+1)*a-e)+b:c/2*((a-=2)*a*(((e*=1.525)+1)*a+e)+2)+b}function z(a,b,c,d){return c-A(d-a,0,c,d)+b}function A(a,b,c,d){return(a/=d)<1/2.75?7.5625*c*a*a+b:a<2/2.75?c*(7.5625*(a-=1.5/2.75)*a+.75)+b:a<2.5/2.75?c*(7.5625*(a-=2.25/2.75)*a+.9375)+b:c*(7.5625*(a-=2.625/2.75)*a+.984375)+b}function B(a,b,c,d){return a<d/2?.5*z(2*a,0,c,d)+b:.5*A(2*a-d,0,c,d)+.5*c+b}fabric.util.ease={easeInQuad:function(a,b,c,d){return c*(a/=d)*a+b},easeOutQuad:function(a,b,c,d){return-c*(a/=d)*(a-2)+b},easeInOutQuad:function(a,b,c,d){return a/=d/2,a<1?c/2*a*a+b:-c/2*(--a*(a-2)-1)+b},easeInCubic:function(a,b,c,d){return c*(a/=d)*a*a+b},easeOutCubic:c,easeInOutCubic:d,easeInQuart:e,easeOutQuart:f,easeInOutQuart:g,easeInQuint:h,easeOutQuint:i,easeInOutQuint:j,easeInSine:k,easeOutSine:l,easeInOutSine:m,easeInExpo:n,easeOutExpo:o,easeInOutExpo:p,easeInCirc:q,easeOutCirc:r,easeInOutCirc:s,easeInElastic:t,easeOutElastic:u,easeInOutElastic:v,easeInBack:w,easeOutBack:x,easeInOutBack:y,easeInBounce:z,easeOutBounce:A,easeInOutBounce:B}}(),function(a){"use strict";function n(a){return a in l?l[a]:a}function o(a,c,d,e){var i,h="[object Array]"===Object.prototype.toString.call(c);return"fill"!==a&&"stroke"!==a||"none"!==c?"strokeDashArray"===a?c="none"===c?null:c.replace(/,/g," ").split(/\s+/).map(function(a){return parseFloat(a)}):"transformMatrix"===a?c=d&&d.transformMatrix?g(d.transformMatrix,b.parseTransformAttribute(c)):b.parseTransformAttribute(c):"visible"===a?(c="none"===c||"hidden"===c?!1:!0,d&&d.visible===!1&&(c=!1)):"opacity"===a?(c=parseFloat(c),d&&"undefined"!==typeof d.opacity&&(c*=d.opacity)):"originX"===a?c="start"===c?"left":"end"===c?"right":"center":i=h?c.map(f):f(c,e):c="",!h&&isNaN(i)?c:i}function p(a){for(var c in m)if("undefined"!==typeof a[m[c]]&&""!==a[c]){if("undefined"===typeof a[c]){if(!b.Object.prototype[c])continue;a[c]=b.Object.prototype[c]}if(0!==a[c].indexOf("url(")){var d=new b.Color(a[c]);a[c]=d.setAlpha(e(d.getAlpha()*a[m[c]],2)).toRgba()}}return a}function q(a,b){for(var c,e,d=[],f=0;f<b.length;f++)c=b[f],e=a.getElementsByTagName(c),d=d.concat(Array.prototype.slice.call(e));return d}function r(a,b){var c,d;a.replace(/;\s*$/,"").split(";").forEach(function(a){var e=a.split(":");c=e[0].trim().toLowerCase(),d=e[1].trim(),b[c]=d})}function s(a,b){var c,d;for(var e in a)"undefined"!==typeof a[e]&&(c=e.toLowerCase(),d=a[e],b[c]=d)}function t(a,c){var d={};for(var e in b.cssRules[c])if(u(a,e.split(" ")))for(var f in b.cssRules[c][e])d[f]=b.cssRules[c][e][f];return d}function u(a,b){var c,d=!0;return c=w(a,b.pop()),c&&b.length&&(d=v(a,b)),c&&d&&0===b.length}function v(a,b){for(var c,d=!0;a.parentNode&&1===a.parentNode.nodeType&&b.length;)d&&(c=b.pop()),a=a.parentNode,d=w(a,c);return 0===b.length}function w(a,b){var f,c=a.nodeName,d=a.getAttribute("class"),e=a.getAttribute("id");if(f=new RegExp("^"+c,"i"),b=b.replace(f,""),e&&b.length&&(f=new RegExp("#"+e+"(?![a-zA-Z\\-]+)","i"),b=b.replace(f,"")),d&&b.length){d=d.split(" ");for(var g=d.length;g--;)f=new RegExp("\\."+d[g]+"(?![a-zA-Z\\-]+)","i"),b=b.replace(f,"")}return 0===b.length}function x(a,b){var c;if(a.getElementById&&(c=a.getElementById(b)),c)return c;var d,e,f=a.getElementsByTagName("*");for(e=0;e<f.length;e++)if(d=f[e],b===d.getAttribute("id"))return d}function y(a){for(var b=q(a,["use","svg:use"]),c=0;b.length&&c<b.length;){var j,l,m,n,o,d=b[c],e=d.getAttribute("xlink:href").substr(1),f=d.getAttribute("x")||0,g=d.getAttribute("y")||0,h=x(a,e).cloneNode(!0),i=(h.getAttribute("transform")||"")+" translate("+f+", "+g+")",k=b.length;if(A(h),/^svg$/i.test(h.nodeName)){var p=h.ownerDocument.createElement("g");for(m=0,n=h.attributes,o=n.length;m<o;m++)l=n.item(m),p.setAttribute(l.nodeName,l.nodeValue);for(;h.firstChild;)p.appendChild(h.firstChild);h=p}for(m=0,n=d.attributes,o=n.length;m<o;m++)l=n.item(m),"x"!==l.nodeName&&"y"!==l.nodeName&&"xlink:href"!==l.nodeName&&("transform"===l.nodeName?i=l.nodeValue+" "+i:h.setAttribute(l.nodeName,l.nodeValue));h.setAttribute("transform",i),h.setAttribute("instantiated_by_use","1"),h.removeAttribute("id"),j=d.parentNode,j.replaceChild(h,d),b.length===k&&c++}}function A(a){var j,k,l,m,c=a.getAttribute("viewBox"),d=1,e=1,g=0,h=0,n=a.getAttribute("width"),o=a.getAttribute("height"),p=a.getAttribute("x")||0,q=a.getAttribute("y")||0,r=a.getAttribute("preserveAspectRatio")||"",s=!c||!i.test(a.nodeName)||!(c=c.match(z)),t=!n||!o||"100%"===n||"100%"===o,u=s&&t,v={},w="";if(v.width=0,v.height=0,v.toBeParsed=u,u)return v;if(s)return v.width=f(n),v.height=f(o),v;if(g=-parseFloat(c[1]),h=-parseFloat(c[2]),j=parseFloat(c[3]),k=parseFloat(c[4]),t?(v.width=j,v.height=k):(v.width=f(n),v.height=f(o),d=v.width/j,e=v.height/k),r=b.util.parsePreserveAspectRatioAttribute(r),"none"!==r.alignX&&(e=d=d>e?e:d),1===d&&1===e&&0===g&&0===h&&0===p&&0===q)return v;if((p||q)&&(w=" translate("+f(p)+" "+f(q)+") "),l=w+" matrix("+d+" 0 0 "+e+" "+g*d+" "+h*e+") ","svg"===a.nodeName){for(m=a.ownerDocument.createElement("g");a.firstChild;)m.appendChild(a.firstChild);
a.appendChild(m)}else m=a,l=m.getAttribute("transform")+l;return m.setAttribute("transform",l),v}function B(a,b){for(;a&&(a=a.parentNode);)if(a.nodeName&&b.test(a.nodeName.replace("svg:",""))&&!a.getAttribute("instantiated_by_use"))return!0;return!1}var b=a.fabric||(a.fabric={}),c=b.util.object.extend,d=b.util.object.clone,e=b.util.toFixed,f=b.util.parseUnit,g=b.util.multiplyTransformMatrices,h=/^(path|circle|polygon|polyline|ellipse|rect|line|image|text)$/i,i=/^(symbol|image|marker|pattern|view|svg)$/i,j=/^(?:pattern|defs|symbol|metadata|clipPath|mask)$/i,k=/^(symbol|g|a|svg)$/i,l={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","stroke-dasharray":"strokeDashArray","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"originX",opacity:"opacity"},m={stroke:"strokeOpacity",fill:"fillOpacity"};b.cssRules={},b.gradientDefs={},b.parseTransformAttribute=function(){function a(a,b){var c=Math.cos(b[0]),d=Math.sin(b[0]),e=0,f=0;3===b.length&&(e=b[1],f=b[2]),a[0]=c,a[1]=d,a[2]=-d,a[3]=c,a[4]=e-(c*e-d*f),a[5]=f-(d*e+c*f)}function c(a,b){var c=b[0],d=2===b.length?b[1]:b[0];a[0]=c,a[3]=d}function d(a,c,d){a[d]=Math.tan(b.util.degreesToRadians(c[0]))}function e(a,b){a[4]=b[0],2===b.length&&(a[5]=b[1])}var f=[1,0,0,1,0,0],g=b.reNum,h="(?:\\s+,?\\s*|,\\s*)",i="(?:(skewX)\\s*\\(\\s*("+g+")\\s*\\))",j="(?:(skewY)\\s*\\(\\s*("+g+")\\s*\\))",k="(?:(rotate)\\s*\\(\\s*("+g+")(?:"+h+"("+g+")"+h+"("+g+"))?\\s*\\))",l="(?:(scale)\\s*\\(\\s*("+g+")(?:"+h+"("+g+"))?\\s*\\))",m="(?:(translate)\\s*\\(\\s*("+g+")(?:"+h+"("+g+"))?\\s*\\))",n="(?:(matrix)\\s*\\(\\s*("+g+")"+h+"("+g+")"+h+"("+g+")"+h+"("+g+")"+h+"("+g+")"+h+"("+g+")\\s*\\))",o="(?:"+n+"|"+m+"|"+l+"|"+k+"|"+i+"|"+j+")",p="(?:"+o+"(?:"+h+"*"+o+")*)",q="^\\s*(?:"+p+"?)\\s*$",r=new RegExp(q),s=new RegExp(o,"g");return function(g){var h=f.concat(),i=[];if(!g||g&&!r.test(g))return h;g.replace(s,function(g){var j=new RegExp(o).exec(g).filter(function(a){return!!a}),k=j[1],l=j.slice(2).map(parseFloat);switch(k){case"translate":e(h,l);break;case"rotate":l[0]=b.util.degreesToRadians(l[0]),a(h,l);break;case"scale":c(h,l);break;case"skewX":d(h,l,2);break;case"skewY":d(h,l,1);break;case"matrix":h=l}i.push(h.concat()),h=f.concat()});for(var j=i[0];i.length>1;)i.shift(),j=b.util.multiplyTransformMatrices(j,i[0]);return j}}();var z=new RegExp("^\\s*("+b.reNum+"+)\\s*,?\\s*("+b.reNum+"+)\\s*,?\\s*("+b.reNum+"+)\\s*,?\\s*("+b.reNum+"+)\\s*$");b.parseSVGDocument=function(a,c,e,f){if(a){y(a);var g=b.Object.__uid++,i=A(a),k=b.util.toArray(a.getElementsByTagName("*"));if(i.crossOrigin=f&&f.crossOrigin,i.svgUid=g,0===k.length&&b.isLikelyNode){k=a.selectNodes('//*[name(.)!="svg"]');for(var l=[],m=0,n=k.length;m<n;m++)l[m]=k[m];k=l}var o=k.filter(function(a){return A(a),h.test(a.nodeName.replace("svg:",""))&&!B(a,j)});if(!o||o&&!o.length)return void(c&&c([],{}));b.gradientDefs[g]=b.getGradientDefs(a),b.cssRules[g]=b.getCSSRules(a),b.parseElements(o,function(a){c&&c(a,i)},d(i),e,f)}};var C=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+b.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+b.reNum+"))?\\s+(.*)");c(b,{parseFontDeclaration:function(a,b){var c=a.match(C);if(c){var d=c[1],e=c[3],g=c[4],h=c[5],i=c[6];d&&(b.fontStyle=d),e&&(b.fontWeight=isNaN(parseFloat(e))?e:parseFloat(e)),g&&(b.fontSize=f(g)),i&&(b.fontFamily=i),h&&(b.lineHeight="normal"===h?1:h)}},getGradientDefs:function(a){var d,f,g,b=["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"],c=q(a,b),e=0,h={},i={};for(e=c.length;e--;)d=c[e],g=d.getAttribute("xlink:href"),f=d.getAttribute("id"),g&&(i[f]=g.substr(1)),h[f]=d;for(f in i){var j=h[i[f]].cloneNode(!0);for(d=h[f];j.firstChild;)d.appendChild(j.firstChild)}return h},parseAttributes:function(a,d,e){if(a){var f,h,g={};"undefined"===typeof e&&(e=a.getAttribute("svgUid")),a.parentNode&&k.test(a.parentNode.nodeName)&&(g=b.parseAttributes(a.parentNode,d,e)),h=g&&g.fontSize||a.getAttribute("font-size")||b.Text.DEFAULT_SVG_FONT_SIZE;var i=d.reduce(function(b,c){return f=a.getAttribute(c),f&&(b[c]=f),b},{});i=c(i,c(t(a,e),b.parseStyleAttribute(a)));var j,l,m={};for(var q in i)j=n(q),l=o(j,i[q],g,h),m[j]=l;m&&m.font&&b.parseFontDeclaration(m.font,m);var r=c(g,m);return k.test(a.nodeName)?r:p(r)}},parseElements:function(a,c,d,e,f){new b.ElementsParser(a,c,d,e,f).parse()},parseStyleAttribute:function(a){var b={},c=a.getAttribute("style");return c?("string"===typeof c?r(c,b):s(c,b),b):b},parsePointsAttribute:function(a){if(!a)return null;a=a.replace(/,/g," ").trim(),a=a.split(/\s+/);var c,d,b=[];for(c=0,d=a.length;c<d;c+=2)b.push({x:parseFloat(a[c]),y:parseFloat(a[c+1])});return b},getCSSRules:function(a){for(var e,c=a.getElementsByTagName("style"),d={},f=0,g=c.length;f<g;f++){var h=c[f].textContent||c[f].text;h=h.replace(/\/\*[\s\S]*?\*\//g,""),""!==h.trim()&&(e=h.match(/[^{]*\{[\s\S]*?\}/g),e=e.map(function(a){return a.trim()}),e.forEach(function(a){for(var c=a.match(/([\s\S]*?)\s*\{([^}]*)\}/),e={},f=c[2].trim(),g=f.replace(/;$/,"").split(/\s*;\s*/),h=0,i=g.length;h<i;h++){var j=g[h].split(/\s*:\s*/),k=j[0],l=j[1];e[k]=l}a=c[1],a.split(",").forEach(function(a){a=a.replace(/^svg/i,"").trim(),""!==a&&(d[a]?b.util.object.extend(d[a],e):d[a]=b.util.object.clone(e))})}))}return d},loadSVGFromURL:function(a,c,d,e){function f(a){var f=a.responseXML;f&&!f.documentElement&&b.window.ActiveXObject&&a.responseText&&(f=new ActiveXObject("Microsoft.XMLDOM"),f.async="false",f.loadXML(a.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""))),f&&f.documentElement||c&&c(null),b.parseSVGDocument(f.documentElement,function(a,b){c&&c(a,b)},d,e)}a=a.replace(/^\n\s*/,"").trim(),new b.util.request(a,{method:"get",onComplete:f})},loadSVGFromString:function(a,c,d,e){a=a.trim();var f;if("undefined"!==typeof DOMParser){var g=new DOMParser;g&&g.parseFromString&&(f=g.parseFromString(a,"text/xml"))}else b.window.ActiveXObject&&(f=new ActiveXObject("Microsoft.XMLDOM"),f.async="false",f.loadXML(a.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,"")));b.parseSVGDocument(f.documentElement,function(a,b){c(a,b)},d,e)}})}("undefined"!==typeof exports?exports:this),fabric.ElementsParser=function(a,b,c,d,e){this.elements=a,this.callback=b,this.options=c,this.reviver=d,this.svgUid=c&&c.svgUid||0,this.parsingOptions=e},fabric.ElementsParser.prototype.parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},fabric.ElementsParser.prototype.createObjects=function(){for(var a=0,b=this.elements.length;a<b;a++)this.elements[a].setAttribute("svgUid",this.svgUid),function(a,b){setTimeout(function(){a.createObject(a.elements[b],b)},0)}(this,a)},fabric.ElementsParser.prototype.createObject=function(a,b){var c=fabric[fabric.util.string.capitalize(a.tagName.replace("svg:",""))];if(c&&c.fromElement)try{this._createObject(c,a,b)}catch(d){fabric.log(d)}else this.checkIfDone()},fabric.ElementsParser.prototype._createObject=function(a,b,c){if(a.async)a.fromElement(b,this.createCallback(c,b),this.options);else{var d=a.fromElement(b,this.options);this.resolveGradient(d,"fill"),this.resolveGradient(d,"stroke"),this.reviver&&this.reviver(b,d),this.instances[c]=d,this.checkIfDone()}},fabric.ElementsParser.prototype.createCallback=function(a,b){var c=this;return function(d){c.resolveGradient(d,"fill"),c.resolveGradient(d,"stroke"),c.reviver&&c.reviver(b,d),c.instances[a]=d,c.checkIfDone()}},fabric.ElementsParser.prototype.resolveGradient=function(a,b){var c=a.get(b);if(/^url\(/.test(c)){var d=c.slice(5,c.length-1);fabric.gradientDefs[this.svgUid][d]&&a.set(b,fabric.Gradient.fromElement(fabric.gradientDefs[this.svgUid][d],a))}},fabric.ElementsParser.prototype.checkIfDone=function(){0===--this.numElements&&(this.instances=this.instances.filter(function(a){return null!=a}),this.callback(this.instances))},function(a){"use strict";function c(a,b){this.x=a,this.y=b}var b=a.fabric||(a.fabric={});return b.Point?void b.warn("fabric.Point is already defined"):(b.Point=c,void(c.prototype={type:"point",constructor:c,add:function(a){return new c(this.x+a.x,this.y+a.y)},addEquals:function(a){return this.x+=a.x,this.y+=a.y,this},scalarAdd:function(a){return new c(this.x+a,this.y+a)},scalarAddEquals:function(a){return this.x+=a,this.y+=a,this},subtract:function(a){return new c(this.x-a.x,this.y-a.y)},subtractEquals:function(a){return this.x-=a.x,this.y-=a.y,this},scalarSubtract:function(a){return new c(this.x-a,this.y-a)},scalarSubtractEquals:function(a){return this.x-=a,this.y-=a,this},multiply:function(a){return new c(this.x*a,this.y*a)},multiplyEquals:function(a){return this.x*=a,this.y*=a,this},divide:function(a){return new c(this.x/a,this.y/a)},divideEquals:function(a){return this.x/=a,this.y/=a,this},eq:function(a){return this.x===a.x&&this.y===a.y},lt:function(a){return this.x<a.x&&this.y<a.y},lte:function(a){return this.x<=a.x&&this.y<=a.y},gt:function(a){return this.x>a.x&&this.y>a.y},gte:function(a){return this.x>=a.x&&this.y>=a.y},lerp:function(a,b){return"undefined"===typeof b&&(b=.5),b=Math.max(Math.min(1,b),0),new c(this.x+(a.x-this.x)*b,this.y+(a.y-this.y)*b)},distanceFrom:function(a){var b=this.x-a.x,c=this.y-a.y;return Math.sqrt(b*b+c*c)},midPointFrom:function(a){return this.lerp(a)},min:function(a){return new c(Math.min(this.x,a.x),Math.min(this.y,a.y))},max:function(a){return new c(Math.max(this.x,a.x),Math.max(this.y,a.y))},toString:function(){return this.x+","+this.y},setXY:function(a,b){return this.x=a,this.y=b,this},setX:function(a){return this.x=a,this},setY:function(a){return this.y=a,this},setFromPoint:function(a){return this.x=a.x,this.y=a.y,this},swap:function(a){var b=this.x,c=this.y;this.x=a.x,this.y=a.y,a.x=b,a.y=c},clone:function(){return new c(this.x,this.y)}}))}("undefined"!==typeof exports?exports:this),function(a){"use strict";function c(a){this.status=a,this.points=[]}var b=a.fabric||(a.fabric={});return b.Intersection?void b.warn("fabric.Intersection is already defined"):(b.Intersection=c,b.Intersection.prototype={constructor:c,appendPoint:function(a){return this.points.push(a),this},appendPoints:function(a){return this.points=this.points.concat(a),this}},b.Intersection.intersectLineLine=function(a,d,e,f){var g,h=(f.x-e.x)*(a.y-e.y)-(f.y-e.y)*(a.x-e.x),i=(d.x-a.x)*(a.y-e.y)-(d.y-a.y)*(a.x-e.x),j=(f.y-e.y)*(d.x-a.x)-(f.x-e.x)*(d.y-a.y);if(0!==j){var k=h/j,l=i/j;0<=k&&k<=1&&0<=l&&l<=1?(g=new c("Intersection"),g.appendPoint(new b.Point(a.x+k*(d.x-a.x),a.y+k*(d.y-a.y)))):g=new c}else g=new c(0===h||0===i?"Coincident":"Parallel");return g},b.Intersection.intersectLinePolygon=function(a,b,d){for(var g,h,i,e=new c,f=d.length,j=0;j<f;j++)g=d[j],h=d[(j+1)%f],i=c.intersectLineLine(a,b,g,h),e.appendPoints(i.points);return e.points.length>0&&(e.status="Intersection"),e},b.Intersection.intersectPolygonPolygon=function(a,b){for(var d=new c,e=a.length,f=0;f<e;f++){var g=a[f],h=a[(f+1)%e],i=c.intersectLinePolygon(g,h,b);d.appendPoints(i.points)}return d.points.length>0&&(d.status="Intersection"),d},void(b.Intersection.intersectPolygonRectangle=function(a,d,e){var f=d.min(e),g=d.max(e),h=new b.Point(g.x,f.y),i=new b.Point(f.x,g.y),j=c.intersectLinePolygon(f,h,a),k=c.intersectLinePolygon(h,g,a),l=c.intersectLinePolygon(g,i,a),m=c.intersectLinePolygon(i,f,a),n=new c;return n.appendPoints(j.points),n.appendPoints(k.points),n.appendPoints(l.points),n.appendPoints(m.points),n.points.length>0&&(n.status="Intersection"),n}))}("undefined"!==typeof exports?exports:this),function(a){"use strict";function c(a){a?this._tryParsingColor(a):this.setSource([0,0,0,1])}function d(a,b,c){return c<0&&(c+=1),c>1&&(c-=1),c<1/6?a+6*(b-a)*c:c<.5?b:c<2/3?a+(b-a)*(2/3-c)*6:a}var b=a.fabric||(a.fabric={});return b.Color?void b.warn("fabric.Color is already defined."):(b.Color=c,b.Color.prototype={_tryParsingColor:function(a){var b;a in c.colorNameMap&&(a=c.colorNameMap[a]),"transparent"===a&&(b=[255,255,255,0]),b||(b=c.sourceFromHex(a)),b||(b=c.sourceFromRgb(a)),b||(b=c.sourceFromHsl(a)),b||(b=[0,0,0,1]),b&&this.setSource(b)},_rgbToHsl:function(a,c,d){a/=255,c/=255,d/=255;var e,f,g,h=b.util.array.max([a,c,d]),i=b.util.array.min([a,c,d]);if(g=(h+i)/2,h===i)e=f=0;else{var j=h-i;switch(f=g>.5?j/(2-h-i):j/(h+i),h){case a:e=(c-d)/j+(c<d?6:0);break;case c:e=(d-a)/j+2;break;case d:e=(a-c)/j+4}e/=6}return[Math.round(360*e),Math.round(100*f),Math.round(100*g)]},getSource:function(){return this._source},setSource:function(a){this._source=a},toRgb:function(){var a=this.getSource();return"rgb("+a[0]+","+a[1]+","+a[2]+")"},toRgba:function(){var a=this.getSource();return"rgba("+a[0]+","+a[1]+","+a[2]+","+a[3]+")"},toHsl:function(){var a=this.getSource(),b=this._rgbToHsl(a[0],a[1],a[2]);return"hsl("+b[0]+","+b[1]+"%,"+b[2]+"%)"},toHsla:function(){var a=this.getSource(),b=this._rgbToHsl(a[0],a[1],a[2]);return"hsla("+b[0]+","+b[1]+"%,"+b[2]+"%,"+a[3]+")"},toHex:function(){var b,c,d,a=this.getSource();return b=a[0].toString(16),b=1===b.length?"0"+b:b,c=a[1].toString(16),c=1===c.length?"0"+c:c,d=a[2].toString(16),d=1===d.length?"0"+d:d,b.toUpperCase()+c.toUpperCase()+d.toUpperCase()},toHexa:function(){var b,a=this.getSource();return b=255*a[3],b=b.toString(16),b=1===b.length?"0"+b:b,this.toHex()+b.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(a){var b=this.getSource();return b[3]=a,this.setSource(b),this},toGrayscale:function(){var a=this.getSource(),b=parseInt((.3*a[0]+.59*a[1]+.11*a[2]).toFixed(0),10),c=a[3];return this.setSource([b,b,b,c]),this},toBlackWhite:function(a){var b=this.getSource(),c=(.3*b[0]+.59*b[1]+.11*b[2]).toFixed(0),d=b[3];return a=a||127,c=Number(c)<Number(a)?0:255,this.setSource([c,c,c,d]),this},overlayWith:function(a){a instanceof c||(a=new c(a));for(var b=[],d=this.getAlpha(),e=.5,f=this.getSource(),g=a.getSource(),h=0;h<3;h++)b.push(Math.round(f[h]*(1-e)+g[h]*e));return b[3]=d,this.setSource(b),this}},b.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,b.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,b.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,b.Color.colorNameMap={aqua:"#00FFFF",black:"#000000",blue:"#0000FF",fuchsia:"#FF00FF",gray:"#808080",grey:"#808080",green:"#008000",lime:"#00FF00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#FFA500",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",white:"#FFFFFF",yellow:"#FFFF00"},b.Color.fromRgb=function(a){return c.fromSource(c.sourceFromRgb(a))},b.Color.sourceFromRgb=function(a){var b=a.match(c.reRGBa);if(b){var d=parseInt(b[1],10)/(/%$/.test(b[1])?100:1)*(/%$/.test(b[1])?255:1),e=parseInt(b[2],10)/(/%$/.test(b[2])?100:1)*(/%$/.test(b[2])?255:1),f=parseInt(b[3],10)/(/%$/.test(b[3])?100:1)*(/%$/.test(b[3])?255:1);return[parseInt(d,10),parseInt(e,10),parseInt(f,10),b[4]?parseFloat(b[4]):1]}},b.Color.fromRgba=c.fromRgb,b.Color.fromHsl=function(a){return c.fromSource(c.sourceFromHsl(a))},b.Color.sourceFromHsl=function(a){var b=a.match(c.reHSLa);if(b){var h,i,j,e=(parseFloat(b[1])%360+360)%360/360,f=parseFloat(b[2])/(/%$/.test(b[2])?100:1),g=parseFloat(b[3])/(/%$/.test(b[3])?100:1);if(0===f)h=i=j=g;else{var k=g<=.5?g*(f+1):g+f-g*f,l=2*g-k;h=d(l,k,e+1/3),i=d(l,k,e),j=d(l,k,e-1/3)}return[Math.round(255*h),Math.round(255*i),Math.round(255*j),b[4]?parseFloat(b[4]):1]}},b.Color.fromHsla=c.fromHsl,b.Color.fromHex=function(a){return c.fromSource(c.sourceFromHex(a))},b.Color.sourceFromHex=function(a){if(a.match(c.reHex)){var b=a.slice(a.indexOf("#")+1),d=3===b.length||4===b.length,e=8===b.length||4===b.length,f=d?b.charAt(0)+b.charAt(0):b.substring(0,2),g=d?b.charAt(1)+b.charAt(1):b.substring(2,4),h=d?b.charAt(2)+b.charAt(2):b.substring(4,6),i=e?d?b.charAt(3)+b.charAt(3):b.substring(6,8):"FF";return[parseInt(f,16),parseInt(g,16),parseInt(h,16),parseFloat((parseInt(i,16)/255).toFixed(2))]}},void(b.Color.fromSource=function(a){var b=new c;return b.setSource(a),b}))}("undefined"!==typeof exports?exports:this),function(){function a(a){var d,e,f,b=a.getAttribute("style"),c=a.getAttribute("offset")||0;if(c=parseFloat(c)/(/%$/.test(c)?100:1),c=c<0?0:c>1?1:c,b){var g=b.split(/\s*;\s*/);""===g[g.length-1]&&g.pop();for(var h=g.length;h--;){var i=g[h].split(/\s*:\s*/),j=i[0].trim(),k=i[1].trim();"stop-color"===j?d=k:"stop-opacity"===j&&(f=k)}}return d||(d=a.getAttribute("stop-color")||"rgb(0,0,0)"),f||(f=a.getAttribute("stop-opacity")),d=new fabric.Color(d),e=d.getAlpha(),f=isNaN(parseFloat(f))?1:parseFloat(f),f*=e,{offset:c,color:d.toRgb(),opacity:f}}function b(a){return{x1:a.getAttribute("x1")||0,y1:a.getAttribute("y1")||0,x2:a.getAttribute("x2")||"100%",y2:a.getAttribute("y2")||0}}function c(a){return{x1:a.getAttribute("fx")||a.getAttribute("cx")||"50%",y1:a.getAttribute("fy")||a.getAttribute("cy")||"50%",r1:0,x2:a.getAttribute("cx")||"50%",y2:a.getAttribute("cy")||"50%",r2:a.getAttribute("r")||"50%"}}function e(a,b,c){var d,e=0,f=1,g="";for(var h in b)"Infinity"===b[h]?b[h]=1:"-Infinity"===b[h]&&(b[h]=0),d=parseFloat(b[h],10),f="string"===typeof b[h]&&/^\d+%$/.test(b[h])?.01:1,"x1"===h||"x2"===h||"r2"===h?(f*="objectBoundingBox"===c?a.width:1,e="objectBoundingBox"===c?a.left||0:0):("y1"===h||"y2"===h)&&(f*="objectBoundingBox"===c?a.height:1,e="objectBoundingBox"===c?a.top||0:0),b[h]=d*f+e;if("ellipse"===a.type&&null!==b.r2&&"objectBoundingBox"===c&&a.rx!==a.ry){var i=a.ry/a.rx;g=" scale(1, "+i+")",b.y1&&(b.y1/=i),b.y2&&(b.y2/=i)}return g}var d=fabric.util.object.clone;fabric.Gradient=fabric.util.createClass({offsetX:0,offsetY:0,initialize:function(a){a||(a={});var b={};this.id=fabric.Object.__uid++,this.type=a.type||"linear",b={x1:a.coords.x1||0,y1:a.coords.y1||0,x2:a.coords.x2||0,y2:a.coords.y2||0},"radial"===this.type&&(b.r1=a.coords.r1||0,b.r2=a.coords.r2||0),this.coords=b,this.colorStops=a.colorStops.slice(),a.gradientTransform&&(this.gradientTransform=a.gradientTransform),this.offsetX=a.offsetX||this.offsetX,this.offsetY=a.offsetY||this.offsetY},addColorStop:function(a){for(var b in a){var c=new fabric.Color(a[b]);this.colorStops.push({offset:parseFloat(b),color:c.toRgb(),opacity:c.getAlpha()})}return this},toObject:function(a){var b={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return fabric.util.populateWithProperties(this,b,a),b},toSVG:function(a){var c,e,b=d(this.coords,!0),f=d(this.colorStops,!0),g=b.r1>b.r2;if(f.sort(function(a,b){return a.offset-b.offset}),!a.group||"path-group"!==a.group.type)for(var h in b)"x1"===h||"x2"===h?b[h]+=this.offsetX-a.width/2:("y1"===h||"y2"===h)&&(b[h]+=this.offsetY-a.height/2);if(e='id="SVGID_'+this.id+'" gradientUnits="userSpaceOnUse"',this.gradientTransform&&(e+=' gradientTransform="matrix('+this.gradientTransform.join(" ")+')" '),"linear"===this.type?c=["<linearGradient ",e,' x1="',b.x1,'" y1="',b.y1,'" x2="',b.x2,'" y2="',b.y2,'">\n']:"radial"===this.type&&(c=["<radialGradient ",e,' cx="',g?b.x1:b.x2,'" cy="',g?b.y1:b.y2,'" r="',g?b.r1:b.r2,'" fx="',g?b.x2:b.x1,'" fy="',g?b.y2:b.y1,'">\n']),"radial"===this.type){if(g){f=f.concat(),f.reverse();for(var i=0;i<f.length;i++)f[i].offset=1-f[i].offset}var j=Math.min(b.r1,b.r2);if(j>0)for(var k=Math.max(b.r1,b.r2),l=j/k,i=0;i<f.length;i++)f[i].offset+=l*(1-f[i].offset)}for(var i=0;i<f.length;i++){var m=f[i];c.push("<stop ",'offset="',100*m.offset+"%",'" style="stop-color:',m.color,null!==m.opacity?";stop-opacity: "+m.opacity:";",'"/>\n')}return c.push("linear"===this.type?"</linearGradient>\n":"</radialGradient>\n"),c.join("")},toLive:function(a,b){var c,d,e=fabric.util.object.clone(this.coords);if(this.type){if(b.group&&"path-group"===b.group.type)for(d in e)"x1"===d||"x2"===d?e[d]+=-this.offsetX+b.width/2:("y1"===d||"y2"===d)&&(e[d]+=-this.offsetY+b.height/2);"linear"===this.type?c=a.createLinearGradient(e.x1,e.y1,e.x2,e.y2):"radial"===this.type&&(c=a.createRadialGradient(e.x1,e.y1,e.r1,e.x2,e.y2,e.r2));for(var f=0,g=this.colorStops.length;f<g;f++){var h=this.colorStops[f].color,i=this.colorStops[f].opacity,j=this.colorStops[f].offset;"undefined"!==typeof i&&(h=new fabric.Color(h).setAlpha(i).toRgba()),c.addColorStop(j,h)}return c}}}),fabric.util.object.extend(fabric.Gradient,{fromElement:function(d,f){var h,l,m,g=d.getElementsByTagName("stop"),i=d.getAttribute("gradientUnits")||"objectBoundingBox",j=d.getAttribute("gradientTransform"),k=[];h="linearGradient"===d.nodeName||"LINEARGRADIENT"===d.nodeName?"linear":"radial","linear"===h?l=b(d):"radial"===h&&(l=c(d));for(var n=g.length;n--;)k.push(a(g[n]));m=e(f,l,i);var o=new fabric.Gradient({type:h,coords:l,colorStops:k,offsetX:-f.left,offsetY:-f.top});return(j||""!==m)&&(o.gradientTransform=fabric.parseTransformAttribute((j||"")+m)),o},forObject:function(a,b){return b||(b={}),e(a,b.coords,"userSpaceOnUse"),new fabric.Gradient(b)}})}(),function(){"use strict";var a=fabric.util.toFixed;fabric.Pattern=fabric.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,initialize:function(a,b){if(a||(a={}),this.id=fabric.Object.__uid++,this.setOptions(a),!a.source||a.source&&"string"!==typeof a.source)return void(b&&b(this));if("undefined"!==typeof fabric.util.getFunctionBody(a.source))this.source=new Function(fabric.util.getFunctionBody(a.source)),b&&b(this);else{var c=this;this.source=fabric.util.createImage(),fabric.util.loadImage(a.source,function(a){c.source=a,b&&b(c)})}},toObject:function(b){var d,e,c=fabric.Object.NUM_FRACTION_DIGITS;return"function"===typeof this.source?d=String(this.source):"string"===typeof this.source.src?d=this.source.src:"object"===typeof this.source&&this.source.toDataURL&&(d=this.source.toDataURL()),e={type:"pattern",source:d,repeat:this.repeat,offsetX:a(this.offsetX,c),offsetY:a(this.offsetY,c)},fabric.util.populateWithProperties(this,e,b),e},toSVG:function(a){var b="function"===typeof this.source?this.source():this.source,c=b.width/a.width,d=b.height/a.height,e=this.offsetX/a.width,f=this.offsetY/a.height,g="";return("repeat-x"===this.repeat||"no-repeat"===this.repeat)&&(d=1),("repeat-y"===this.repeat||"no-repeat"===this.repeat)&&(c=1),b.src?g=b.src:b.toDataURL&&(g=b.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+e+'" y="'+f+'" width="'+c+'" height="'+d+'">\n<image x="0" y="0" width="'+b.width+'" height="'+b.height+'" xlink:href="'+g+'"></image>\n</pattern>\n'},setOptions:function(a){for(var b in a)this[b]=a[b]},toLive:function(a){var b="function"===typeof this.source?this.source():this.source;if(!b)return"";if("undefined"!==typeof b.src){if(!b.complete)return"";if(0===b.naturalWidth||0===b.naturalHeight)return""}return a.createPattern(b,this.repeat)}})}(),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.toFixed;return b.Shadow?void b.warn("fabric.Shadow is already defined."):(b.Shadow=b.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,initialize:function(a){"string"===typeof a&&(a=this._parseShadow(a));for(var c in a)this[c]=a[c];this.id=b.Object.__uid++},_parseShadow:function(a){var c=a.trim(),d=b.Shadow.reOffsetsAndBlur.exec(c)||[],e=c.replace(b.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)";return{color:e.trim(),offsetX:parseInt(d[1],10)||0,offsetY:parseInt(d[2],10)||0,blur:parseInt(d[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(a){var d=40,e=40,f=b.Object.NUM_FRACTION_DIGITS,g=b.util.rotateVector({x:this.offsetX,y:this.offsetY},b.util.degreesToRadians(-a.angle)),h=20;return a.width&&a.height&&(d=100*c((Math.abs(g.x)+this.blur)/a.width,f)+h,e=100*c((Math.abs(g.y)+this.blur)/a.height,f)+h),a.flipX&&(g.x*=-1),a.flipY&&(g.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+e+'%" height="'+(100+2*e)+'%" x="-'+d+'%" width="'+(100+2*d)+'%" >\n	<feGaussianBlur in="SourceAlpha" stdDeviation="'+c(this.blur?this.blur/2:0,f)+'"></feGaussianBlur>\n	<feOffset dx="'+c(g.x,f)+'" dy="'+c(g.y,f)+'" result="oBlur" ></feOffset>\n	<feFlood flood-color="'+this.color+'"/>\n	<feComposite in2="oBlur" operator="in" />\n	<feMerge>\n		<feMergeNode></feMergeNode>\n		<feMergeNode in="SourceGraphic"></feMergeNode>\n	</feMerge>\n</filter>\n'},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke};var a={},c=b.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke"].forEach(function(b){this[b]!==c[b]&&(a[b]=this[b])},this),a}}),void(b.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/))}("undefined"!==typeof exports?exports:this),function(){"use strict";if(fabric.StaticCanvas)return void fabric.warn("fabric.StaticCanvas is already defined.");var a=fabric.util.object.extend,b=fabric.util.getElementOffset,c=fabric.util.removeFromArray,d=fabric.util.toFixed,e=fabric.util.transformPoint,f=fabric.util.invertTransform,g=new Error("Could not initialize `canvas` element");fabric.StaticCanvas=fabric.util.createClass(fabric.CommonMethods,{initialize:function(a,b){b||(b={}),this._initStatic(a,b)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,clipTo:null,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:fabric.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,onBeforeScaleRotate:function(){},enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!1,_initStatic:function(a,b){var c=fabric.StaticCanvas.prototype.renderAll.bind(this);this._objects=[],this._createLowerCanvas(a),this._initOptions(b),this._setImageSmoothing(),this.interactive||this._initRetinaScaling(),b.overlayImage&&this.setOverlayImage(b.overlayImage,c),b.backgroundImage&&this.setBackgroundImage(b.backgroundImage,c),b.backgroundColor&&this.setBackgroundColor(b.backgroundColor,c),b.overlayColor&&this.setOverlayColor(b.overlayColor,c),this.calcOffset()},_isRetinaScaling:function(){return 1!==fabric.devicePixelRatio&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?fabric.devicePixelRatio:1},_initRetinaScaling:function(){this._isRetinaScaling()&&(this.lowerCanvasEl.setAttribute("width",this.width*fabric.devicePixelRatio),this.lowerCanvasEl.setAttribute("height",this.height*fabric.devicePixelRatio),this.contextContainer.scale(fabric.devicePixelRatio,fabric.devicePixelRatio))},calcOffset:function(){return this._offset=b(this.lowerCanvasEl),this},setOverlayImage:function(a,b,c){return this.__setBgOverlayImage("overlayImage",a,b,c)},setBackgroundImage:function(a,b,c){return this.__setBgOverlayImage("backgroundImage",a,b,c)},setOverlayColor:function(a,b){return this.__setBgOverlayColor("overlayColor",a,b)},setBackgroundColor:function(a,b){return this.__setBgOverlayColor("backgroundColor",a,b)},_setImageSmoothing:function(){var a=this.getContext();a.imageSmoothingEnabled=a.imageSmoothingEnabled||a.webkitImageSmoothingEnabled||a.mozImageSmoothingEnabled||a.msImageSmoothingEnabled||a.oImageSmoothingEnabled,a.imageSmoothingEnabled=this.imageSmoothingEnabled},__setBgOverlayImage:function(a,b,c,d){return"string"===typeof b?fabric.util.loadImage(b,function(b){b&&(this[a]=new fabric.Image(b,d)),c&&c(b)},this,d&&d.crossOrigin):(d&&b.setOptions(d),this[a]=b,c&&c(b)),this},__setBgOverlayColor:function(a,b,c){return this[a]=b,this._initGradient(b,a),this._initPattern(b,a,c),this},_createCanvasElement:function(a){var b=fabric.util.createCanvasElement(a);if(b.style||(b.style={}),!b)throw g;if("undefined"===typeof b.getContext)throw g;return b},_initOptions:function(a){this._setOptions(a),this.width=this.width||parseInt(this.lowerCanvasEl.width,10)||0,this.height=this.height||parseInt(this.lowerCanvasEl.height,10)||0,this.lowerCanvasEl.style&&(this.lowerCanvasEl.width=this.width,this.lowerCanvasEl.height=this.height,this.lowerCanvasEl.style.width=this.width+"px",this.lowerCanvasEl.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(a){this.lowerCanvasEl=fabric.util.getById(a)||this._createCanvasElement(a),fabric.util.addClass(this.lowerCanvasEl,"lower-canvas"),this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(a,b){return this.setDimensions({width:a},b)},setHeight:function(a,b){return this.setDimensions({height:a},b)},setDimensions:function(a,b){var c;b=b||{};for(var d in a)c=a[d],b.cssOnly||(this._setBackstoreDimension(d,a[d]),c+="px"),b.backstoreOnly||this._setCssDimension(d,c);return this._initRetinaScaling(),this._setImageSmoothing(),this.calcOffset(),b.cssOnly||this.renderAll(),this},_setBackstoreDimension:function(a,b){return this.lowerCanvasEl[a]=b,this.upperCanvasEl&&(this.upperCanvasEl[a]=b),this.cacheCanvasEl&&(this.cacheCanvasEl[a]=b),this[a]=b,this},_setCssDimension:function(a,b){return this.lowerCanvasEl.style[a]=b,this.upperCanvasEl&&(this.upperCanvasEl.style[a]=b),this.wrapperEl&&(this.wrapperEl.style[a]=b),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(a){var c,b=this._activeGroup,d=!1,e=!0;this.viewportTransform=a;for(var f=0,g=this._objects.length;f<g;f++)c=this._objects[f],c.group||c.setCoords(d,e);return b&&b.setCoords(d,e),this.calcViewportBoundaries(),this.renderAll(),this},zoomToPoint:function(a,b){var c=a,d=this.viewportTransform.slice(0);a=e(a,f(this.viewportTransform)),d[0]=b,d[3]=b;var g=e(a,d);return d[4]+=c.x-g.x,d[5]+=c.y-g.y,this.setViewportTransform(d)},setZoom:function(a){return this.zoomToPoint(new fabric.Point(0,0),a),this},absolutePan:function(a){var b=this.viewportTransform.slice(0);return b[4]=-a.x,b[5]=-a.y,this.setViewportTransform(b)},relativePan:function(a){return this.absolutePan(new fabric.Point(-a.x-this.viewportTransform[4],-a.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(a){this.stateful&&a.setupState(),a._set("canvas",this),a.setCoords(),this.fire("object:added",{target:a}),a.fire("added")},_onObjectRemoved:function(a){this.fire("object:removed",{target:a}),a.fire("removed"),delete a.canvas},clearContext:function(a){return a.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this._objects.length=0,this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderAll(),this},renderAll:function(){var a=this.contextContainer;return this.renderCanvas(a,this._objects),this},calcViewportBoundaries:function(){var a={},b=this.getWidth(),c=this.getHeight(),d=f(this.viewportTransform);return a.tl=e({x:0,y:0},d),a.br=e({x:b,y:c},d),a.tr=new fabric.Point(a.br.x,a.tl.y),a.bl=new fabric.Point(a.tl.x,a.br.y),this.vptCoords=a,a},renderCanvas:function(a,b){this.calcViewportBoundaries(),this.clearContext(a),this.fire("before:render"),this.clipTo&&fabric.util.clipContext(this,a),this._renderBackground(a),a.save(),a.transform.apply(a,this.viewportTransform),this._renderObjects(a,b),a.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(a),this.clipTo&&a.restore(),this._renderOverlay(a),this.controlsAboveOverlay&&this.interactive&&this.drawControls(a),this.fire("after:render")
},_renderObjects:function(a,b){for(var c=0,d=b.length;c<d;++c)b[c]&&b[c].render(a)},_renderBackgroundOrOverlay:function(a,b){var c=this[b+"Color"];c&&(a.fillStyle=c.toLive?c.toLive(a,this):c,a.fillRect(c.offsetX||0,c.offsetY||0,this.width,this.height)),c=this[b+"Image"],c&&(this[b+"Vpt"]&&(a.save(),a.transform.apply(a,this.viewportTransform)),c.render(a),this[b+"Vpt"]&&a.restore())},_renderBackground:function(a){this._renderBackgroundOrOverlay(a,"background")},_renderOverlay:function(a){this._renderBackgroundOrOverlay(a,"overlay")},getCenter:function(){return{top:this.getHeight()/2,left:this.getWidth()/2}},centerObjectH:function(a){return this._centerObject(a,new fabric.Point(this.getCenter().left,a.getCenterPoint().y))},centerObjectV:function(a){return this._centerObject(a,new fabric.Point(a.getCenterPoint().x,this.getCenter().top))},centerObject:function(a){var b=this.getCenter();return this._centerObject(a,new fabric.Point(b.left,b.top))},viewportCenterObject:function(a){var b=this.getVpCenter();return this._centerObject(a,b)},viewportCenterObjectH:function(a){var b=this.getVpCenter();return this._centerObject(a,new fabric.Point(b.x,a.getCenterPoint().y)),this},viewportCenterObjectV:function(a){var b=this.getVpCenter();return this._centerObject(a,new fabric.Point(a.getCenterPoint().x,b.y))},getVpCenter:function(){var a=this.getCenter(),b=f(this.viewportTransform);return e({x:a.left,y:a.top},b)},_centerObject:function(a,b){return a.setPositionByOrigin(b,"center","center"),this.renderAll(),this},toDatalessJSON:function(a){return this.toDatalessObject(a)},toObject:function(a){return this._toObjectMethod("toObject",a)},toDatalessObject:function(a){return this._toObjectMethod("toDatalessObject",a)},_toObjectMethod:function(b,c){var d={objects:this._toObjects(b,c)};return a(d,this.__serializeBgOverlay(b,c)),fabric.util.populateWithProperties(this,d,c),d},_toObjects:function(a,b){return this.getObjects().filter(function(a){return!a.excludeFromExport}).map(function(c){return this._toObject(c,a,b)},this)},_toObject:function(a,b,c){var d;this.includeDefaultValues||(d=a.includeDefaultValues,a.includeDefaultValues=!1);var e=a[b](c);return this.includeDefaultValues||(a.includeDefaultValues=d),e},__serializeBgOverlay:function(a,b){var c={};return this.backgroundColor&&(c.background=this.backgroundColor.toObject?this.backgroundColor.toObject(b):this.backgroundColor),this.overlayColor&&(c.overlay=this.overlayColor.toObject?this.overlayColor.toObject(b):this.overlayColor),this.backgroundImage&&(c.backgroundImage=this._toObject(this.backgroundImage,a,b)),this.overlayImage&&(c.overlayImage=this._toObject(this.overlayImage,a,b)),c},svgViewportTransformation:!0,toSVG:function(a,b){a||(a={});var c=[];return this._setSVGPreamble(c,a),this._setSVGHeader(c,a),this._setSVGBgOverlayColor(c,"backgroundColor"),this._setSVGBgOverlayImage(c,"backgroundImage",b),this._setSVGObjects(c,b),this._setSVGBgOverlayColor(c,"overlayColor"),this._setSVGBgOverlayImage(c,"overlayImage",b),c.push("</svg>"),c.join("")},_setSVGPreamble:function(a,b){b.suppressPreamble||a.push('<?xml version="1.0" encoding="',b.encoding||"UTF-8",'" standalone="no" ?>\n','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(a,b){var f,c=b.width||this.width,e=b.height||this.height,g='viewBox="0 0 '+this.width+" "+this.height+'" ',h=fabric.Object.NUM_FRACTION_DIGITS;b.viewBox?g='viewBox="'+b.viewBox.x+" "+b.viewBox.y+" "+b.viewBox.width+" "+b.viewBox.height+'" ':this.svgViewportTransformation&&(f=this.viewportTransform,g='viewBox="'+d(-f[4]/f[0],h)+" "+d(-f[5]/f[3],h)+" "+d(this.width/f[0],h)+" "+d(this.height/f[3],h)+'" '),a.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',c,'" ','height="',e,'" ',g,'xml:space="preserve">\n',"<desc>Created with Fabric.js ",fabric.version,"</desc>\n","<defs>\n",this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),"</defs>\n")},createSVGRefElementsMarkup:function(){var a=this,b=["backgroundColor","overlayColor"].map(function(b){var c=a[b];return c&&c.toLive?c.toSVG(a,!1):void 0});return b.join("")},createSVGFontFacesMarkup:function(){for(var c,d,e,f,g,h,i,a="",b={},j=fabric.fontPaths,k=this.getObjects(),l=0,m=k.length;l<m;l++)if(c=k[l],d=c.fontFamily,-1!==c.type.indexOf("text")&&!b[d]&&j[d]&&(b[d]=!0,c.styles)){e=c.styles;for(g in e){f=e[g];for(i in f)h=f[i],d=h.fontFamily,!b[d]&&j[d]&&(b[d]=!0)}}for(var n in b)a+=["		@font-face {\n","			font-family: '",n,"';\n","			src: url('",j[n],"');\n","		}\n"].join("");return a&&(a=['	<style type="text/css">',"<![CDATA[\n",a,"]]>","</style>\n"].join("")),a},_setSVGObjects:function(a,b){for(var c,d=0,e=this.getObjects(),f=e.length;d<f;d++)c=e[d],c.excludeFromExport||this._setSVGObject(a,c,b)},_setSVGObject:function(a,b,c){a.push(b.toSVG(c))},_setSVGBgOverlayImage:function(a,b,c){this[b]&&this[b].toSVG&&a.push(this[b].toSVG(c))},_setSVGBgOverlayColor:function(a,b){var c=this[b];if(c)if(c.toLive){var d=c.repeat;a.push('<rect transform="translate(',this.width/2,",",this.height/2,')"',' x="',c.offsetX-this.width/2,'" y="',c.offsetY-this.height/2,'" ','width="',"repeat-y"===d||"no-repeat"===d?c.source.width:this.width,'" height="',"repeat-x"===d||"no-repeat"===d?c.source.height:this.height,'" fill="url(#SVGID_'+c.id+')"',"></rect>\n")}else a.push('<rect x="0" y="0" ','width="',this.width,'" height="',this.height,'" fill="',this[b],'"',"></rect>\n")},sendToBack:function(a){if(!a)return this;var d,e,f,b=this._activeGroup;if(a===b)for(f=b._objects,d=f.length;d--;)e=f[d],c(this._objects,e),this._objects.unshift(e);else c(this._objects,a),this._objects.unshift(a);return this.renderAll&&this.renderAll()},bringToFront:function(a){if(!a)return this;var d,e,f,b=this._activeGroup;if(a===b)for(f=b._objects,d=0;d<f.length;d++)e=f[d],c(this._objects,e),this._objects.push(e);else c(this._objects,a),this._objects.push(a);return this.renderAll&&this.renderAll()},sendBackwards:function(a,b){if(!a)return this;var e,f,g,h,i,d=this._activeGroup;if(a===d)for(i=d._objects,e=0;e<i.length;e++)f=i[e],g=this._objects.indexOf(f),0!==g&&(h=g-1,c(this._objects,f),this._objects.splice(h,0,f));else g=this._objects.indexOf(a),0!==g&&(h=this._findNewLowerIndex(a,g,b),c(this._objects,a),this._objects.splice(h,0,a));return this.renderAll&&this.renderAll(),this},_findNewLowerIndex:function(a,b,c){var d;if(c){d=b;for(var e=b-1;e>=0;--e){var f=a.intersectsWithObject(this._objects[e])||a.isContainedWithinObject(this._objects[e])||this._objects[e].isContainedWithinObject(a);if(f){d=e;break}}}else d=b-1;return d},bringForward:function(a,b){if(!a)return this;var e,f,g,h,i,d=this._activeGroup;if(a===d)for(i=d._objects,e=i.length;e--;)f=i[e],g=this._objects.indexOf(f),g!==this._objects.length-1&&(h=g+1,c(this._objects,f),this._objects.splice(h,0,f));else g=this._objects.indexOf(a),g!==this._objects.length-1&&(h=this._findNewUpperIndex(a,g,b),c(this._objects,a),this._objects.splice(h,0,a));return this.renderAll&&this.renderAll(),this},_findNewUpperIndex:function(a,b,c){var d;if(c){d=b;for(var e=b+1;e<this._objects.length;++e){var f=a.intersectsWithObject(this._objects[e])||a.isContainedWithinObject(this._objects[e])||this._objects[e].isContainedWithinObject(a);if(f){d=e;break}}}else d=b+1;return d},moveTo:function(a,b){return c(this._objects,a),this._objects.splice(b,0,a),this.renderAll&&this.renderAll()},dispose:function(){return this.clear(),this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this.getObjects().length+" }>"}}),a(fabric.StaticCanvas.prototype,fabric.Observable),a(fabric.StaticCanvas.prototype,fabric.Collection),a(fabric.StaticCanvas.prototype,fabric.DataURLExporter),a(fabric.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(a){var b=fabric.util.createCanvasElement();if(!b||!b.getContext)return null;var c=b.getContext("2d");if(!c)return null;switch(a){case"getImageData":return"undefined"!==typeof c.getImageData;case"setLineDash":return"undefined"!==typeof c.setLineDash;case"toDataURL":return"undefined"!==typeof b.toDataURL;case"toDataURLWithQuality":try{return b.toDataURL("image/jpeg",0),!0}catch(d){}return!1;default:return null}}}),fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject}(),fabric.BaseBrush=fabric.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeDashArray:null,setShadow:function(a){return this.shadow=new fabric.Shadow(a),this},_setBrushStyles:function(){var a=this.canvas.contextTop;a.strokeStyle=this.color,a.lineWidth=this.width,a.lineCap=this.strokeLineCap,a.lineJoin=this.strokeLineJoin,this.strokeDashArray&&fabric.StaticCanvas.supports("setLineDash")&&a.setLineDash(this.strokeDashArray)},_setShadow:function(){if(this.shadow){var a=this.canvas.contextTop,b=this.canvas.getZoom();a.shadowColor=this.shadow.color,a.shadowBlur=this.shadow.blur*b,a.shadowOffsetX=this.shadow.offsetX*b,a.shadowOffsetY=this.shadow.offsetY*b}},_resetShadow:function(){var a=this.canvas.contextTop;a.shadowColor="",a.shadowBlur=a.shadowOffsetX=a.shadowOffsetY=0}}),function(){fabric.PencilBrush=fabric.util.createClass(fabric.BaseBrush,{initialize:function(a){this.canvas=a,this._points=[]},onMouseDown:function(a){this._prepareForDrawing(a),this._captureDrawingPath(a),this._render()},onMouseMove:function(a){this._captureDrawingPath(a),this.canvas.clearContext(this.canvas.contextTop),this._render()},onMouseUp:function(){this._finalizeAndAddPath()},_prepareForDrawing:function(a){var b=new fabric.Point(a.x,a.y);this._reset(),this._addPoint(b),this.canvas.contextTop.moveTo(b.x,b.y)},_addPoint:function(a){this._points.push(a)},_reset:function(){this._points.length=0,this._setBrushStyles(),this._setShadow()},_captureDrawingPath:function(a){var b=new fabric.Point(a.x,a.y);this._addPoint(b)},_render:function(){var a=this.canvas.contextTop,b=this.canvas.viewportTransform,c=this._points[0],d=this._points[1];a.save(),a.transform(b[0],b[1],b[2],b[3],b[4],b[5]),a.beginPath(),2===this._points.length&&c.x===d.x&&c.y===d.y&&(c.x-=.5,d.x+=.5),a.moveTo(c.x,c.y);for(var e=1,f=this._points.length;e<f;e++){var g=c.midPointFrom(d);a.quadraticCurveTo(c.x,c.y,g.x,g.y),c=this._points[e],d=this._points[e+1]}a.lineTo(c.x,c.y),a.stroke(),a.restore()},convertPointsToSVGPath:function(a){var b=[],c=new fabric.Point(a[0].x,a[0].y),d=new fabric.Point(a[1].x,a[1].y);b.push("M ",a[0].x," ",a[0].y," ");for(var e=1,f=a.length;e<f;e++){var g=c.midPointFrom(d);b.push("Q ",c.x," ",c.y," ",g.x," ",g.y," "),c=new fabric.Point(a[e].x,a[e].y),e+1<a.length&&(d=new fabric.Point(a[e+1].x,a[e+1].y))}return b.push("L ",c.x," ",c.y," "),b},createPath:function(a){var b=new fabric.Path(a,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray,originX:"center",originY:"center"});return this.shadow&&(this.shadow.affectStroke=!0,b.setShadow(this.shadow)),b},_finalizeAndAddPath:function(){var a=this.canvas.contextTop;a.closePath();var b=this.convertPointsToSVGPath(this._points).join("");if("M 0 0 Q 0 0 0 0 L 0 0"===b)return void this.canvas.renderAll();var c=this.createPath(b);this.canvas.add(c),c.setCoords(),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderAll(),this.canvas.fire("path:created",{path:c})}})}(),fabric.CircleBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,initialize:function(a){this.canvas=a,this.points=[]},drawDot:function(a){var b=this.addPoint(a),c=this.canvas.contextTop,d=this.canvas.viewportTransform;c.save(),c.transform(d[0],d[1],d[2],d[3],d[4],d[5]),c.fillStyle=b.fill,c.beginPath(),c.arc(b.x,b.y,b.radius,0,2*Math.PI,!1),c.closePath(),c.fill(),c.restore()},onMouseDown:function(a){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(a)},onMouseMove:function(a){this.drawDot(a)},onMouseUp:function(){var a=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var b=[],c=0,d=this.points.length;c<d;c++){var e=this.points[c],f=new fabric.Circle({radius:e.radius,left:e.x,top:e.y,originX:"center",originY:"center",fill:e.fill});this.shadow&&f.setShadow(this.shadow),b.push(f)}var g=new fabric.Group(b,{originX:"center",originY:"center"});g.canvas=this.canvas,this.canvas.add(g),this.canvas.fire("path:created",{path:g}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=a,this.canvas.renderAll()},addPoint:function(a){var b=new fabric.Point(a.x,a.y),c=fabric.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,d=new fabric.Color(this.color).setAlpha(fabric.util.getRandomInt(0,100)/100).toRgba();return b.radius=c,b.fill=d,this.points.push(b),b}}),fabric.SprayBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(a){this.canvas=a,this.sprayChunks=[]},onMouseDown:function(a){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(a),this.render()},onMouseMove:function(a){this.addSprayChunk(a),this.render()},onMouseUp:function(){var a=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var b=[],c=0,d=this.sprayChunks.length;c<d;c++)for(var e=this.sprayChunks[c],f=0,g=e.length;f<g;f++){var h=new fabric.Rect({width:e[f].width,height:e[f].width,left:e[f].x+1,top:e[f].y+1,originX:"center",originY:"center",fill:this.color});this.shadow&&h.setShadow(this.shadow),b.push(h)}this.optimizeOverlapping&&(b=this._getOptimizedRects(b));var i=new fabric.Group(b,{originX:"center",originY:"center"});i.canvas=this.canvas,this.canvas.add(i),this.canvas.fire("path:created",{path:i}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=a,this.canvas.renderAll()},_getOptimizedRects:function(a){for(var c,b={},d=0,e=a.length;d<e;d++)c=a[d].left+""+a[d].top,b[c]||(b[c]=a[d]);var f=[];for(c in b)f.push(b[c]);return f},render:function(){var a=this.canvas.contextTop;a.fillStyle=this.color;var b=this.canvas.viewportTransform;a.save(),a.transform(b[0],b[1],b[2],b[3],b[4],b[5]);for(var c=0,d=this.sprayChunkPoints.length;c<d;c++){var e=this.sprayChunkPoints[c];"undefined"!==typeof e.opacity&&(a.globalAlpha=e.opacity),a.fillRect(e.x,e.y,e.width,e.width)}a.restore()},addSprayChunk:function(a){this.sprayChunkPoints=[];for(var b,c,d,e=this.width/2,f=0;f<this.density;f++){b=fabric.util.getRandomInt(a.x-e,a.x+e),c=fabric.util.getRandomInt(a.y-e,a.y+e),d=this.dotWidthVariance?fabric.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth;var g=new fabric.Point(b,c);g.width=d,this.randomOpacity&&(g.opacity=fabric.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(g)}this.sprayChunks.push(this.sprayChunkPoints)}}),fabric.PatternBrush=fabric.util.createClass(fabric.PencilBrush,{getPatternSrc:function(){var a=20,b=5,c=fabric.document.createElement("canvas"),d=c.getContext("2d");return c.width=c.height=a+b,d.fillStyle=this.color,d.beginPath(),d.arc(a/2,a/2,a/2,0,2*Math.PI,!1),d.closePath(),d.fill(),c},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(){this.callSuper("_setBrushStyles"),this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(a){var b=this.callSuper("createPath",a),c=b._getLeftTopCoords().scalarAdd(b.strokeWidth/2);return b.stroke=new fabric.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-c.x,offsetY:-c.y}),b}}),function(){var a=fabric.util.getPointer,b=fabric.util.degreesToRadians,c=fabric.util.radiansToDegrees,d=Math.atan2,e=Math.abs,f=fabric.StaticCanvas.supports("setLineDash"),g=.5;fabric.Canvas=fabric.util.createClass(fabric.StaticCanvas,{initialize:function(a,b){b||(b={}),this._initStatic(a,b),this._initInteractive(),this._createCacheCanvas()},uniScaleTransform:!1,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=fabric.PencilBrush&&new fabric.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var c,a=this.getActiveGroup(),b=this.getActiveObject(),d=[],e=[];if(!a&&!b||this.preserveObjectStacking)d=this._objects;else{for(var f=0,g=this._objects.length;f<g;f++)c=this._objects[f],a&&a.contains(c)||c===b?e.push(c):d.push(c);a&&(a._set("_objects",e),d.push(a)),b&&d.push(b)}return d},renderAll:function(){!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1);var a=this.contextContainer;return this.renderCanvas(a,this._chooseObjectsToRender()),this},renderTop:function(){var a=this.contextTop;return this.clearContext(a),this.selection&&this._groupSelector&&this._drawSelection(a),this.fire("after:render"),this.contextTopDirty=!0,this},_resetCurrentTransform:function(){var a=this._currentTransform;a.target.set({scaleX:a.original.scaleX,scaleY:a.original.scaleY,skewX:a.original.skewX,skewY:a.original.skewY,left:a.original.left,top:a.original.top}),this._shouldCenterTransform(a.target)?"rotate"===a.action?this._setOriginToCenter(a.target):("center"!==a.originX&&(a.mouseXSign="right"===a.originX?-1:1),"center"!==a.originY&&(a.mouseYSign="bottom"===a.originY?-1:1),a.originX="center",a.originY="center"):(a.originX=a.original.originX,a.originY=a.original.originY)},containsPoint:function(a,b,c){var f,d=!0,e=c||this.getPointer(a,d);return f=b.group&&b.group===this.getActiveGroup()?this._normalizePointer(b.group,e):{x:e.x,y:e.y},b.containsPoint(f)||b._findTargetCorner(e)},_normalizePointer:function(a,b){var c=a.calcTransformMatrix(),d=fabric.util.invertTransform(c),e=this.restorePointerVpt(b);return fabric.util.transformPoint(e,d)},isTargetTransparent:function(a,b,c){var d=a.hasBorders,e=a.transparentCorners,f=this.contextCache,g=a.selectionBackgroundColor;a.hasBorders=a.transparentCorners=!1,a.selectionBackgroundColor="",f.save(),f.transform.apply(f,this.viewportTransform),a.render(f),f.restore(),a.active&&a._renderControls(f),a.hasBorders=d,a.transparentCorners=e,a.selectionBackgroundColor=g;var h=fabric.util.isTransparent(f,b,c,this.targetFindTolerance);return this.clearContext(f),h},_shouldClearSelection:function(a,b){var c=this.getActiveGroup(),d=this.getActiveObject();return!b||b&&c&&!c.contains(b)&&c!==b&&!a[this.selectionKey]||b&&!b.evented||b&&!b.selectable&&d&&d!==b},_shouldCenterTransform:function(a){if(a){var c,b=this._currentTransform;return"scale"===b.action||"scaleX"===b.action||"scaleY"===b.action?c=this.centeredScaling||a.centeredScaling:"rotate"===b.action&&(c=this.centeredRotation||a.centeredRotation),c?!b.altKey:b.altKey}},_getOriginFromCorner:function(a,b){var c={x:a.originX,y:a.originY};return"ml"===b||"tl"===b||"bl"===b?c.x="right":("mr"===b||"tr"===b||"br"===b)&&(c.x="left"),"tl"===b||"mt"===b||"tr"===b?c.y="bottom":("bl"===b||"mb"===b||"br"===b)&&(c.y="top"),c},_getActionFromCorner:function(a,b,c){if(!b)return"drag";switch(b){case"mtr":return"rotate";case"ml":case"mr":return c[this.altActionKey]?"skewY":"scaleX";case"mt":case"mb":return c[this.altActionKey]?"skewX":"scaleY";default:return"scale"}},_setupCurrentTransform:function(a,c){if(c){var d=this.getPointer(a),e=c._findTargetCorner(this.getPointer(a,!0)),f=this._getActionFromCorner(c,e,a),g=this._getOriginFromCorner(c,e);this._currentTransform={target:c,action:f,corner:e,scaleX:c.scaleX,scaleY:c.scaleY,skewX:c.skewX,skewY:c.skewY,offsetX:d.x-c.left,offsetY:d.y-c.top,originX:g.x,originY:g.y,ex:d.x,ey:d.y,lastX:d.x,lastY:d.y,left:c.left,top:c.top,theta:b(c.angle),width:c.width*c.scaleX,mouseXSign:1,mouseYSign:1,shiftKey:a.shiftKey,altKey:a[this.centeredKey]},this._currentTransform.original={left:c.left,top:c.top,scaleX:c.scaleX,scaleY:c.scaleY,skewX:c.skewX,skewY:c.skewY,originX:g.x,originY:g.y},this._resetCurrentTransform()}},_translateObject:function(a,b){var c=this._currentTransform,d=c.target,e=a-c.offsetX,f=b-c.offsetY,g=!d.get("lockMovementX")&&d.left!==e,h=!d.get("lockMovementY")&&d.top!==f;return g&&d.set("left",e),h&&d.set("top",f),g||h},_changeSkewTransformOrigin:function(a,b,c){var d="originX",e={0:"center"},f=b.target.skewX,g="left",h="right",i="mt"===b.corner||"ml"===b.corner?1:-1,j=1;a=a>0?1:-1,"y"===c&&(f=b.target.skewY,g="top",h="bottom",d="originY"),e[-1]=g,e[1]=h,b.target.flipX&&(j*=-1),b.target.flipY&&(j*=-1),0===f?(b.skewSign=-i*a*j,b[d]=e[-a]):(f=f>0?1:-1,b.skewSign=f,b[d]=e[f*i*j])},_skewObject:function(a,b,c){var d=this._currentTransform,e=d.target,f=!1,g=e.get("lockSkewingX"),h=e.get("lockSkewingY");if(g&&"x"===c||h&&"y"===c)return!1;var l,m,i=e.getCenterPoint(),j=e.toLocalPoint(new fabric.Point(a,b),"center","center")[c],k=e.toLocalPoint(new fabric.Point(d.lastX,d.lastY),"center","center")[c],n=e._getTransformedDimensions();return this._changeSkewTransformOrigin(j-k,d,c),l=e.toLocalPoint(new fabric.Point(a,b),d.originX,d.originY)[c],m=e.translateToOriginPoint(i,d.originX,d.originY),f=this._setObjectSkew(l,d,c,n),d.lastX=a,d.lastY=b,e.setPositionByOrigin(m,d.originX,d.originY),f},_setObjectSkew:function(a,b,c,d){var f,i,j,k,l,m,n,o,p,e=b.target,g=!1,h=b.skewSign;return"x"===c?(k="y",l="Y",m="X",o=0,p=e.skewY):(k="x",l="X",m="Y",o=e.skewX,p=0),j=e._getTransformedDimensions(o,p),n=2*Math.abs(a)-j[c],n<=2?f=0:(f=h*Math.atan(n/e["scale"+m]/(j[k]/e["scale"+l])),f=fabric.util.radiansToDegrees(f)),g=e["skew"+m]!==f,e.set("skew"+m,f),0!==e["skew"+l]&&(i=e._getTransformedDimensions(),f=d[k]/i[k]*e["scale"+l],e.set("scale"+l,f)),g},_scaleObject:function(a,b,c){var d=this._currentTransform,e=d.target,f=e.get("lockScalingX"),g=e.get("lockScalingY"),h=e.get("lockScalingFlip");if(f&&g)return!1;var i=e.translateToOriginPoint(e.getCenterPoint(),d.originX,d.originY),j=e.toLocalPoint(new fabric.Point(a,b),d.originX,d.originY),k=e._getTransformedDimensions(),l=!1;return this._setLocalMouse(j,d),l=this._setObjectScale(j,d,f,g,c,h,k),e.setPositionByOrigin(i,d.originX,d.originY),l},_setObjectScale:function(a,b,c,d,e,f,g){var l,m,n,o,h=b.target,i=!1,j=!1,k=!1;return n=a.x*h.scaleX/g.x,o=a.y*h.scaleY/g.y,l=h.scaleX!==n,m=h.scaleY!==o,f&&n<=0&&n<h.scaleX&&(i=!0),f&&o<=0&&o<h.scaleY&&(j=!0),"equally"!==e||c||d?e?"x"!==e||h.get("lockUniScaling")?"y"!==e||h.get("lockUniScaling")||j||d||h.set("scaleY",o)&&(k=k||m):i||c||h.set("scaleX",n)&&(k=k||l):(i||c||h.set("scaleX",n)&&(k=k||l),j||d||h.set("scaleY",o)&&(k=k||m)):i||j||(k=this._scaleObjectEqually(a,h,b,g)),b.newScaleX=n,b.newScaleY=o,i||j||this._flipObject(b,e),k},_scaleObjectEqually:function(a,b,c,d){var g,e=a.y+a.x,f=d.y*c.original.scaleY/b.scaleY+d.x*c.original.scaleX/b.scaleX;return c.newScaleX=c.original.scaleX*e/f,c.newScaleY=c.original.scaleY*e/f,g=c.newScaleX!==b.scaleX||c.newScaleY!==b.scaleY,b.set("scaleX",c.newScaleX),b.set("scaleY",c.newScaleY),g},_flipObject:function(a,b){a.newScaleX<0&&"y"!==b&&("left"===a.originX?a.originX="right":"right"===a.originX&&(a.originX="left")),a.newScaleY<0&&"x"!==b&&("top"===a.originY?a.originY="bottom":"bottom"===a.originY&&(a.originY="top"))},_setLocalMouse:function(a,b){var c=b.target,d=this.getZoom(),f=c.padding/d;"right"===b.originX?a.x*=-1:"center"===b.originX&&(a.x*=2*b.mouseXSign,a.x<0&&(b.mouseXSign=-b.mouseXSign)),"bottom"===b.originY?a.y*=-1:"center"===b.originY&&(a.y*=2*b.mouseYSign,a.y<0&&(b.mouseYSign=-b.mouseYSign)),e(a.x)>f?a.x<0?a.x+=f:a.x-=f:a.x=0,e(a.y)>f?a.y<0?a.y+=f:a.y-=f:a.y=0},_rotateObject:function(a,b){var e=this._currentTransform;if(e.target.get("lockRotation"))return!1;var f=d(e.ey-e.top,e.ex-e.left),g=d(b-e.top,a-e.left),h=c(g-f+e.theta),i=!0;if(e.target.snapAngle>0){var j=e.target.snapAngle,k=e.target.snapThreshold||j,l=Math.ceil(h/j)*j,m=Math.floor(h/j)*j;Math.abs(h-m)<k?h=m:Math.abs(h-l)<k&&(h=l)}return h<0&&(h=360+h),h%=360,e.target.angle===h?i=!1:e.target.angle=h,i},setCursor:function(a){this.upperCanvasEl.style.cursor=a},_resetObjectTransform:function(a){a.scaleX=1,a.scaleY=1,a.skewX=0,a.skewY=0,a.setAngle(0)},_drawSelection:function(a){var b=this._groupSelector,c=b.left,d=b.top,h=e(c),i=e(d);if(this.selectionColor&&(a.fillStyle=this.selectionColor,a.fillRect(b.ex-(c>0?0:-c),b.ey-(d>0?0:-d),h,i)),this.selectionLineWidth&&this.selectionBorderColor)if(a.lineWidth=this.selectionLineWidth,a.strokeStyle=this.selectionBorderColor,this.selectionDashArray.length>1&&!f){var j=b.ex+g-(c>0?0:h),k=b.ey+g-(d>0?0:i);a.beginPath(),fabric.util.drawDashedLine(a,j,k,j+h,k,this.selectionDashArray),fabric.util.drawDashedLine(a,j,k+i-1,j+h,k+i-1,this.selectionDashArray),fabric.util.drawDashedLine(a,j,k,j,k+i,this.selectionDashArray),fabric.util.drawDashedLine(a,j+h-1,k,j+h-1,k+i,this.selectionDashArray),a.closePath(),a.stroke()}else fabric.Object.prototype._setLineDash.call(this,a,this.selectionDashArray),a.strokeRect(b.ex+g-(c>0?0:h),b.ey+g-(d>0?0:i),h,i)},findTarget:function(a,b){if(!this.skipTargetFind){var g,c=!0,d=this.getPointer(a,c),e=this.getActiveGroup(),f=this.getActiveObject();if(this.targets=[],e&&!b&&e===this._searchPossibleTargets([e],d))return this._fireOverOutEvents(e,a),e;if(f&&f._findTargetCorner(d))return this._fireOverOutEvents(f,a),f;if(f&&f===this._searchPossibleTargets([f],d)){if(!this.preserveObjectStacking)return this._fireOverOutEvents(f,a),f;g=f}var h=this._searchPossibleTargets(this._objects,d);return a[this.altSelectionKey]&&h&&g&&h!==g&&(h=g),this._fireOverOutEvents(h,a),h}},_fireOverOutEvents:function(a,b){var c,d,e=this._hoveredTarget;e!==a&&(c={e:b,target:a,previousTarget:this._hoveredTarget},d={e:b,target:this._hoveredTarget,nextTarget:a},this._hoveredTarget=a),a?e!==a&&(e&&(this.fire("mouse:out",d),e.fire("mouseout",d)),this.fire("mouse:over",c),a.fire("mouseover",c)):e&&(this.fire("mouse:out",d),e.fire("mouseout",d))},_checkTarget:function(a,b){if(b&&b.visible&&b.evented&&this.containsPoint(null,b,a)){if(!this.perPixelTargetFind&&!b.perPixelTargetFind||b.isEditing)return!0;var c=this.isTargetTransparent(b,a.x,a.y);if(!c)return!0}},_searchPossibleTargets:function(a,b){for(var c,e,f,d=a.length;d--;)if(this._checkTarget(b,a[d])){c=a[d],"group"===c.type&&c.subTargetCheck&&(e=this._normalizePointer(c,b),f=this._searchPossibleTargets(c._objects,e),f&&this.targets.push(f));break}return c},restorePointerVpt:function(a){return fabric.util.transformPoint(a,fabric.util.invertTransform(this.viewportTransform))},getPointer:function(b,c,d){d||(d=this.upperCanvasEl);var i,e=a(b),f=d.getBoundingClientRect(),g=f.width||0,h=f.height||0;return g&&h||("top"in f&&"bottom"in f&&(h=Math.abs(f.top-f.bottom)),"right"in f&&"left"in f&&(g=Math.abs(f.right-f.left))),this.calcOffset(),e.x=e.x-this._offset.left,e.y=e.y-this._offset.top,c||(e=this.restorePointerVpt(e)),i=0===g||0===h?{width:1,height:1}:{width:d.width/g,height:d.height/h},{x:e.x*i.width,y:e.y*i.height}},_createUpperCanvas:function(){var a=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,"");this.upperCanvasEl?this.upperCanvasEl.className="":this.upperCanvasEl=this._createCanvasElement(),fabric.util.addClass(this.upperCanvasEl,"upper-canvas "+a),this.wrapperEl.appendChild(this.upperCanvasEl),this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl),this._applyCanvasStyle(this.upperCanvasEl),this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,"div",{"class":this.containerClass}),fabric.util.setStyle(this.wrapperEl,{width:this.getWidth()+"px",height:this.getHeight()+"px",position:"relative"}),fabric.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(a){var b=this.getWidth()||a.width,c=this.getHeight()||a.height;fabric.util.setStyle(a,{position:"absolute",width:b+"px",height:c+"px",left:0,top:0,"touch-action":"none"}),a.width=b,a.height=c,fabric.util.makeElementUnselectable(a)},_copyCanvasStyle:function(a,b){b.style.cssText=a.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},_setActiveObject:function(a){var b=this._activeObject;b&&(b.set("active",!1),a!==b&&b.onDeselect&&"function"===typeof b.onDeselect&&b.onDeselect()),this._activeObject=a,a.set("active",!0)},setActiveObject:function(a,b){var c=this.getActiveObject();return c&&c!==a&&c.fire("deselected",{e:b}),this._setActiveObject(a),this.fire("object:selected",{target:a,e:b}),a.fire("selected",{e:b}),this.renderAll(),this},getActiveObject:function(){return this._activeObject},_onObjectRemoved:function(a){this.getActiveObject()===a&&(this.fire("before:selection:cleared",{target:a}),this._discardActiveObject(),this.fire("selection:cleared",{target:a}),a.fire("deselected")),this._hoveredTarget===a&&(this._hoveredTarget=null),this.callSuper("_onObjectRemoved",a)},_discardActiveObject:function(){var a=this._activeObject;a&&(a.set("active",!1),a.onDeselect&&"function"===typeof a.onDeselect&&a.onDeselect()),this._activeObject=null},discardActiveObject:function(a){var b=this._activeObject;return b&&(this.fire("before:selection:cleared",{target:b,e:a}),this._discardActiveObject(),this.fire("selection:cleared",{e:a}),b.fire("deselected",{e:a})),this},_setActiveGroup:function(a){this._activeGroup=a,a&&a.set("active",!0)},setActiveGroup:function(a,b){return this._setActiveGroup(a),a&&(this.fire("object:selected",{target:a,e:b}),a.fire("selected",{e:b})),this},getActiveGroup:function(){return this._activeGroup},_discardActiveGroup:function(){var a=this.getActiveGroup();a&&a.destroy(),this.setActiveGroup(null)},discardActiveGroup:function(a){var b=this.getActiveGroup();return b&&(this.fire("before:selection:cleared",{e:a,target:b}),this._discardActiveGroup(),this.fire("selection:cleared",{e:a})),this},deactivateAll:function(){for(var d,a=this.getObjects(),b=0,c=a.length;b<c;b++)d=a[b],d&&d.set("active",!1);return this._discardActiveGroup(),this._discardActiveObject(),this},deactivateAllWithDispatch:function(a){for(var e,b=this.getObjects(),c=0,d=b.length;c<d;c++)e=b[c],e&&e.set("active",!1);return this.discardActiveGroup(a),this.discardActiveObject(a),this},dispose:function(){this.callSuper("dispose");var a=this.wrapperEl;return this.removeListeners(),a.removeChild(this.upperCanvasEl),a.removeChild(this.lowerCanvasEl),delete this.upperCanvasEl,a.parentNode&&a.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,this},clear:function(){return this.discardActiveGroup(),this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(a){var b=this.getActiveGroup();b?b._renderControls(a):this._drawObjectsControls(a)},_drawObjectsControls:function(a){for(var b=0,c=this._objects.length;b<c;++b)this._objects[b]&&this._objects[b].active&&this._objects[b]._renderControls(a)
},_toObject:function(a,b,c){var d=this._realizeGroupTransformOnObject(a),e=this.callSuper("_toObject",a,b,c);return this._unwindGroupTransformOnObject(a,d),e},_realizeGroupTransformOnObject:function(a){var b=["angle","flipX","flipY","height","left","scaleX","scaleY","top","width"];if(a.group&&a.group===this.getActiveGroup()){var c={};return b.forEach(function(b){c[b]=a[b]}),this.getActiveGroup().realizeTransform(a),c}return null},_unwindGroupTransformOnObject:function(a,b){b&&a.set(b)},_setSVGObject:function(a,b,c){var d;d=this._realizeGroupTransformOnObject(b),this.callSuper("_setSVGObject",a,b,c),this._unwindGroupTransformOnObject(b,d)}});for(var h in fabric.StaticCanvas)"prototype"!==h&&(fabric.Canvas[h]=fabric.StaticCanvas[h]);fabric.isTouchSupported&&(fabric.Canvas.prototype._setCursorFromEvent=function(){}),fabric.Element=fabric.Canvas}(),function(){function g(a,b){return"which"in a?a.which===b:a.button===b-1}var a={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},b=fabric.util.addListener,c=fabric.util.removeListener,d=3,e=2,f=1;fabric.util.object.extend(fabric.Canvas.prototype,{cursorMap:["n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize","nw-resize"],_initEventListeners:function(){this.removeListeners(),this._bindEvents(),b(fabric.window,"resize",this._onResize),b(this.upperCanvasEl,"mousedown",this._onMouseDown),b(this.upperCanvasEl,"mousemove",this._onMouseMove),b(this.upperCanvasEl,"mouseout",this._onMouseOut),b(this.upperCanvasEl,"mouseenter",this._onMouseEnter),b(this.upperCanvasEl,"wheel",this._onMouseWheel),b(this.upperCanvasEl,"contextmenu",this._onContextMenu),b(this.upperCanvasEl,"touchstart",this._onMouseDown,{passive:!1}),b(this.upperCanvasEl,"touchmove",this._onMouseMove,{passive:!1}),"undefined"!==typeof eventjs&&"add"in eventjs&&(eventjs.add(this.upperCanvasEl,"gesture",this._onGesture),eventjs.add(this.upperCanvasEl,"drag",this._onDrag),eventjs.add(this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs.add(this.upperCanvasEl,"shake",this._onShake),eventjs.add(this.upperCanvasEl,"longpress",this._onLongPress))},_bindEvents:function(){this.eventsBinded||(this._onMouseDown=this._onMouseDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this.eventsBinded=!0)},removeListeners:function(){c(fabric.window,"resize",this._onResize),c(this.upperCanvasEl,"mousedown",this._onMouseDown),c(this.upperCanvasEl,"mousemove",this._onMouseMove),c(this.upperCanvasEl,"mouseout",this._onMouseOut),c(this.upperCanvasEl,"mouseenter",this._onMouseEnter),c(this.upperCanvasEl,"wheel",this._onMouseWheel),c(this.upperCanvasEl,"contextmenu",this._onContextMenu),c(this.upperCanvasEl,"touchstart",this._onMouseDown),c(this.upperCanvasEl,"touchmove",this._onMouseMove),"undefined"!==typeof eventjs&&"remove"in eventjs&&(eventjs.remove(this.upperCanvasEl,"gesture",this._onGesture),eventjs.remove(this.upperCanvasEl,"drag",this._onDrag),eventjs.remove(this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs.remove(this.upperCanvasEl,"shake",this._onShake),eventjs.remove(this.upperCanvasEl,"longpress",this._onLongPress))},_onGesture:function(a,b){this.__onTransformGesture&&this.__onTransformGesture(a,b)},_onDrag:function(a,b){this.__onDrag&&this.__onDrag(a,b)},_onMouseWheel:function(a){this.__onMouseWheel(a)},_onMouseOut:function(a){var b=this._hoveredTarget;this.fire("mouse:out",{target:b,e:a}),this._hoveredTarget=null,b&&b.fire("mouseout",{e:a}),this._iTextInstances&&this._iTextInstances.forEach(function(a){a.isEditing&&a.hiddenTextarea.focus()})},_onMouseEnter:function(a){this.findTarget(a)||(this.fire("mouse:over",{target:null,e:a}),this._hoveredTarget=null)},_onOrientationChange:function(a,b){this.__onOrientationChange&&this.__onOrientationChange(a,b)},_onShake:function(a,b){this.__onShake&&this.__onShake(a,b)},_onLongPress:function(a,b){this.__onLongPress&&this.__onLongPress(a,b)},_onContextMenu:function(a){return this.stopContextMenu&&(a.stopPropagation(),a.preventDefault()),!1},_onMouseDown:function(a){this.__onMouseDown(a),b(fabric.document,"touchend",this._onMouseUp,{passive:!1}),b(fabric.document,"touchmove",this._onMouseMove,{passive:!1}),c(this.upperCanvasEl,"mousemove",this._onMouseMove),c(this.upperCanvasEl,"touchmove",this._onMouseMove),"touchstart"===a.type?c(this.upperCanvasEl,"mousedown",this._onMouseDown):(b(fabric.document,"mouseup",this._onMouseUp),b(fabric.document,"mousemove",this._onMouseMove))},_onMouseUp:function(a){if(this.__onMouseUp(a),c(fabric.document,"mouseup",this._onMouseUp),c(fabric.document,"touchend",this._onMouseUp),c(fabric.document,"mousemove",this._onMouseMove),c(fabric.document,"touchmove",this._onMouseMove),b(this.upperCanvasEl,"mousemove",this._onMouseMove),b(this.upperCanvasEl,"touchmove",this._onMouseMove,{passive:!1}),"touchend"===a.type){var d=this;setTimeout(function(){b(d.upperCanvasEl,"mousedown",d._onMouseDown)},400)}},_onMouseMove:function(a){!this.allowTouchScrolling&&a.preventDefault&&a.preventDefault(),this.__onMouseMove(a)},_onResize:function(){this.calcOffset()},_shouldRender:function(a,b){var c=this.getActiveGroup()||this.getActiveObject();return c&&c.isEditing&&a===c?!1:!!(a&&(a.isMoving||a!==c)||!a&&c||!a&&!c&&!this._groupSelector||b&&this._previousPointer&&this.selection&&(b.x!==this._previousPointer.x||b.y!==this._previousPointer.y))},__onMouseUp:function(a){var b;if(g(a,d))return void(this.fireRightClick&&this._handleEvent(a,"up",b,d));if(g(a,e))return void(this.fireMiddleClick&&this._handleEvent(a,"up",b,e));if(this.isDrawingMode&&this._isCurrentlyDrawing)return void this._onMouseUpInDrawingMode(a);var c=!0,h=this._currentTransform,i=this._groupSelector,j=!i||0===i.left&&0===i.top;h&&(this._finalizeCurrentTransform(),c=!h.actionPerformed),b=c?this.findTarget(a,!0):h.target;var k=this._shouldRender(b,this.getPointer(a));b||!j?this._maybeGroupObjects(a):(this._groupSelector=null,this._currentTransform=null),b&&(b.isMoving=!1),this._setCursorFromEvent(a,b),this._handleEvent(a,"up",b?b:null,f,j),b&&(b.__corner=0),k&&this.renderAll()},_handleEvent:function(a,b,c,d,e){var g="undefined"===typeof c?this.findTarget(a):c,h=this.targets||[],i={e:a,target:g,subTargets:h,button:d||f,isClick:e||!1};this.fire("mouse:"+b,i),g&&g.fire("mouse"+b,i);for(var j=0;j<h.length;j++)h[j].fire("mouse"+b,i)},_finalizeCurrentTransform:function(){var a=this._currentTransform,b=a.target;b._scaling&&(b._scaling=!1),b.setCoords(),this._restoreOriginXY(b),(a.actionPerformed||this.stateful&&b.hasStateChanged())&&(this.fire("object:modified",{target:b}),b.fire("modified"))},_restoreOriginXY:function(a){if(this._previousOriginX&&this._previousOriginY){var b=a.translateToOriginPoint(a.getCenterPoint(),this._previousOriginX,this._previousOriginY);a.originX=this._previousOriginX,a.originY=this._previousOriginY,a.left=b.x,a.top=b.y,this._previousOriginX=null,this._previousOriginY=null}},_onMouseDownInDrawingMode:function(a){this._isCurrentlyDrawing=!0,this.discardActiveObject(a).renderAll(),this.clipTo&&fabric.util.clipContext(this,this.contextTop);var b=this.getPointer(a);this.freeDrawingBrush.onMouseDown(b),this._handleEvent(a,"down")},_onMouseMoveInDrawingMode:function(a){if(this._isCurrentlyDrawing){var b=this.getPointer(a);this.freeDrawingBrush.onMouseMove(b)}this.setCursor(this.freeDrawingCursor),this._handleEvent(a,"move")},_onMouseUpInDrawingMode:function(a){this._isCurrentlyDrawing=!1,this.clipTo&&this.contextTop.restore(),this.freeDrawingBrush.onMouseUp(),this._handleEvent(a,"up")},__onMouseDown:function(a){var b=this.findTarget(a);if(g(a,d))return void(this.fireRightClick&&this._handleEvent(a,"down",b?b:null,d));if(g(a,e))return void(this.fireMiddleClick&&this._handleEvent(a,"down",b?b:null,e));if(this.isDrawingMode)return void this._onMouseDownInDrawingMode(a);if(!this._currentTransform){var c=this.getPointer(a,!0);this._previousPointer=c;var f=this._shouldRender(b,c),h=this._shouldGroup(a,b);if(this._shouldClearSelection(a,b)?this.deactivateAllWithDispatch(a):h&&(this._handleGrouping(a,b),b=this.getActiveGroup()),!this.selection||b&&(b.selectable||b.isEditing)||(this._groupSelector={ex:c.x,ey:c.y,top:0,left:0}),b){!b.selectable||!b.__corner&&h||(this._beforeTransform(a,b),this._setupCurrentTransform(a,b));var i=this.getActiveObject();b!==this.getActiveGroup()&&b!==i&&(this.deactivateAll(),b.selectable&&(i&&i.fire("deselected",{e:a}),this.setActiveObject(b,a)))}this._handleEvent(a,"down",b?b:null),f&&this.renderAll()}},_beforeTransform:function(a,b){this.stateful&&b.saveState(),b._findTargetCorner(this.getPointer(a))&&this.onBeforeScaleRotate(b)},_setOriginToCenter:function(a){this._previousOriginX=this._currentTransform.target.originX,this._previousOriginY=this._currentTransform.target.originY;var b=a.getCenterPoint();a.originX="center",a.originY="center",a.left=b.x,a.top=b.y,this._currentTransform.left=a.left,this._currentTransform.top=a.top},_setCenterToOrigin:function(a){var b=a.translateToOriginPoint(a.getCenterPoint(),this._previousOriginX,this._previousOriginY);a.originX=this._previousOriginX,a.originY=this._previousOriginY,a.left=b.x,a.top=b.y,this._previousOriginX=null,this._previousOriginY=null},__onMouseMove:function(a){var b,c;if(this.isDrawingMode)return void this._onMouseMoveInDrawingMode(a);if(!("undefined"!==typeof a.touches&&a.touches.length>1)){var d=this._groupSelector;d?(c=this.getPointer(a,!0),d.left=c.x-d.ex,d.top=c.y-d.ey,this.renderTop()):this._currentTransform?this._transformObject(a):(b=this.findTarget(a),this._setCursorFromEvent(a,b)),this._handleEvent(a,"move",b?b:null)}},__onMouseWheel:function(a){this._handleEvent(a,"wheel")},_transformObject:function(a){var b=this.getPointer(a),c=this._currentTransform;c.reset=!1,c.target.isMoving=!0,c.shiftKey=a.shiftKey,c.altKey=a[this.centeredKey],this._beforeScaleTransform(a,c),this._performTransformAction(a,c,b),c.actionPerformed&&this.renderAll()},_performTransformAction:function(a,b,c){var d=c.x,e=c.y,f=b.target,g=b.action,h=!1;"rotate"===g?(h=this._rotateObject(d,e))&&this._fire("rotating",f,a):"scale"===g?(h=this._onScale(a,b,d,e))&&this._fire("scaling",f,a):"scaleX"===g?(h=this._scaleObject(d,e,"x"))&&this._fire("scaling",f,a):"scaleY"===g?(h=this._scaleObject(d,e,"y"))&&this._fire("scaling",f,a):"skewX"===g?(h=this._skewObject(d,e,"x"))&&this._fire("skewing",f,a):"skewY"===g?(h=this._skewObject(d,e,"y"))&&this._fire("skewing",f,a):(h=this._translateObject(d,e),h&&(this._fire("moving",f,a),this.setCursor(f.moveCursor||this.moveCursor))),b.actionPerformed=b.actionPerformed||h},_fire:function(a,b,c){this.fire("object:"+a,{target:b,e:c}),b.fire(a,{e:c})},_beforeScaleTransform:function(a,b){if("scale"===b.action||"scaleX"===b.action||"scaleY"===b.action){var c=this._shouldCenterTransform(b.target);(c&&("center"!==b.originX||"center"!==b.originY)||!c&&"center"===b.originX&&"center"===b.originY)&&(this._resetCurrentTransform(),b.reset=!0)}},_onScale:function(a,b,c,d){return!a[this.uniScaleKey]&&!this.uniScaleTransform||b.target.get("lockUniScaling")?(b.reset||"scale"!==b.currentAction||this._resetCurrentTransform(),b.currentAction="scaleEqually",this._scaleObject(c,d,"equally")):(b.currentAction="scale",this._scaleObject(c,d))},_setCursorFromEvent:function(a,b){if(!b)return this.setCursor(this.defaultCursor),!1;var c=b.hoverCursor||this.hoverCursor,d=this.getActiveGroup(),e=b._findTargetCorner&&(!d||!d.contains(b))&&b._findTargetCorner(this.getPointer(a,!0));return e?this._setCornerCursor(e,b,a):this.setCursor(c),!0},_setCornerCursor:function(b,c,d){if(b in a)this.setCursor(this._getRotatedCornerCursor(b,c,d));else{if("mtr"!==b||!c.hasRotatingPoint)return this.setCursor(this.defaultCursor),!1;this.setCursor(this.rotationCursor)}},_getRotatedCornerCursor:function(b,c,d){var e=Math.round(c.getAngle()%360/45);return e<0&&(e+=8),e+=a[b],d[this.altActionKey]&&a[b]%2===0&&(e+=2),e%=8,this.cursorMap[e]}})}(),function(){var a=Math.min,b=Math.max;fabric.util.object.extend(fabric.Canvas.prototype,{_shouldGroup:function(a,b){var c=this.getActiveObject();return a[this.selectionKey]&&b&&b.selectable&&(this.getActiveGroup()||c&&c!==b)&&this.selection},_handleGrouping:function(a,b){var c=this.getActiveGroup();(b!==c||(b=this.findTarget(a,!0)))&&(c?this._updateActiveGroup(b,a):this._createActiveGroup(b,a),this._activeGroup&&this._activeGroup.saveCoords())},_updateActiveGroup:function(a,b){var c=this.getActiveGroup();if(c.contains(a)){if(c.removeWithUpdate(a),a.set("active",!1),1===c.size())return this.discardActiveGroup(b),void this.setActiveObject(c.item(0),b)}else c.addWithUpdate(a);this.fire("selection:created",{target:c,e:b}),c.set("active",!0)},_createActiveGroup:function(a,b){if(this._activeObject&&a!==this._activeObject){var c=this._createGroup(a);c.addWithUpdate(),this.setActiveGroup(c,b),this._activeObject=null,this.fire("selection:created",{target:c,e:b})}a.set("active",!0)},_createGroup:function(a){var b=this.getObjects(),c=b.indexOf(this._activeObject)<b.indexOf(a),d=c?[this._activeObject,a]:[a,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new fabric.Group(d,{canvas:this})},_groupSelectedObjects:function(a){var b=this._collectObjects();1===b.length?this.setActiveObject(b[0],a):b.length>1&&(b=new fabric.Group(b.reverse(),{canvas:this}),b.addWithUpdate(),this.setActiveGroup(b,a),b.saveCoords(),this.fire("selection:created",{target:b,e:a}),this.renderAll())},_collectObjects:function(){for(var d,c=[],e=this._groupSelector.ex,f=this._groupSelector.ey,g=e+this._groupSelector.left,h=f+this._groupSelector.top,i=new fabric.Point(a(e,g),a(f,h)),j=new fabric.Point(b(e,g),b(f,h)),k=e===g&&f===h,l=this._objects.length;l--&&(d=this._objects[l],!(d&&d.selectable&&d.visible&&(d.intersectsWithRect(i,j)||d.isContainedWithinRect(i,j)||d.containsPoint(i)||d.containsPoint(j))&&(d.set("active",!0),c.push(d),k))););return c},_maybeGroupObjects:function(a){this.selection&&this._groupSelector&&this._groupSelectedObjects(a);var b=this.getActiveGroup();b&&(b.setObjectsCoords().setCoords(),b.isMoving=!1,this.setCursor(this.defaultCursor)),this._groupSelector=null,this._currentTransform=null}})}(),function(){var a=fabric.StaticCanvas.supports("toDataURLWithQuality");fabric.util.object.extend(fabric.StaticCanvas.prototype,{toDataURL:function(a){a||(a={});var b=a.format||"png",c=a.quality||1,d=a.multiplier||1,e={left:a.left||0,top:a.top||0,width:a.width||0,height:a.height||0};return this.__toDataURLWithMultiplier(b,c,e,d)},__toDataURLWithMultiplier:function(a,b,c,d){var e=this.getWidth(),f=this.getHeight(),g=(c.width||this.getWidth())*d,h=(c.height||this.getHeight())*d,i=this.getZoom(),j=i*d,k=this.viewportTransform,l=(k[4]-c.left)*d,m=(k[5]-c.top)*d,n=[j,0,0,j,l,m],o=this.interactive;this.viewportTransform=n,this.interactive&&(this.interactive=!1),e!==g||f!==h?this.setDimensions({width:g,height:h}):this.renderAll();var p=this.__toDataURL(a,b,c);return o&&(this.interactive=o),this.viewportTransform=k,this.setDimensions({width:e,height:f}),p},__toDataURL:function(b,c){var d=this.contextContainer.canvas;"jpg"===b&&(b="jpeg");var e=a?d.toDataURL("image/"+b,c):d.toDataURL("image/"+b);return e},toDataURLWithMultiplier:function(a,b,c){return this.toDataURL({format:a,multiplier:b,quality:c})}})}(),fabric.util.object.extend(fabric.StaticCanvas.prototype,{loadFromDatalessJSON:function(a,b,c){return this.loadFromJSON(a,b,c)},loadFromJSON:function(a,b,c){if(a){var d="string"===typeof a?JSON.parse(a):fabric.util.object.clone(a);this.clear();var e=this;return this._enlivenObjects(d.objects,function(){e._setBgOverlay(d,function(){delete d.objects,delete d.backgroundImage,delete d.overlayImage,delete d.background,delete d.overlay,e._setOptions(d),b&&b()})},c),this}},_setBgOverlay:function(a,b){var c=this,d={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(!a.backgroundImage&&!a.overlayImage&&!a.background&&!a.overlay)return void(b&&b());var e=function(){d.backgroundImage&&d.overlayImage&&d.backgroundColor&&d.overlayColor&&(c.renderAll(),b&&b())};this.__setBgOverlay("backgroundImage",a.backgroundImage,d,e),this.__setBgOverlay("overlayImage",a.overlayImage,d,e),this.__setBgOverlay("backgroundColor",a.background,d,e),this.__setBgOverlay("overlayColor",a.overlay,d,e)},__setBgOverlay:function(a,b,c,d){var e=this;return b?void("backgroundImage"===a||"overlayImage"===a?fabric.util.enlivenObjects([b],function(b){e[a]=b[0],c[a]=!0,d&&d()}):this["set"+fabric.util.string.capitalize(a,!0)](b,function(){c[a]=!0,d&&d()})):(c[a]=!0,void(d&&d()))},_enlivenObjects:function(a,b,c){var d=this;if(!a||0===a.length)return void(b&&b());var e=this.renderOnAddRemove;this.renderOnAddRemove=!1,fabric.util.enlivenObjects(a,function(a){a.forEach(function(a,b){d.insertAt(a,b)}),d.renderOnAddRemove=e,b&&b()},null,c)},_toDataURL:function(a,b){this.clone(function(c){b(c.toDataURL(a))})},_toDataURLWithMultiplier:function(a,b,c){this.clone(function(d){c(d.toDataURLWithMultiplier(a,b))})},clone:function(a,b){var c=JSON.stringify(this.toJSON(b));this.cloneWithoutData(function(b){b.loadFromJSON(c,function(){a&&a(b)})})},cloneWithoutData:function(a){var b=fabric.document.createElement("canvas");b.width=this.getWidth(),b.height=this.getHeight();var c=new fabric.Canvas(b);c.clipTo=this.clipTo,this.backgroundImage?(c.setBackgroundImage(this.backgroundImage.src,function(){c.renderAll(),a&&a(c)}),c.backgroundImageOpacity=this.backgroundImageOpacity,c.backgroundImageStretch=this.backgroundImageStretch):a&&a(c)}}),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend,d=b.util.object.clone,e=b.util.toFixed,f=b.util.string.capitalize,g=b.util.degreesToRadians,h=b.StaticCanvas.supports("setLineDash"),i=!b.isLikelyNode;b.Object||(b.Object=b.util.createClass(b.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",borderDashArray:null,cornerColor:"rgba(102,153,255,0.5)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:10,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:.01,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,includeDefaultValues:!0,clipTo:null,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:i,statefullCache:!1,noScaleCache:!0,dirty:!0,stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit angle opacity fill fillRule globalCompositeOperation shadow clipTo visible backgroundColor skewX skewY".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit fillRule backgroundColor".split(" "),initialize:function(a){a=a||{},a&&this.setOptions(a)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=b.document.createElement("canvas"),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas()},_getCacheCanvasDimensions:function(){var a=this.canvas&&this.canvas.getZoom()||1,c=this.getObjectScaling(),d=this._getNonTransformedDimensions(),e=this.canvas&&this.canvas._isRetinaScaling()?b.devicePixelRatio:1,f=c.scaleX*a*e,g=c.scaleY*a*e,h=d.x*f,i=d.y*g;return{width:h+2,height:i+2,zoomX:f,zoomY:g}},_updateCacheCanvas:function(){if(this.noScaleCache&&this.canvas&&this.canvas._currentTransform){var a=this.canvas._currentTransform.action;if("scale"===a.slice(0,5))return!1}var b=this._getCacheCanvasDimensions(),c=b.width,d=b.height,e=b.zoomX,f=b.zoomY;return c!==this.cacheWidth||d!==this.cacheHeight?(this._cacheCanvas.width=Math.ceil(c),this._cacheCanvas.height=Math.ceil(d),this._cacheContext.translate(c/2,d/2),this._cacheContext.scale(e,f),this.cacheWidth=c,this.cacheHeight=d,this.zoomX=e,this.zoomY=f,!0):!1},setOptions:function(a){this._setOptions(a),this._initGradient(a.fill,"fill"),this._initGradient(a.stroke,"stroke"),this._initClipping(a),this._initPattern(a.fill,"fill"),this._initPattern(a.stroke,"stroke")},transform:function(a,b){this.group&&!this.group._transformDone&&this.group===this.canvas._activeGroup&&this.group.transform(a);var c=b?this._getLeftTopCoords():this.getCenterPoint();a.translate(c.x,c.y),this.angle&&a.rotate(g(this.angle)),a.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1)),this.skewX&&a.transform(1,0,Math.tan(g(this.skewX)),1,0,0),this.skewY&&a.transform(1,Math.tan(g(this.skewY)),0,1,0,0)},toObject:function(a){var c=b.Object.NUM_FRACTION_DIGITS,d={type:this.type,originX:this.originX,originY:this.originY,left:e(this.left,c),top:e(this.top,c),width:e(this.width,c),height:e(this.height,c),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:e(this.strokeWidth,c),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:e(this.strokeMiterLimit,c),scaleX:e(this.scaleX,c),scaleY:e(this.scaleY,c),angle:e(this.getAngle(),c),flipX:this.flipX,flipY:this.flipY,opacity:e(this.opacity,c),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),backgroundColor:this.backgroundColor,fillRule:this.fillRule,globalCompositeOperation:this.globalCompositeOperation,transformMatrix:this.transformMatrix?this.transformMatrix.concat():null,skewX:e(this.skewX,c),skewY:e(this.skewY,c)};return b.util.populateWithProperties(this,d,a),this.includeDefaultValues||(d=this._removeDefaultValues(d)),d},toDatalessObject:function(a){return this.toObject(a)},_removeDefaultValues:function(a){var c=b.util.getKlass(a.type).prototype,d=c.stateProperties;return d.forEach(function(b){a[b]===c[b]&&delete a[b];var d="[object Array]"===Object.prototype.toString.call(a[b])&&"[object Array]"===Object.prototype.toString.call(c[b]);d&&0===a[b].length&&0===c[b].length&&delete a[b]}),a},toString:function(){return"#<fabric."+f(this.type)+">"},getObjectScaling:function(){var a=this.scaleX,b=this.scaleY;if(this.group){var c=this.group.getObjectScaling();a*=c.scaleX,b*=c.scaleY}return{scaleX:a,scaleY:b}},_set:function(a,c){var d="scaleX"===a||"scaleY"===a;return d&&(c=this._constrainScale(c)),"scaleX"===a&&c<0?(this.flipX=!this.flipX,c*=-1):"scaleY"===a&&c<0?(this.flipY=!this.flipY,c*=-1):"shadow"!==a||!c||c instanceof b.Shadow?"dirty"===a&&this.group&&this.group.set("dirty",c):c=new b.Shadow(c),this[a]=c,this.cacheProperties.indexOf(a)>-1&&(this.group&&this.group.set("dirty",!0),this.dirty=!0),this.group&&this.stateProperties.indexOf(a)>-1&&this.group.set("dirty",!0),("width"===a||"height"===a)&&(this.minScaleLimit=Math.min(.1,1/Math.max(this.width,this.height))),this},setOnGroup:function(){},setSourcePath:function(a){return this.sourcePath=a,this},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:b.iMatrix.concat()},render:function(a,c){0===this.width&&0===this.height||!this.visible||(!this.canvas||!this.canvas.skipOffscreen||this.group||this.isOnScreen())&&(a.save(),this._setupCompositeOperation(a),this.drawSelectionBackground(a),c||this.transform(a),this._setOpacity(a),this._setShadow(a),this.transformMatrix&&a.transform.apply(a,this.transformMatrix),this.clipTo&&b.util.clipContext(this,a),this.shouldCache(c)?(this._cacheCanvas||this._createCacheCanvas(),this.isCacheDirty(c)&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,c),this.dirty=!1),this.drawCacheOnCanvas(a)):(this.drawObject(a,c),c&&this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),this.clipTo&&a.restore(),a.restore())},needsItsOwnCache:function(){return!1},shouldCache:function(a){return!a&&this.objectCaching&&(!this.group||this.needsItsOwnCache()||!this.group.isCaching())},willDrawShadow:function(){return!!this.shadow},drawObject:function(a,b){this._renderBackground(a),this._setStrokeStyles(a),this._setFillStyles(a),this._render(a,b)},drawCacheOnCanvas:function(a){a.scale(1/this.zoomX,1/this.zoomY),a.drawImage(this._cacheCanvas,-this.cacheWidth/2,-this.cacheHeight/2)},isCacheDirty:function(a){if(!a&&this._updateCacheCanvas())return!0;if(this.dirty||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(!a){var b=this.cacheWidth/this.zoomX,c=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-b/2,-c/2,b,c)}return!0}return!1},_renderBackground:function(a){if(this.backgroundColor){var b=this._getNonTransformedDimensions();a.fillStyle=this.backgroundColor,a.fillRect(-b.x/2,-b.y/2,b.x,b.y),this._removeShadow(a)}},_setOpacity:function(a){a.globalAlpha*=this.opacity},_setStrokeStyles:function(a){this.stroke&&(a.lineWidth=this.strokeWidth,a.lineCap=this.strokeLineCap,a.lineJoin=this.strokeLineJoin,a.miterLimit=this.strokeMiterLimit,a.strokeStyle=this.stroke.toLive?this.stroke.toLive(a,this):this.stroke)},_setFillStyles:function(a){this.fill&&(a.fillStyle=this.fill.toLive?this.fill.toLive(a,this):this.fill)},_setLineDash:function(a,b,c){b&&(1&b.length&&b.push.apply(b,b),h?a.setLineDash(b):c&&c(a))},_renderControls:function(a){if(this.active&&(!this.group||this.group===this.canvas.getActiveGroup())){var e,c=this.getViewportTransform(),d=this.calcTransformMatrix();d=b.util.multiplyTransformMatrices(c,d),e=b.util.qrDecompose(d),a.save(),a.translate(e.translateX,e.translateY),a.lineWidth=1*this.borderScaleFactor,this.group||(a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.group&&this.group===this.canvas.getActiveGroup()?(a.rotate(g(e.angle)),this.drawBordersInGroup(a,e)):(a.rotate(g(this.angle)),this.drawBorders(a)),this.drawControls(a),a.restore()}},_setShadow:function(a){if(this.shadow){var c=this.canvas&&this.canvas.viewportTransform[0]||1,d=this.canvas&&this.canvas.viewportTransform[3]||1,e=this.getObjectScaling();this.canvas&&this.canvas._isRetinaScaling()&&(c*=b.devicePixelRatio,d*=b.devicePixelRatio),a.shadowColor=this.shadow.color,a.shadowBlur=this.shadow.blur*(c+d)*(e.scaleX+e.scaleY)/4,a.shadowOffsetX=this.shadow.offsetX*c*e.scaleX,a.shadowOffsetY=this.shadow.offsetY*d*e.scaleY}},_removeShadow:function(a){this.shadow&&(a.shadowColor="",a.shadowBlur=a.shadowOffsetX=a.shadowOffsetY=0)},_applyPatternGradientTransform:function(a,b){if(b.toLive){var c=b.gradientTransform||b.patternTransform;c&&a.transform.apply(a,c);var d=-this.width/2+b.offsetX||0,e=-this.height/2+b.offsetY||0;a.translate(d,e)}},_renderFill:function(a){this.fill&&(a.save(),this._applyPatternGradientTransform(a,this.fill),"evenodd"===this.fillRule?a.fill("evenodd"):a.fill(),a.restore())},_renderStroke:function(a){this.stroke&&0!==this.strokeWidth&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(a),a.save(),this._setLineDash(a,this.strokeDashArray,this._renderDashedStroke),this._applyPatternGradientTransform(a,this.stroke),a.stroke(),a.restore())},clone:function(a,c){return this.constructor.fromObject?this.constructor.fromObject(this.toObject(c),a):new b.Object(this.toObject(c))},cloneAsImage:function(a,c){var d=this.toDataURL(c);return b.util.loadImage(d,function(c){a&&a(new b.Image(c))}),this},toDataURL:function(a){a||(a={});var c=b.util.createCanvasElement(),d=this.getBoundingRect();c.width=d.width,c.height=d.height,b.util.wrapElement(c,"div");var e=new b.StaticCanvas(c,{enableRetinaScaling:a.enableRetinaScaling});"jpg"===a.format&&(a.format="jpeg"),"jpeg"===a.format&&(e.backgroundColor="#fff");var f={active:this.get("active"),left:this.getLeft(),top:this.getTop()};this.set("active",!1),this.setPositionByOrigin(new b.Point(e.getWidth()/2,e.getHeight()/2),"center","center");var g=this.canvas;e.add(this);var h=e.toDataURL(a);return this.set(f).setCoords(),this.canvas=g,e.dispose(),e=null,h},isType:function(a){return this.type===a},complexity:function(){return 1},toJSON:function(a){return this.toObject(a)},setGradient:function(a,c){c||(c={});var d={colorStops:[]};return d.type=c.type||(c.r1||c.r2?"radial":"linear"),d.coords={x1:c.x1,y1:c.y1,x2:c.x2,y2:c.y2},(c.r1||c.r2)&&(d.coords.r1=c.r1,d.coords.r2=c.r2),d.gradientTransform=c.gradientTransform,b.Gradient.prototype.addColorStop.call(d,c.colorStops),this.set(a,b.Gradient.forObject(this,d))},setPatternFill:function(a){return this.set("fill",new b.Pattern(a))},setShadow:function(a){return this.set("shadow",a?new b.Shadow(a):null)},setColor:function(a){return this.set("fill",a),this},setAngle:function(a){var b=("center"!==this.originX||"center"!==this.originY)&&this.centeredRotation;return b&&this._setOriginToCenter(),this.set("angle",a),b&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},remove:function(){return this.canvas&&this.canvas.remove(this),this},getLocalPointer:function(a,c){c=c||this.canvas.getPointer(a);var d=new b.Point(c.x,c.y),e=this._getLeftTopCoords();return this.angle&&(d=b.util.rotatePoint(d,e,g(-this.angle))),{x:d.x-e.x,y:d.y-e.y}},_setupCompositeOperation:function(a){this.globalCompositeOperation&&(a.globalCompositeOperation=this.globalCompositeOperation)}}),b.util.createAccessors(b.Object),b.Object.prototype.rotate=b.Object.prototype.setAngle,c(b.Object.prototype,b.Observable),b.Object.NUM_FRACTION_DIGITS=2,b.Object._fromObject=function(a,c,e,f,g){var h=b[a];if(c=d(c,!0),!f){var i=g?new h(c[g],c):new h(c);return e&&e(i),i}b.util.enlivenPatterns([c.fill,c.stroke],function(a){"undefined"!==typeof a[0]&&(c.fill=a[0]),"undefined"!==typeof a[1]&&(c.stroke=a[1]);var b=g?new h(c[g],c):new h(c);e&&e(b)})},b.Object.__uid=0)}("undefined"!==typeof exports?exports:this),function(){var a=fabric.util.degreesToRadians,b={left:-.5,center:0,right:.5},c={top:-.5,center:0,bottom:.5};fabric.util.object.extend(fabric.Object.prototype,{translateToGivenOrigin:function(a,d,e,f,g){var j,k,l,h=a.x,i=a.y;return"string"===typeof d?d=b[d]:d-=.5,"string"===typeof f?f=b[f]:f-=.5,j=f-d,"string"===typeof e?e=c[e]:e-=.5,"string"===typeof g?g=c[g]:g-=.5,k=g-e,(j||k)&&(l=this._getTransformedDimensions(),h=a.x+j*l.x,i=a.y+k*l.y),new fabric.Point(h,i)},translateToCenterPoint:function(b,c,d){var e=this.translateToGivenOrigin(b,c,d,"center","center");return this.angle?fabric.util.rotatePoint(e,b,a(this.angle)):e},translateToOriginPoint:function(b,c,d){var e=this.translateToGivenOrigin(b,"center","center",c,d);return this.angle?fabric.util.rotatePoint(e,b,a(this.angle)):e
},getCenterPoint:function(){var a=new fabric.Point(this.left,this.top);return this.translateToCenterPoint(a,this.originX,this.originY)},getPointByOrigin:function(a,b){var c=this.getCenterPoint();return this.translateToOriginPoint(c,a,b)},toLocalPoint:function(b,c,d){var f,g,e=this.getCenterPoint();return f="undefined"!==typeof c&&"undefined"!==typeof d?this.translateToGivenOrigin(e,"center","center",c,d):new fabric.Point(this.left,this.top),g=new fabric.Point(b.x,b.y),this.angle&&(g=fabric.util.rotatePoint(g,e,-a(this.angle))),g.subtractEquals(f)},setPositionByOrigin:function(a,b,c){var d=this.translateToCenterPoint(a,b,c),e=this.translateToOriginPoint(d,this.originX,this.originY);this.set("left",e.x),this.set("top",e.y)},adjustPosition:function(c){var h,i,d=a(this.angle),e=this.getWidth(),f=Math.cos(d)*e,g=Math.sin(d)*e;h="string"===typeof this.originX?b[this.originX]:this.originX-.5,i="string"===typeof c?b[c]:c-.5,this.left+=f*(i-h),this.top+=g*(i-h),this.setCoords(),this.originX=c},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var a=this.getCenterPoint();this.originX="center",this.originY="center",this.left=a.x,this.top=a.y},_resetOrigin:function(){var a=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=a.x,this.top=a.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")},onDeselect:function(){}})}(),function(){function a(a){return[new fabric.Point(a.tl.x,a.tl.y),new fabric.Point(a.tr.x,a.tr.y),new fabric.Point(a.br.x,a.br.y),new fabric.Point(a.bl.x,a.bl.y)]}var b=fabric.util.degreesToRadians,c=fabric.util.multiplyTransformMatrices;fabric.util.object.extend(fabric.Object.prototype,{oCoords:null,aCoords:null,getCoords:function(b,c){this.oCoords||this.setCoords();var d=b?this.aCoords:this.oCoords;return a(c?this.calcCoords(b):d)},intersectsWithRect:function(a,b,c,d){var e=this.getCoords(c,d),f=fabric.Intersection.intersectPolygonRectangle(e,a,b);return"Intersection"===f.status},intersectsWithObject:function(a,b,c){var d=fabric.Intersection.intersectPolygonPolygon(this.getCoords(b,c),a.getCoords(b,c));return"Intersection"===d.status||a.isContainedWithinObject(this,b,c)||this.isContainedWithinObject(a,b,c)},isContainedWithinObject:function(a,b,c){for(var d=this.getCoords(b,c),e=0,f=a._getImageLines(c?a.calcCoords(b):b?a.aCoords:a.oCoords);e<4;e++)if(!a.containsPoint(d[e],f))return!1;return!0},isContainedWithinRect:function(a,b,c,d){var e=this.getBoundingRect(c,d);return e.left>=a.x&&e.left+e.width<=b.x&&e.top>=a.y&&e.top+e.height<=b.y},containsPoint:function(a,b,c,d){var b=b||this._getImageLines(d?this.calcCoords(c):c?this.aCoords:this.oCoords),e=this._findCrossPoints(a,b);return 0!==e&&e%2===1},isOnScreen:function(a){if(!this.canvas)return!1;for(var e,b=this.canvas.vptCoords.tl,c=this.canvas.vptCoords.br,d=this.getCoords(!0,a),f=0;f<4;f++)if(e=d[f],e.x<=c.x&&e.x>=b.x&&e.y<=c.y&&e.y>=b.y)return!0;if(this.intersectsWithRect(b,c,!0))return!0;var g={x:(b.x+c.x)/2,y:(b.y+c.y)/2};return this.containsPoint(g,null,!0)?!0:!1},_getImageLines:function(a){return{topline:{o:a.tl,d:a.tr},rightline:{o:a.tr,d:a.br},bottomline:{o:a.br,d:a.bl},leftline:{o:a.bl,d:a.tl}}},_findCrossPoints:function(a,b){var c,d,e,f,g,i,h=0;for(var j in b)if(i=b[j],!(i.o.y<a.y&&i.d.y<a.y)&&!(i.o.y>=a.y&&i.d.y>=a.y)&&(i.o.x===i.d.x&&i.o.x>=a.x?g=i.o.x:(c=0,d=(i.d.y-i.o.y)/(i.d.x-i.o.x),e=a.y-c*a.x,f=i.o.y-d*i.o.x,g=-(e-f)/(c-d)),g>=a.x&&(h+=1),2===h))break;return h},getBoundingRectWidth:function(){return this.getBoundingRect().width},getBoundingRectHeight:function(){return this.getBoundingRect().height},getBoundingRect:function(a,b){var c=this.getCoords(a,b);return fabric.util.makeBoundingBoxFromPoints(c)},getWidth:function(){return this._getTransformedDimensions().x},getHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(a){return Math.abs(a)<this.minScaleLimit?a<0?-this.minScaleLimit:this.minScaleLimit:a},scale:function(a){return a=this._constrainScale(a),a<0&&(this.flipX=!this.flipX,this.flipY=!this.flipY,a*=-1),this.scaleX=a,this.scaleY=a,this.setCoords()},scaleToWidth:function(a){var b=this.getBoundingRect().width/this.getWidth();return this.scale(a/this.width/b)},scaleToHeight:function(a){var b=this.getBoundingRect().height/this.getHeight();return this.scale(a/this.height/b)},calcCoords:function(a){var c=b(this.angle),d=this.getViewportTransform(),e=a?this._getTransformedDimensions():this._calculateCurrentDimensions(),f=e.x,g=e.y,h=Math.sin(c),i=Math.cos(c),j=f>0?Math.atan(g/f):0,k=f/Math.cos(j)/2,l=Math.cos(j+c)*k,m=Math.sin(j+c)*k,n=this.getCenterPoint(),o=a?n:fabric.util.transformPoint(n,d),p=new fabric.Point(o.x-l,o.y-m),q=new fabric.Point(p.x+f*i,p.y+f*h),r=new fabric.Point(p.x-g*h,p.y+g*i),s=new fabric.Point(o.x+l,o.y+m);if(!a)var t=new fabric.Point((p.x+r.x)/2,(p.y+r.y)/2),u=new fabric.Point((q.x+p.x)/2,(q.y+p.y)/2),v=new fabric.Point((s.x+q.x)/2,(s.y+q.y)/2),w=new fabric.Point((s.x+r.x)/2,(s.y+r.y)/2),x=new fabric.Point(u.x+h*this.rotatingPointOffset,u.y-i*this.rotatingPointOffset);var o={tl:p,tr:q,br:s,bl:r};return a||(o.ml=t,o.mt=u,o.mr=v,o.mb=w,o.mtr=x),o},setCoords:function(a,b){return this.oCoords=this.calcCoords(a),b||(this.aCoords=this.calcCoords(!0)),a||this._setCornerCoords&&this._setCornerCoords(),this},_calcRotateMatrix:function(){if(this.angle){var a=b(this.angle),c=Math.cos(a),d=Math.sin(a);return(6.123233995736766e-17===c||-1.8369701987210297e-16===c)&&(c=0),[c,d,-d,c,0,0]}return fabric.iMatrix.concat()},calcTransformMatrix:function(a){var b=this.getCenterPoint(),d=[1,0,0,1,b.x,b.y],e=this._calcRotateMatrix(),f=this._calcDimensionsTransformMatrix(this.skewX,this.skewY,!0),g=this.group&&!a?this.group.calcTransformMatrix():fabric.iMatrix.concat();return g=c(g,d),g=c(g,e),g=c(g,f)},_calcDimensionsTransformMatrix:function(a,d,e){var f=[1,0,Math.tan(b(a)),1],g=[1,Math.tan(b(d)),0,1],h=this.scaleX*(e&&this.flipX?-1:1),i=this.scaleY*(e&&this.flipY?-1:1),j=[h,0,0,i],k=c(j,f,!0);return c(k,g,!0)},_getNonTransformedDimensions:function(){var a=this.strokeWidth,b=this.width+a,c=this.height+a;return{x:b,y:c}},_getTransformedDimensions:function(a,b){"undefined"===typeof a&&(a=this.skewX),"undefined"===typeof b&&(b=this.skewY);var g,i,c=this._getNonTransformedDimensions(),d=c.x/2,e=c.y/2,f=[{x:-d,y:-e},{x:d,y:-e},{x:-d,y:e},{x:d,y:e}],h=this._calcDimensionsTransformMatrix(a,b,!1);for(g=0;g<f.length;g++)f[g]=fabric.util.transformPoint(f[g],h);return i=fabric.util.makeBoundingBoxFromPoints(f),{x:i.width,y:i.height}},_calculateCurrentDimensions:function(){var a=this.getViewportTransform(),b=this._getTransformedDimensions(),c=fabric.util.transformPoint(b,a,!0);return c.scalarAdd(2*this.padding)}})}(),fabric.util.object.extend(fabric.Object.prototype,{sendToBack:function(){return this.group?fabric.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?fabric.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas.bringToFront(this),this},sendBackwards:function(a){return this.group?fabric.StaticCanvas.prototype.sendBackwards.call(this.group,this,a):this.canvas.sendBackwards(this,a),this},bringForward:function(a){return this.group?fabric.StaticCanvas.prototype.bringForward.call(this.group,this,a):this.canvas.bringForward(this,a),this},moveTo:function(a){return this.group?fabric.StaticCanvas.prototype.moveTo.call(this.group,this,a):this.canvas.moveTo(this,a),this}}),function(){function a(a,b){if(b){if(b.toLive)return a+": url(#SVGID_"+b.id+"); ";var c=new fabric.Color(b),d=a+": "+c.toRgb()+"; ",e=c.getAlpha();return 1!==e&&(d+=a+"-opacity: "+e.toString()+"; "),d}return a+": none; "}fabric.util.object.extend(fabric.Object.prototype,{getSvgStyles:function(b){var c=this.fillRule,d=this.strokeWidth?this.strokeWidth:"0",e=this.strokeDashArray?this.strokeDashArray.join(" "):"none",f=this.strokeLineCap?this.strokeLineCap:"butt",g=this.strokeLineJoin?this.strokeLineJoin:"miter",h=this.strokeMiterLimit?this.strokeMiterLimit:"4",i="undefined"!==typeof this.opacity?this.opacity:"1",j=this.visible?"":" visibility: hidden;",k=b?"":this.getSvgFilter(),l=a("fill",this.fill),m=a("stroke",this.stroke);return[m,"stroke-width: ",d,"; ","stroke-dasharray: ",e,"; ","stroke-linecap: ",f,"; ","stroke-linejoin: ",g,"; ","stroke-miterlimit: ",h,"; ",l,"fill-rule: ",c,"; ","opacity: ",i,";",k,j].join("")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgId:function(){return this.id?'id="'+this.id+'" ':""},getSvgTransform:function(){if(this.group&&"path-group"===this.group.type)return"";var a=fabric.util.toFixed,b=this.getAngle(),c=this.getSkewX()%360,d=this.getSkewY()%360,e=this.getCenterPoint(),f=fabric.Object.NUM_FRACTION_DIGITS,g="path-group"===this.type?"":"translate("+a(e.x,f)+" "+a(e.y,f)+")",h=0!==b?" rotate("+a(b,f)+")":"",i=1===this.scaleX&&1===this.scaleY?"":" scale("+a(this.scaleX,f)+" "+a(this.scaleY,f)+")",j=0!==c?" skewX("+a(c,f)+")":"",k=0!==d?" skewY("+a(d,f)+")":"",l="path-group"===this.type?this.width:0,m=this.flipX?" matrix(-1 0 0 1 "+l+" 0) ":"",n="path-group"===this.type?this.height:0,o=this.flipY?" matrix(1 0 0 -1 0 "+n+")":"";return[g,h,i,m,o,j,k].join("")},getSvgTransformMatrix:function(){return this.transformMatrix?" matrix("+this.transformMatrix.join(" ")+") ":""},_createBaseSVGMarkup:function(){var a=[];return this.fill&&this.fill.toLive&&a.push(this.fill.toSVG(this,!1)),this.stroke&&this.stroke.toLive&&a.push(this.stroke.toSVG(this,!1)),this.shadow&&a.push(this.shadow.toSVG(this)),a}})}(),function(){function c(b,c,d){var e={},f=!0;d.forEach(function(a){e[a]=b[a]}),a(b[c],e,f)}function d(a,b,c){if(!fabric.isLikelyNode&&a instanceof Element)return a===b;if(a instanceof Array){if(a.length!==b.length)return!1;for(var e=0,f=a.length;e<f;e++)if(a[e]!==b[e])return!1;return!0}if(a&&"object"===typeof a){if(!c&&Object.keys(a).length!==Object.keys(b).length)return!1;for(var g in a)if(!d(a[g],b[g]))return!1;return!0}return a===b}var a=fabric.util.object.extend,b="stateProperties";fabric.util.object.extend(fabric.Object.prototype,{hasStateChanged:function(a){return a=a||b,a="_"+a,Object.keys(this[a]).length?!d(this[a],this,!0):!0},saveState:function(a){var d=a&&a.propertySet||b,e="_"+d;return this[e]?(c(this,e,this[d]),a&&a.stateProperties&&c(this,e,a.stateProperties),this):this.setupState(a)},setupState:function(a){a=a||{};var c=a.propertySet||b;return a.propertySet=c,this["_"+c]={},this.saveState(a),this}})}(),function(){var a=fabric.util.degreesToRadians,b=function(){return"undefined"!==typeof G_vmlCanvasManager};fabric.util.object.extend(fabric.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(a){if(!this.hasControls||!this.active)return!1;var d,e,b=a.x,c=a.y;this.__corner=0;for(var f in this.oCoords)if(this.isControlVisible(f)&&("mtr"!==f||this.hasRotatingPoint)&&(!this.get("lockUniScaling")||"mt"!==f&&"mr"!==f&&"mb"!==f&&"ml"!==f)&&(e=this._getImageLines(this.oCoords[f].corner),d=this._findCrossPoints({x:b,y:c},e),0!==d&&d%2===1))return this.__corner=f,f;return!1},_setCornerCoords:function(){var g,h,b=this.oCoords,c=a(45-this.angle),d=.707106*this.cornerSize,e=d*Math.cos(c),f=d*Math.sin(c);for(var i in b)g=b[i].x,h=b[i].y,b[i].corner={tl:{x:g-f,y:h-e},tr:{x:g+e,y:h-f},bl:{x:g-e,y:h+f},br:{x:g+f,y:h+e}}},drawSelectionBackground:function(b){if(!this.selectionBackgroundColor||this.group||!this.active||this.canvas&&!this.canvas.interactive)return this;b.save();var c=this.getCenterPoint(),d=this._calculateCurrentDimensions(),e=this.canvas.viewportTransform;return b.translate(c.x,c.y),b.scale(1/e[0],1/e[3]),b.rotate(a(this.angle)),b.fillStyle=this.selectionBackgroundColor,b.fillRect(-d.x/2,-d.y/2,d.x,d.y),b.restore(),this},drawBorders:function(a){if(!this.hasBorders)return this;var b=this._calculateCurrentDimensions(),c=1/this.borderScaleFactor,d=b.x+c,e=b.y+c;if(a.save(),a.strokeStyle=this.borderColor,this._setLineDash(a,this.borderDashArray,null),a.strokeRect(-d/2,-e/2,d,e),this.hasRotatingPoint&&this.isControlVisible("mtr")&&!this.get("lockRotation")&&this.hasControls){var f=-e/2;a.beginPath(),a.moveTo(0,f),a.lineTo(0,f-this.rotatingPointOffset),a.closePath(),a.stroke()}return a.restore(),this},drawBordersInGroup:function(a,b){if(!this.hasBorders)return this;var c=this._getNonTransformedDimensions(),d=fabric.util.customTransformMatrix(b.scaleX,b.scaleY,b.skewX),e=fabric.util.transformPoint(c,d),f=1/this.borderScaleFactor,g=e.x+f,h=e.y+f;return a.save(),this._setLineDash(a,this.borderDashArray,null),a.strokeStyle=this.borderColor,a.strokeRect(-g/2,-h/2,g,h),a.restore(),this},drawControls:function(a){if(!this.hasControls)return this;var b=this._calculateCurrentDimensions(),c=b.x,d=b.y,e=this.cornerSize,f=-(c+e)/2,g=-(d+e)/2,h=this.transparentCorners?"stroke":"fill";return a.save(),a.strokeStyle=a.fillStyle=this.cornerColor,this.transparentCorners||(a.strokeStyle=this.cornerStrokeColor),this._setLineDash(a,this.cornerDashArray,null),this._drawControl("tl",a,h,f,g),this._drawControl("tr",a,h,f+c,g),this._drawControl("bl",a,h,f,g+d),this._drawControl("br",a,h,f+c,g+d),this.get("lockUniScaling")||(this._drawControl("mt",a,h,f+c/2,g),this._drawControl("mb",a,h,f+c/2,g+d),this._drawControl("mr",a,h,f+c,g+d/2),this._drawControl("ml",a,h,f,g+d/2)),this.hasRotatingPoint&&this._drawControl("mtr",a,h,f+c/2,g-this.rotatingPointOffset),a.restore(),this},_drawControl:function(a,c,d,e,f){if(this.isControlVisible(a)){var g=this.cornerSize,h=!this.transparentCorners&&this.cornerStrokeColor;switch(this.cornerStyle){case"circle":c.beginPath(),c.arc(e+g/2,f+g/2,g/2,0,2*Math.PI,!1),c[d](),h&&c.stroke();break;default:b()||this.transparentCorners||c.clearRect(e,f,g,g),c[d+"Rect"](e,f,g,g),h&&c.strokeRect(e,f,g,g)}}},isControlVisible:function(a){return this._getControlsVisibility()[a]},setControlVisible:function(a,b){return this._getControlsVisibility()[a]=b,this},setControlsVisibility:function(a){a||(a={});for(var b in a)this.setControlVisible(b,a[b]);return this},_getControlsVisibility:function(){return this._controlsVisibility||(this._controlsVisibility={tl:!0,tr:!0,br:!0,bl:!0,ml:!0,mt:!0,mr:!0,mb:!0,mtr:!0}),this._controlsVisibility}})}(),fabric.util.object.extend(fabric.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(a,b){b=b||{};var c=function(){},d=b.onComplete||c,e=b.onChange||c,f=this;return fabric.util.animate({startValue:a.get("left"),endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(b){a.set("left",b),f.renderAll(),e()},onComplete:function(){a.setCoords(),d()}}),this},fxCenterObjectV:function(a,b){b=b||{};var c=function(){},d=b.onComplete||c,e=b.onChange||c,f=this;return fabric.util.animate({startValue:a.get("top"),endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(b){a.set("top",b),f.renderAll(),e()},onComplete:function(){a.setCoords(),d()}}),this},fxRemove:function(a,b){b=b||{};var c=function(){},d=b.onComplete||c,e=b.onChange||c,f=this;return fabric.util.animate({startValue:a.get("opacity"),endValue:0,duration:this.FX_DURATION,onStart:function(){a.set("active",!1)},onChange:function(b){a.set("opacity",b),f.renderAll(),e()},onComplete:function(){f.remove(a),d()}}),this}}),fabric.util.object.extend(fabric.Object.prototype,{animate:function(){if(arguments[0]&&"object"===typeof arguments[0]){var b,c,a=[];for(b in arguments[0])a.push(b);for(var d=0,e=a.length;d<e;d++)b=a[d],c=d!==e-1,this._animate(b,arguments[0][b],arguments[1],c)}else this._animate.apply(this,arguments);return this},_animate:function(a,b,c,d){var f,e=this;b=b.toString(),c=c?fabric.util.object.clone(c):{},~a.indexOf(".")&&(f=a.split("."));var g=f?this.get(f[0])[f[1]]:this.get(a);"from"in c||(c.from=g),b=~b.indexOf("=")?g+parseFloat(b.replace("=","")):parseFloat(b),fabric.util.animate({startValue:c.from,endValue:b,byValue:c.by,easing:c.easing,duration:c.duration,abort:c.abort&&function(){return c.abort.call(e)},onChange:function(b){f?e[f[0]][f[1]]=b:e.set(a,b),d||c.onChange&&c.onChange()},onComplete:function(){d||(e.setCoords(),c.onComplete&&c.onComplete())}})}}),function(a){"use strict";function h(a,b){var c=a.origin,d=a.axis1,e=a.axis2,f=a.dimension,g=b.nearest,h=b.center,i=b.farthest;return function(){switch(this.get(c)){case g:return Math.min(this.get(d),this.get(e));case h:return Math.min(this.get(d),this.get(e))+.5*this.get(f);case i:return Math.max(this.get(d),this.get(e))}}}var b=a.fabric||(a.fabric={}),c=b.util.object.extend,d=b.util.object.clone,e={x1:1,x2:1,y1:1,y2:1},f=b.StaticCanvas.supports("setLineDash");if(b.Line)return void b.warn("fabric.Line is already defined");var g=b.Object.prototype.cacheProperties.concat();g.push("x1","x2","y1","y2"),b.Line=b.util.createClass(b.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:g,initialize:function(a,b){a||(a=[0,0,0,0]),this.callSuper("initialize",b),this.set("x1",a[0]),this.set("y1",a[1]),this.set("x2",a[2]),this.set("y2",a[3]),this._setWidthHeight(b)},_setWidthHeight:function(a){a||(a={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in a?a.left:this._getLeftToOriginX(),this.top="top"in a?a.top:this._getTopToOriginY()},_set:function(a,b){return this.callSuper("_set",a,b),"undefined"!==typeof e[a]&&this._setWidthHeight(),this},_getLeftToOriginX:h({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:h({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(a,b){if(a.beginPath(),b){var c=this.getCenterPoint(),d=this.strokeWidth/2;a.translate(c.x-("butt"===this.strokeLineCap&&0===this.height?0:d),c.y-("butt"===this.strokeLineCap&&0===this.width?0:d))}if(!this.strokeDashArray||this.strokeDashArray&&f){var e=this.calcLinePoints();a.moveTo(e.x1,e.y1),a.lineTo(e.x2,e.y2)}a.lineWidth=this.strokeWidth;var g=a.strokeStyle;a.strokeStyle=this.stroke||a.fillStyle,this.stroke&&this._renderStroke(a),a.strokeStyle=g},_renderDashedStroke:function(a){var c=this.calcLinePoints();a.beginPath(),b.util.drawDashedLine(a,c.x1,c.y1,c.x2,c.y2,this.strokeDashArray),a.closePath()},toObject:function(a){return c(this.callSuper("toObject",a),this.calcLinePoints())},_getNonTransformedDimensions:function(){var a=this.callSuper("_getNonTransformedDimensions");return"butt"===this.strokeLineCap&&(0===this.width&&(a.y-=this.strokeWidth),0===this.height&&(a.x-=this.strokeWidth)),a},calcLinePoints:function(){var a=this.x1<=this.x2?-1:1,b=this.y1<=this.y2?-1:1,c=a*this.width*.5,d=b*this.height*.5,e=a*this.width*-.5,f=b*this.height*-.5;return{x1:c,x2:e,y1:d,y2:f}},toSVG:function(a){var b=this._createBaseSVGMarkup(),c={x1:this.x1,x2:this.x2,y1:this.y1,y2:this.y2};return this.group&&"path-group"===this.group.type||(c=this.calcLinePoints()),b.push("<line ",this.getSvgId(),'x1="',c.x1,'" y1="',c.y1,'" x2="',c.x2,'" y2="',c.y2,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n'),a?a(b.join("")):b.join("")}}),b.Line.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),b.Line.fromElement=function(a,d){d=d||{};var e=b.parseAttributes(a,b.Line.ATTRIBUTE_NAMES),f=[e.x1||0,e.y1||0,e.x2||0,e.y2||0];return d.originX="left",d.originY="top",new b.Line(f,c(e,d))},b.Line.fromObject=function(a,c,e){function f(a){delete a.points,c&&c(a)}var g=d(a,!0);g.points=[a.x1,a.y1,a.x2,a.y2];var h=b.Object._fromObject("Line",g,f,e,"points");return h&&delete h.points,h}}("undefined"!==typeof exports?exports:this),function(a){"use strict";function f(a){return"radius"in a&&a.radius>=0}var b=a.fabric||(a.fabric={}),c=Math.PI,d=b.util.object.extend;if(b.Circle)return void b.warn("fabric.Circle is already defined.");var e=b.Object.prototype.cacheProperties.concat();e.push("radius"),b.Circle=b.util.createClass(b.Object,{type:"circle",radius:0,startAngle:0,endAngle:2*c,cacheProperties:e,initialize:function(a){this.callSuper("initialize",a),this.set("radius",a&&a.radius||0)},_set:function(a,b){return this.callSuper("_set",a,b),"radius"===a&&this.setRadius(b),this},toObject:function(a){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(a))},toSVG:function(a){var b=this._createBaseSVGMarkup(),d=0,e=0,f=(this.endAngle-this.startAngle)%(2*c);if(0===f)this.group&&"path-group"===this.group.type&&(d=this.left+this.radius,e=this.top+this.radius),b.push("<circle ",this.getSvgId(),'cx="'+d+'" cy="'+e+'" ','r="',this.radius,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n');else{var g=Math.cos(this.startAngle)*this.radius,h=Math.sin(this.startAngle)*this.radius,i=Math.cos(this.endAngle)*this.radius,j=Math.sin(this.endAngle)*this.radius,k=f>c?"1":"0";b.push('<path d="M '+g+" "+h," A "+this.radius+" "+this.radius," 0 ",+k+" 1"," "+i+" "+j,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n')}return a?a(b.join("")):b.join("")},_render:function(a,b){a.beginPath(),a.arc(b?this.left+this.radius:0,b?this.top+this.radius:0,this.radius,this.startAngle,this.endAngle,!1),this._renderFill(a),this._renderStroke(a)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(a){return this.radius=a,this.set("width",2*a).set("height",2*a)}}),b.Circle.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),b.Circle.fromElement=function(a,c){c||(c={});var e=b.parseAttributes(a,b.Circle.ATTRIBUTE_NAMES);if(!f(e))throw new Error("value of `r` attribute is required and can not be negative");e.left=e.left||0,e.top=e.top||0;var g=new b.Circle(d(e,c));return g.left-=g.radius,g.top-=g.radius,g},b.Circle.fromObject=function(a,c,d){return b.Object._fromObject("Circle",a,c,d)}}("undefined"!==typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={});return b.Triangle?void b.warn("fabric.Triangle is already defined"):(b.Triangle=b.util.createClass(b.Object,{type:"triangle",initialize:function(a){this.callSuper("initialize",a),this.set("width",a&&a.width||100).set("height",a&&a.height||100)},_render:function(a){var b=this.width/2,c=this.height/2;a.beginPath(),a.moveTo(-b,c),a.lineTo(0,-c),a.lineTo(b,c),a.closePath(),this._renderFill(a),this._renderStroke(a)},_renderDashedStroke:function(a){var c=this.width/2,d=this.height/2;a.beginPath(),b.util.drawDashedLine(a,-c,d,0,-d,this.strokeDashArray),b.util.drawDashedLine(a,0,-d,c,d,this.strokeDashArray),b.util.drawDashedLine(a,c,d,-c,d,this.strokeDashArray),a.closePath()},toSVG:function(a){var b=this._createBaseSVGMarkup(),c=this.width/2,d=this.height/2,e=[-c+" "+d,"0 "+-d,c+" "+d].join(",");return b.push("<polygon ",this.getSvgId(),'points="',e,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),a?a(b.join("")):b.join("")}}),void(b.Triangle.fromObject=function(a,c,d){return b.Object._fromObject("Triangle",a,c,d)}))}("undefined"!==typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=2*Math.PI,d=b.util.object.extend;if(b.Ellipse)return void b.warn("fabric.Ellipse is already defined.");var e=b.Object.prototype.cacheProperties.concat();e.push("rx","ry"),b.Ellipse=b.util.createClass(b.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:e,initialize:function(a){this.callSuper("initialize",a),this.set("rx",a&&a.rx||0),this.set("ry",a&&a.ry||0)},_set:function(a,b){switch(this.callSuper("_set",a,b),a){case"rx":this.rx=b,this.set("width",2*b);break;case"ry":this.ry=b,this.set("height",2*b)}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(a){return this.callSuper("toObject",["rx","ry"].concat(a))},toSVG:function(a){var b=this._createBaseSVGMarkup(),c=0,d=0;return this.group&&"path-group"===this.group.type&&(c=this.left+this.rx,d=this.top+this.ry),b.push("<ellipse ",this.getSvgId(),'cx="',c,'" cy="',d,'" ','rx="',this.rx,'" ry="',this.ry,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n'),a?a(b.join("")):b.join("")},_render:function(a,b){a.beginPath(),a.save(),a.transform(1,0,0,this.ry/this.rx,0,0),a.arc(b?this.left+this.rx:0,b?(this.top+this.ry)*this.rx/this.ry:0,this.rx,0,c,!1),a.restore(),this._renderFill(a),this._renderStroke(a)}}),b.Ellipse.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),b.Ellipse.fromElement=function(a,c){c||(c={});var e=b.parseAttributes(a,b.Ellipse.ATTRIBUTE_NAMES);e.left=e.left||0,e.top=e.top||0;var f=new b.Ellipse(d(e,c));return f.top-=f.ry,f.left-=f.rx,f},b.Ellipse.fromObject=function(a,c,d){return b.Object._fromObject("Ellipse",a,c,d)}}("undefined"!==typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend;if(b.Rect)return void b.warn("fabric.Rect is already defined");var d=b.Object.prototype.stateProperties.concat();d.push("rx","ry");var e=b.Object.prototype.cacheProperties.concat();e.push("rx","ry"),b.Rect=b.util.createClass(b.Object,{stateProperties:d,type:"rect",rx:0,ry:0,cacheProperties:e,initialize:function(a){this.callSuper("initialize",a),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(a,b){if(1===this.width&&1===this.height)return void a.fillRect(-.5,-.5,1,1);var c=this.rx?Math.min(this.rx,this.width/2):0,d=this.ry?Math.min(this.ry,this.height/2):0,e=this.width,f=this.height,g=b?this.left:-this.width/2,h=b?this.top:-this.height/2,i=0!==c||0!==d,j=.4477152502;a.beginPath(),a.moveTo(g+c,h),a.lineTo(g+e-c,h),i&&a.bezierCurveTo(g+e-j*c,h,g+e,h+j*d,g+e,h+d),a.lineTo(g+e,h+f-d),i&&a.bezierCurveTo(g+e,h+f-j*d,g+e-j*c,h+f,g+e-c,h+f),a.lineTo(g+c,h+f),i&&a.bezierCurveTo(g+j*c,h+f,g,h+f-j*d,g,h+f-d),a.lineTo(g,h+d),i&&a.bezierCurveTo(g,h+j*d,g+j*c,h,g+c,h),a.closePath(),this._renderFill(a),this._renderStroke(a)},_renderDashedStroke:function(a){var c=-this.width/2,d=-this.height/2,e=this.width,f=this.height;a.beginPath(),b.util.drawDashedLine(a,c,d,c+e,d,this.strokeDashArray),b.util.drawDashedLine(a,c+e,d,c+e,d+f,this.strokeDashArray),b.util.drawDashedLine(a,c+e,d+f,c,d+f,this.strokeDashArray),b.util.drawDashedLine(a,c,d+f,c,d,this.strokeDashArray),a.closePath()},toObject:function(a){return this.callSuper("toObject",["rx","ry"].concat(a))},toSVG:function(a){var b=this._createBaseSVGMarkup(),c=this.left,d=this.top;return this.group&&"path-group"===this.group.type||(c=-this.width/2,d=-this.height/2),b.push("<rect ",this.getSvgId(),'x="',c,'" y="',d,'" rx="',this.get("rx"),'" ry="',this.get("ry"),'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n'),a?a(b.join("")):b.join("")}}),b.Rect.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),b.Rect.fromElement=function(a,d){if(!a)return null;d=d||{};var e=b.parseAttributes(a,b.Rect.ATTRIBUTE_NAMES);e.left=e.left||0,e.top=e.top||0;var f=new b.Rect(c(d?b.util.object.clone(d):{},e));return f.visible=f.visible&&f.width>0&&f.height>0,f},b.Rect.fromObject=function(a,c,d){return b.Object._fromObject("Rect",a,c,d)}}("undefined"!==typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend,d=b.util.array.min,e=b.util.array.max,f=b.util.toFixed,g=b.Object.NUM_FRACTION_DIGITS;if(b.Polyline)return void b.warn("fabric.Polyline is already defined");var h=b.Object.prototype.cacheProperties.concat();h.push("points"),b.Polyline=b.util.createClass(b.Object,{type:"polyline",points:null,minX:0,minY:0,cacheProperties:h,initialize:function(a,b){b=b||{},this.points=a||[],this.callSuper("initialize",b),this._calcDimensions(),"top"in b||(this.top=this.minY),"left"in b||(this.left=this.minX),this.pathOffset={x:this.minX+this.width/2,y:this.minY+this.height/2}},_calcDimensions:function(){var a=this.points,b=d(a,"x"),c=d(a,"y"),f=e(a,"x"),g=e(a,"y");this.width=f-b||0,this.height=g-c||0,this.minX=b||0,this.minY=c||0},toObject:function(a){return c(this.callSuper("toObject",a),{points:this.points.concat()})},toSVG:function(a){var b=[],c=0,d=0,e=this._createBaseSVGMarkup();this.group&&"path-group"===this.group.type||(c=this.pathOffset.x,d=this.pathOffset.y);for(var h=0,i=this.points.length;h<i;h++)b.push(f(this.points[h].x-c,g),",",f(this.points[h].y-d,g)," ");return e.push("<",this.type," ",this.getSvgId(),'points="',b.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n'),a?a(e.join("")):e.join("")},commonRender:function(a,b){var c,d=this.points.length,e=b?0:this.pathOffset.x,f=b?0:this.pathOffset.y;if(!d||isNaN(this.points[d-1].y))return!1;a.beginPath(),a.moveTo(this.points[0].x-e,this.points[0].y-f);for(var g=0;g<d;g++)c=this.points[g],a.lineTo(c.x-e,c.y-f);return!0},_render:function(a,b){this.commonRender(a,b)&&(this._renderFill(a),this._renderStroke(a))},_renderDashedStroke:function(a){var c,d;a.beginPath();for(var e=0,f=this.points.length;e<f;e++)c=this.points[e],d=this.points[e+1]||c,b.util.drawDashedLine(a,c.x,c.y,d.x,d.y,this.strokeDashArray)},complexity:function(){return this.get("points").length}}),b.Polyline.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat(),b.Polyline.fromElement=function(a,c){if(!a)return null;c||(c={});var d=b.parsePointsAttribute(a.getAttribute("points")),e=b.parseAttributes(a,b.Polyline.ATTRIBUTE_NAMES);return new b.Polyline(d,b.util.object.extend(e,c))},b.Polyline.fromObject=function(a,c,d){return b.Object._fromObject("Polyline",a,c,d,"points")}}("undefined"!==typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend;return b.Polygon?void b.warn("fabric.Polygon is already defined"):(b.Polygon=b.util.createClass(b.Polyline,{type:"polygon",_render:function(a,b){this.commonRender(a,b)&&(a.closePath(),this._renderFill(a),this._renderStroke(a))},_renderDashedStroke:function(a){this.callSuper("_renderDashedStroke",a),a.closePath()}}),b.Polygon.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat(),b.Polygon.fromElement=function(a,d){if(!a)return null;d||(d={});var e=b.parsePointsAttribute(a.getAttribute("points")),f=b.parseAttributes(a,b.Polygon.ATTRIBUTE_NAMES);return new b.Polygon(e,c(f,d))},void(b.Polygon.fromObject=function(a,c,d){return b.Object._fromObject("Polygon",a,c,d,"points")}))}("undefined"!==typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.array.min,d=b.util.array.max,e=b.util.object.extend,f=Object.prototype.toString,g=b.util.drawArc,h={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},i={m:"l",M:"L"};if(b.Path)return void b.warn("fabric.Path is already defined");var j=b.Object.prototype.cacheProperties.concat();j.push("path"),b.Path=b.util.createClass(b.Object,{type:"path",path:null,minX:0,minY:0,cacheProperties:j,initialize:function(a,b){b=b||{},b&&this.setOptions(b),a||(a=[]);var c="[object Array]"===f.call(a);this.path=c?a:a.match&&a.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi),this.path&&(c||(this.path=this._parsePath()),this._setPositionDimensions(b))},_setPositionDimensions:function(a){var b=this._parseDimensions();this.minX=b.left,this.minY=b.top,this.width=b.width,this.height=b.height,"undefined"===typeof a.left&&(this.left=b.left+("center"===this.originX?this.width/2:"right"===this.originX?this.width:0)),"undefined"===typeof a.top&&(this.top=b.top+("center"===this.originY?this.height/2:"bottom"===this.originY?this.height:0)),this.pathOffset=this.pathOffset||{x:this.minX+this.width/2,y:this.minY+this.height/2}},_renderPathCommands:function(a){var b,k,l,c=null,d=0,e=0,f=0,h=0,i=0,j=0,m=-this.pathOffset.x,n=-this.pathOffset.y;
this.group&&"path-group"===this.group.type&&(m=0,n=0),a.beginPath();for(var o=0,p=this.path.length;o<p;++o){switch(b=this.path[o],b[0]){case"l":f+=b[1],h+=b[2],a.lineTo(f+m,h+n);break;case"L":f=b[1],h=b[2],a.lineTo(f+m,h+n);break;case"h":f+=b[1],a.lineTo(f+m,h+n);break;case"H":f=b[1],a.lineTo(f+m,h+n);break;case"v":h+=b[1],a.lineTo(f+m,h+n);break;case"V":h=b[1],a.lineTo(f+m,h+n);break;case"m":f+=b[1],h+=b[2],d=f,e=h,a.moveTo(f+m,h+n);break;case"M":f=b[1],h=b[2],d=f,e=h,a.moveTo(f+m,h+n);break;case"c":k=f+b[5],l=h+b[6],i=f+b[3],j=h+b[4],a.bezierCurveTo(f+b[1]+m,h+b[2]+n,i+m,j+n,k+m,l+n),f=k,h=l;break;case"C":f=b[5],h=b[6],i=b[3],j=b[4],a.bezierCurveTo(b[1]+m,b[2]+n,i+m,j+n,f+m,h+n);break;case"s":k=f+b[3],l=h+b[4],null===c[0].match(/[CcSs]/)?(i=f,j=h):(i=2*f-i,j=2*h-j),a.bezierCurveTo(i+m,j+n,f+b[1]+m,h+b[2]+n,k+m,l+n),i=f+b[1],j=h+b[2],f=k,h=l;break;case"S":k=b[3],l=b[4],null===c[0].match(/[CcSs]/)?(i=f,j=h):(i=2*f-i,j=2*h-j),a.bezierCurveTo(i+m,j+n,b[1]+m,b[2]+n,k+m,l+n),f=k,h=l,i=b[1],j=b[2];break;case"q":k=f+b[3],l=h+b[4],i=f+b[1],j=h+b[2],a.quadraticCurveTo(i+m,j+n,k+m,l+n),f=k,h=l;break;case"Q":k=b[3],l=b[4],a.quadraticCurveTo(b[1]+m,b[2]+n,k+m,l+n),f=k,h=l,i=b[1],j=b[2];break;case"t":k=f+b[1],l=h+b[2],null===c[0].match(/[QqTt]/)?(i=f,j=h):(i=2*f-i,j=2*h-j),a.quadraticCurveTo(i+m,j+n,k+m,l+n),f=k,h=l;break;case"T":k=b[1],l=b[2],null===c[0].match(/[QqTt]/)?(i=f,j=h):(i=2*f-i,j=2*h-j),a.quadraticCurveTo(i+m,j+n,k+m,l+n),f=k,h=l;break;case"a":g(a,f+m,h+n,[b[1],b[2],b[3],b[4],b[5],b[6]+f+m,b[7]+h+n]),f+=b[6],h+=b[7];break;case"A":g(a,f+m,h+n,[b[1],b[2],b[3],b[4],b[5],b[6]+m,b[7]+n]),f=b[6],h=b[7];break;case"z":case"Z":f=d,h=e,a.closePath()}c=b}},_render:function(a){this._renderPathCommands(a),this._renderFill(a),this._renderStroke(a)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(a){var b=e(this.callSuper("toObject",["sourcePath","pathOffset"].concat(a)),{path:this.path.map(function(a){return a.slice()}),top:this.top,left:this.left});return b},toDatalessObject:function(a){var b=this.toObject(a);return this.sourcePath&&(b.path=this.sourcePath),delete b.sourcePath,b},toSVG:function(a){for(var b=[],c=this._createBaseSVGMarkup(),d="",e=0,f=this.path.length;e<f;e++)b.push(this.path[e].join(" "));var g=b.join(" ");return this.group&&"path-group"===this.group.type||(d=" translate("+-this.pathOffset.x+", "+-this.pathOffset.y+") "),c.push("<path ",this.getSvgId(),'d="',g,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),d,this.getSvgTransformMatrix(),'" stroke-linecap="round" ',"/>\n"),a?a(c.join("")):c.join("")},complexity:function(){return this.path.length},_parsePath:function(){for(var c,d,f,g,k,a=[],b=[],e=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi,j=0,l=this.path.length;j<l;j++){for(c=this.path[j],g=c.slice(1).trim(),b.length=0;f=e.exec(g);)b.push(f[0]);k=[c.charAt(0)];for(var m=0,n=b.length;m<n;m++)d=parseFloat(b[m]),isNaN(d)||k.push(d);var o=k[0],p=h[o.toLowerCase()],q=i[o]||o;if(k.length-1>p)for(var r=1,s=k.length;r<s;r+=p)a.push([o].concat(k.slice(r,r+p))),o=q;else a.push(k)}return a},_parseDimensions:function(){for(var f,n,o,p,a=[],e=[],g=null,h=0,i=0,j=0,k=0,l=0,m=0,q=0,r=this.path.length;q<r;++q){switch(f=this.path[q],f[0]){case"l":j+=f[1],k+=f[2],p=[];break;case"L":j=f[1],k=f[2],p=[];break;case"h":j+=f[1],p=[];break;case"H":j=f[1],p=[];break;case"v":k+=f[1],p=[];break;case"V":k=f[1],p=[];break;case"m":j+=f[1],k+=f[2],h=j,i=k,p=[];break;case"M":j=f[1],k=f[2],h=j,i=k,p=[];break;case"c":n=j+f[5],o=k+f[6],l=j+f[3],m=k+f[4],p=b.util.getBoundsOfCurve(j,k,j+f[1],k+f[2],l,m,n,o),j=n,k=o;break;case"C":l=f[3],m=f[4],p=b.util.getBoundsOfCurve(j,k,f[1],f[2],l,m,f[5],f[6]),j=f[5],k=f[6];break;case"s":n=j+f[3],o=k+f[4],null===g[0].match(/[CcSs]/)?(l=j,m=k):(l=2*j-l,m=2*k-m),p=b.util.getBoundsOfCurve(j,k,l,m,j+f[1],k+f[2],n,o),l=j+f[1],m=k+f[2],j=n,k=o;break;case"S":n=f[3],o=f[4],null===g[0].match(/[CcSs]/)?(l=j,m=k):(l=2*j-l,m=2*k-m),p=b.util.getBoundsOfCurve(j,k,l,m,f[1],f[2],n,o),j=n,k=o,l=f[1],m=f[2];break;case"q":n=j+f[3],o=k+f[4],l=j+f[1],m=k+f[2],p=b.util.getBoundsOfCurve(j,k,l,m,l,m,n,o),j=n,k=o;break;case"Q":l=f[1],m=f[2],p=b.util.getBoundsOfCurve(j,k,l,m,l,m,f[3],f[4]),j=f[3],k=f[4];break;case"t":n=j+f[1],o=k+f[2],null===g[0].match(/[QqTt]/)?(l=j,m=k):(l=2*j-l,m=2*k-m),p=b.util.getBoundsOfCurve(j,k,l,m,l,m,n,o),j=n,k=o;break;case"T":n=f[1],o=f[2],null===g[0].match(/[QqTt]/)?(l=j,m=k):(l=2*j-l,m=2*k-m),p=b.util.getBoundsOfCurve(j,k,l,m,l,m,n,o),j=n,k=o;break;case"a":p=b.util.getBoundsOfArc(j,k,f[1],f[2],f[3],f[4],f[5],f[6]+j,f[7]+k),j+=f[6],k+=f[7];break;case"A":p=b.util.getBoundsOfArc(j,k,f[1],f[2],f[3],f[4],f[5],f[6],f[7]),j=f[6],k=f[7];break;case"z":case"Z":j=h,k=i}g=f,p.forEach(function(b){a.push(b.x),e.push(b.y)}),a.push(j),e.push(k)}var s=c(a)||0,t=c(e)||0,u=d(a)||0,v=d(e)||0,w=u-s,x=v-t,y={left:s,top:t,width:w,height:x};return y}}),b.Path.fromObject=function(a,c,d){var e;return"string"!==typeof a.path?b.Object._fromObject("Path",a,c,d,"path"):void b.loadSVGFromURL(a.path,function(d){var f=a.path;e=d[0],delete a.path,b.util.object.extend(e,a),e.setSourcePath(f),c&&c(e)})},b.Path.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat(["d"]),b.Path.fromElement=function(a,c,d){var f=b.parseAttributes(a,b.Path.ATTRIBUTE_NAMES);c&&c(new b.Path(f.d,e(f,d)))},b.Path.async=!0}("undefined"!==typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend;return b.PathGroup?void b.warn("fabric.PathGroup is already defined"):(b.PathGroup=b.util.createClass(b.Object,{type:"path-group",fill:"",initialize:function(a,b){b=b||{},this.paths=a||[];for(var c=this.paths.length;c--;)this.paths[c].group=this;b.toBeParsed&&(this.parseDimensionsFromPaths(b),delete b.toBeParsed),this.setOptions(b),this.setCoords()},parseDimensionsFromPaths:function(a){for(var c,d,g,h,i,j,e=[],f=[],k=this.paths.length;k--;){g=this.paths[k],h=g.height+g.strokeWidth,i=g.width+g.strokeWidth,c=[{x:g.left,y:g.top},{x:g.left+i,y:g.top},{x:g.left,y:g.top+h},{x:g.left+i,y:g.top+h}],j=this.paths[k].transformMatrix;for(var l=0;l<c.length;l++)d=c[l],j&&(d=b.util.transformPoint(d,j,!1)),e.push(d.x),f.push(d.y)}a.width=Math.max.apply(null,e),a.height=Math.max.apply(null,f)},drawObject:function(a){a.save(),a.translate(-this.width/2,-this.height/2);for(var b=0,c=this.paths.length;b<c;++b)this.paths[b].render(a,!0);a.restore()},shouldCache:function(){var a=this.objectCaching&&(!this.group||this.needsItsOwnCache()||!this.group.isCaching());if(this.caching=a,a)for(var b=0,c=this.paths.length;b<c;b++)if(this.paths[b].willDrawShadow())return this.caching=!1,!1;return a},willDrawShadow:function(){if(this.shadow)return!0;for(var a=0,b=this.paths.length;a<b;a++)if(this.paths[a].willDrawShadow())return!0;return!1},isCaching:function(){return this.caching||this.group&&this.group.isCaching()},isCacheDirty:function(){if(this.callSuper("isCacheDirty"))return!0;if(!this.statefullCache)return!1;for(var a=0,b=this.paths.length;a<b;a++)if(this.paths[a].isCacheDirty(!0)){var c=this._getNonTransformedDimensions();return this._cacheContext.clearRect(-c.x/2,-c.y/2,c.x,c.y),!0}return!1},_set:function(a,b){if("fill"===a&&b&&this.isSameColor())for(var c=this.paths.length;c--;)this.paths[c]._set(a,b);return this.callSuper("_set",a,b)},toObject:function(a){var b=this.paths.map(function(b){var c=b.includeDefaultValues;b.includeDefaultValues=b.group.includeDefaultValues;var d=b.toObject(a);return b.includeDefaultValues=c,d}),d=c(this.callSuper("toObject",["sourcePath"].concat(a)),{paths:b});return d},toDatalessObject:function(a){var b=this.toObject(a);return this.sourcePath&&(b.paths=this.sourcePath),b},toSVG:function(a){var b=this.getObjects(),c=this.getPointByOrigin("left","top"),d="translate("+c.x+" "+c.y+")",e=this._createBaseSVGMarkup();e.push("<g ",this.getSvgId(),'style="',this.getSvgStyles(),'" ','transform="',this.getSvgTransformMatrix(),d,this.getSvgTransform(),'" ',">\n");for(var f=0,g=b.length;f<g;f++)e.push("	",b[f].toSVG(a));return e.push("</g>\n"),a?a(e.join("")):e.join("")},toString:function(){return"#<fabric.PathGroup ("+this.complexity()+"): { top: "+this.top+", left: "+this.left+" }>"},isSameColor:function(){var a=this.getObjects()[0].get("fill")||"";return"string"!==typeof a?!1:(a=a.toLowerCase(),this.getObjects().every(function(b){var c=b.get("fill")||"";return"string"===typeof c&&c.toLowerCase()===a}))},complexity:function(){return this.paths.reduce(function(a,b){return a+(b&&b.complexity?b.complexity():0)},0)},getObjects:function(){return this.paths}}),b.PathGroup.fromObject=function(a,c){var d=a.paths;delete a.paths,"string"===typeof d?b.loadSVGFromURL(d,function(e){var f=d,g=b.util.groupSVGElements(e,a,f);a.paths=d,c(g)}):b.util.enlivenObjects(d,function(e){var f=new b.PathGroup(e,a);a.paths=d,c(f)})},void(b.PathGroup.async=!0))}("undefined"!==typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend,d=b.util.array.min,e=b.util.array.max;if(!b.Group){var f={lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0};b.Group=b.util.createClass(b.Object,b.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,initialize:function(a,b,c){b=b||{},this._objects=[],c&&this.callSuper("initialize",b),this._objects=a||[];for(var d=this._objects.length;d--;)this._objects[d].group=this;b.originX&&(this.originX=b.originX),b.originY&&(this.originY=b.originY),c?this._updateObjectsCoords(!0):(this._calcBounds(),this._updateObjectsCoords(),this.callSuper("initialize",b)),this.setCoords(),this.saveCoords()},_updateObjectsCoords:function(a){for(var b=this.getCenterPoint(),c=this._objects.length;c--;)this._updateObjectCoords(this._objects[c],b,a)},_updateObjectCoords:function(a,b,c){if(a.__origHasControls=a.hasControls,a.hasControls=!1,!c){var d=a.getLeft(),e=a.getTop(),f=!0,g=!0;a.set({left:d-b.x,top:e-b.y}),a.setCoords(f,g)}},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(a){return this._restoreObjectsState(),b.util.resetObjectTransform(this),a&&(this._objects.push(a),a.group=this,a._set("canvas",this.canvas)),this.forEachObject(this._setObjectActive,this),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_setObjectActive:function(a){a.set("active",!0),a.group=this},removeWithUpdate:function(a){return this._restoreObjectsState(),b.util.resetObjectTransform(this),this.forEachObject(this._setObjectActive,this),this.remove(a),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(a){this.dirty=!0,a.group=this,a._set("canvas",this.canvas)},_onObjectRemoved:function(a){this.dirty=!0,delete a.group,a.set("active",!1)},delegatedProperties:{fill:!0,stroke:!0,strokeWidth:!0,fontFamily:!0,fontWeight:!0,fontSize:!0,fontStyle:!0,lineHeight:!0,textDecoration:!0,textAlign:!0,backgroundColor:!0},_set:function(a,b){var c=this._objects.length;if(this.delegatedProperties[a]||"canvas"===a)for(;c--;)this._objects[c].set(a,b);else for(;c--;)this._objects[c].setOnGroup(a,b);this.callSuper("_set",a,b)},toObject:function(a){var b=this.getObjects().map(function(b){var c=b.includeDefaultValues;b.includeDefaultValues=b.group.includeDefaultValues;var d=b.toObject(a);return b.includeDefaultValues=c,d});return c(this.callSuper("toObject",a),{objects:b})},toDatalessObject:function(a){var b=this.getObjects().map(function(b){var c=b.includeDefaultValues;b.includeDefaultValues=b.group.includeDefaultValues;var d=b.toDatalessObject(a);return b.includeDefaultValues=c,d});return c(this.callSuper("toDatalessObject",a),{objects:b})},render:function(a){this._transformDone=!0,this.callSuper("render",a),this._transformDone=!1},shouldCache:function(){var a=this.objectCaching&&(!this.group||this.needsItsOwnCache()||!this.group.isCaching());if(this.caching=a,a)for(var b=0,c=this._objects.length;b<c;b++)if(this._objects[b].willDrawShadow())return this.caching=!1,!1;return a},willDrawShadow:function(){if(this.shadow)return!0;for(var a=0,b=this._objects.length;a<b;a++)if(this._objects[a].willDrawShadow())return!0;return!1},isCaching:function(){return this.caching||this.group&&this.group.isCaching()},drawObject:function(a){for(var b=0,c=this._objects.length;b<c;b++)this._renderObject(this._objects[b],a)},isCacheDirty:function(){if(this.callSuper("isCacheDirty"))return!0;if(!this.statefullCache)return!1;for(var a=0,b=this._objects.length;a<b;a++)if(this._objects[a].isCacheDirty(!0)){var c=this._getNonTransformedDimensions();return this._cacheContext.clearRect(-c.x/2,-c.y/2,c.x,c.y),!0}return!1},_renderControls:function(a,b){a.save(),a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",a,b);for(var c=0,d=this._objects.length;c<d;c++)this._objects[c]._renderControls(a);a.restore()},_renderObject:function(a,b){if(a.visible){var c=a.hasRotatingPoint;a.hasRotatingPoint=!1,a.render(b),a.hasRotatingPoint=c}},_restoreObjectsState:function(){return this._objects.forEach(this._restoreObjectState,this),this},realizeTransform:function(a){var c=a.calcTransformMatrix(),d=b.util.qrDecompose(c),e=new b.Point(d.translateX,d.translateY);return a.flipX=!1,a.flipY=!1,a.set("scaleX",d.scaleX),a.set("scaleY",d.scaleY),a.skewX=d.skewX,a.skewY=d.skewY,a.angle=d.angle,a.setPositionByOrigin(e,"center","center"),a},_restoreObjectState:function(a){return this.realizeTransform(a),a.setCoords(),a.hasControls=a.__origHasControls,delete a.__origHasControls,a.set("active",!1),delete a.group,this},destroy:function(){return this._restoreObjectsState()},saveCoords:function(){return this._originalLeft=this.get("left"),this._originalTop=this.get("top"),this},hasMoved:function(){return this._originalLeft!==this.get("left")||this._originalTop!==this.get("top")},setObjectsCoords:function(){var a=!0,b=!0;return this.forEachObject(function(c){c.setCoords(a,b)}),this},_calcBounds:function(a){for(var d,e,i,b=[],c=[],f=["tr","br","bl","tl"],g=0,h=this._objects.length,j=f.length,k=!0;g<h;++g)for(d=this._objects[g],d.setCoords(k),i=0;i<j;i++)e=f[i],b.push(d.oCoords[e].x),c.push(d.oCoords[e].y);this.set(this._getBounds(b,c,a))},_getBounds:function(a,c,f){var g=new b.Point(d(a),d(c)),h=new b.Point(e(a),e(c)),i={width:h.x-g.x||0,height:h.y-g.y||0};return f||(i.left=g.x||0,i.top=g.y||0,"center"===this.originX&&(i.left+=i.width/2),"right"===this.originX&&(i.left+=i.width),"center"===this.originY&&(i.top+=i.height/2),"bottom"===this.originY&&(i.top+=i.height)),i},toSVG:function(a){var b=this._createBaseSVGMarkup();b.push("<g ",this.getSvgId(),'transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'" style="',this.getSvgFilter(),'">\n');for(var c=0,d=this._objects.length;c<d;c++)b.push("	",this._objects[c].toSVG(a));return b.push("</g>\n"),a?a(b.join("")):b.join("")},get:function(a){if(a in f){if(this[a])return this[a];for(var b=0,c=this._objects.length;b<c;b++)if(this._objects[b][a])return!0;return!1}return a in this.delegatedProperties?this._objects[0]&&this._objects[0].get(a):this[a]}}),b.Group.fromObject=function(a,c){b.util.enlivenObjects(a.objects,function(d){delete a.objects,c&&c(new b.Group(d,a,!0))})},b.Group.async=!0}}("undefined"!==typeof exports?exports:this),function(a){"use strict";var b=fabric.util.object.extend;if(a.fabric||(a.fabric={}),a.fabric.Image)return void fabric.warn("fabric.Image is already defined.");var c=fabric.Object.prototype.stateProperties.concat();c.push("alignX","alignY","meetOrSlice"),fabric.Image=fabric.util.createClass(fabric.Object,{type:"image",crossOrigin:"",alignX:"none",alignY:"none",meetOrSlice:"meet",strokeWidth:0,_lastScaleX:1,_lastScaleY:1,minimumScaleTrigger:.5,stateProperties:c,objectCaching:!1,initialize:function(a,b,c){b||(b={}),this.filters=[],this.resizeFilters=[],this.callSuper("initialize",b),this._initElement(a,b,c)},getElement:function(){return this._element},setElement:function(a,b,c){var d,e;return this._element=a,this._originalElement=a,this._initConfig(c),0===this.resizeFilters.length?d=b:(e=this,d=function(){e.applyFilters(b,e.resizeFilters,e._filteredEl||e._originalElement,!0)}),0!==this.filters.length?this.applyFilters(d):d&&d(this),this},setCrossOrigin:function(a){return this.crossOrigin=a,this._element.crossOrigin=a,this},getOriginalSize:function(){var a=this.getElement();return{width:a.width,height:a.height}},_stroke:function(a){if(this.stroke&&0!==this.strokeWidth){var b=this.width/2,c=this.height/2;a.beginPath(),a.moveTo(-b,-c),a.lineTo(b,-c),a.lineTo(b,c),a.lineTo(-b,c),a.lineTo(-b,-c),a.closePath()}},_renderDashedStroke:function(a){var b=-this.width/2,c=-this.height/2,d=this.width,e=this.height;a.save(),this._setStrokeStyles(a),a.beginPath(),fabric.util.drawDashedLine(a,b,c,b+d,c,this.strokeDashArray),fabric.util.drawDashedLine(a,b+d,c,b+d,c+e,this.strokeDashArray),fabric.util.drawDashedLine(a,b+d,c+e,b,c+e,this.strokeDashArray),fabric.util.drawDashedLine(a,b,c+e,b,c,this.strokeDashArray),a.closePath(),a.restore()},toObject:function(a){var c=[],d=[],e=1,f=1;this.filters.forEach(function(a){a&&("Resize"===a.type&&(e*=a.scaleX,f*=a.scaleY),c.push(a.toObject()))}),this.resizeFilters.forEach(function(a){a&&d.push(a.toObject())});var g=b(this.callSuper("toObject",["crossOrigin","alignX","alignY","meetOrSlice"].concat(a)),{src:this.getSrc(),filters:c,resizeFilters:d});return g.width/=e,g.height/=f,g},toSVG:function(a){var b=this._createBaseSVGMarkup(),c=-this.width/2,d=-this.height/2,e="none",f=!0;if(this.group&&"path-group"===this.group.type&&(c=this.left,d=this.top),"none"!==this.alignX&&"none"!==this.alignY&&(e="x"+this.alignX+"Y"+this.alignY+" "+this.meetOrSlice),b.push('<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'">\n',"<image ",this.getSvgId(),'xlink:href="',this.getSvgSrc(f),'" x="',c,'" y="',d,'" style="',this.getSvgStyles(),'" width="',this.width,'" height="',this.height,'" preserveAspectRatio="',e,'"',"></image>\n"),this.stroke||this.strokeDashArray){var g=this.fill;this.fill=null,b.push("<rect ",'x="',c,'" y="',d,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n'),this.fill=g}return b.push("</g>\n"),a?a(b.join("")):b.join("")},getSrc:function(a){var b=a?this._element:this._originalElement;return b?fabric.isLikelyNode?b._src:b.src:this.src||""},setSrc:function(a,b,c){fabric.util.loadImage(a,function(a){return this.setElement(a,b,c)},this,c&&c.crossOrigin)},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyFilters:function(a,b,c,d){if(b=b||this.filters,c=c||this._originalElement){var i,j,e=fabric.util.createImage(),f=this.canvas?this.canvas.getRetinaScaling():fabric.devicePixelRatio,g=this.minimumScaleTrigger/f,h=this;if(0===b.length)return this._element=c,a&&a(this),c;var k=fabric.util.createCanvasElement();return k.width=c.width,k.height=c.height,k.getContext("2d").drawImage(c,0,0,c.width,c.height),b.forEach(function(a){a&&(d?(i=h.scaleX<g?h.scaleX:1,j=h.scaleY<g?h.scaleY:1,i*f<1&&(i*=f),j*f<1&&(j*=f)):(i=a.scaleX,j=a.scaleY),a.applyTo(k,i,j),d||"Resize"!==a.type||(h.width*=a.scaleX,h.height*=a.scaleY))}),e.width=k.width,e.height=k.height,fabric.isLikelyNode?(e.src=k.toBuffer(void 0,fabric.Image.pngCompression),h._element=e,!d&&(h._filteredEl=e),a&&a(h)):(e.onload=function(){h._element=e,!d&&(h._filteredEl=e),a&&a(h),e.onload=k=null},e.src=k.toDataURL("image/png")),k}},_render:function(a,b){var c,d,f,e=this._findMargins();c=b?this.left:-this.width/2,d=b?this.top:-this.height/2,"slice"===this.meetOrSlice&&(a.beginPath(),a.rect(c,d,this.width,this.height),a.clip()),this.isMoving===!1&&this.resizeFilters.length&&this._needsResize()?(this._lastScaleX=this.scaleX,this._lastScaleY=this.scaleY,f=this.applyFilters(null,this.resizeFilters,this._filteredEl||this._originalElement,!0)):f=this._element,f&&a.drawImage(f,c+e.marginX,d+e.marginY,e.width,e.height),this._stroke(a),this._renderStroke(a)},_needsResize:function(){return this.scaleX!==this._lastScaleX||this.scaleY!==this._lastScaleY},_findMargins:function(){var c,d,a=this.width,b=this.height,e=0,f=0;return("none"!==this.alignX||"none"!==this.alignY)&&(c=[this.width/this._element.width,this.height/this._element.height],d="meet"===this.meetOrSlice?Math.min.apply(null,c):Math.max.apply(null,c),a=this._element.width*d,b=this._element.height*d,"Mid"===this.alignX&&(e=(this.width-a)/2),"Max"===this.alignX&&(e=this.width-a),"Mid"===this.alignY&&(f=(this.height-b)/2),"Max"===this.alignY&&(f=this.height-b)),{width:a,height:b,marginX:e,marginY:f}},_resetWidthHeight:function(){var a=this.getElement();this.set("width",a.width),this.set("height",a.height)},_initElement:function(a,b,c){this.setElement(fabric.util.getById(a),c,b),fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(a){a||(a={}),this.setOptions(a),this._setWidthHeight(a),this._element&&this.crossOrigin&&(this._element.crossOrigin=this.crossOrigin)},_initFilters:function(a,b){a&&a.length?fabric.util.enlivenObjects(a,function(a){b&&b(a)},"fabric.Image.filters"):b&&b()},_setWidthHeight:function(a){this.width="width"in a?a.width:this.getElement()?this.getElement().width||0:0,this.height="height"in a?a.height:this.getElement()?this.getElement().height||0:0}}),fabric.Image.CSS_CANVAS="canvas-img",fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc,fabric.Image.fromObject=function(a,b){fabric.util.loadImage(a.src,function(c,d){return d?void(b&&b(null,d)):void fabric.Image.prototype._initFilters.call(a,a.filters,function(d){a.filters=d||[],fabric.Image.prototype._initFilters.call(a,a.resizeFilters,function(d){return a.resizeFilters=d||[],new fabric.Image(c,a,b)})})},null,a.crossOrigin)},fabric.Image.fromURL=function(a,b,c){fabric.util.loadImage(a,function(a){b&&b(new fabric.Image(a,c))},null,c&&c.crossOrigin)},fabric.Image.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin".split(" ")),fabric.Image.fromElement=function(a,c,d){var f,e=fabric.parseAttributes(a,fabric.Image.ATTRIBUTE_NAMES);e.preserveAspectRatio&&(f=fabric.util.parsePreserveAspectRatioAttribute(e.preserveAspectRatio),b(e,f)),fabric.Image.fromURL(e["xlink:href"],c,b(d?fabric.util.object.clone(d):{},e))},fabric.Image.async=!0,fabric.Image.pngCompression=1}("undefined"!==typeof exports?exports:this),fabric.util.object.extend(fabric.Object.prototype,{_getAngleValueForStraighten:function(){var a=this.getAngle()%360;return a>0?90*Math.round((a-1)/90):90*Math.round(a/90)},straighten:function(){return this.setAngle(this._getAngleValueForStraighten()),this},fxStraighten:function(a){a=a||{};var b=function(){},c=a.onComplete||b,d=a.onChange||b,e=this;return fabric.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(a){e.setAngle(a),d()},onComplete:function(){e.setCoords(),c()},onStart:function(){e.set("active",!1)}}),this}}),fabric.util.object.extend(fabric.StaticCanvas.prototype,{straightenObject:function(a){return a.straighten(),this.renderAll(),this},fxStraightenObject:function(a){return a.fxStraighten({onChange:this.renderAll.bind(this)}),this}}),fabric.Image.filters=fabric.Image.filters||{},fabric.Image.filters.BaseFilter=fabric.util.createClass({type:"BaseFilter",initialize:function(a){a&&this.setOptions(a)},setOptions:function(a){for(var b in a)this[b]=a[b]},toObject:function(){return{type:this.type}},toJSON:function(){return this.toObject()}}),fabric.Image.filters.BaseFilter.fromObject=function(a,b){var c=new fabric.Image.filters[a.type](a);return b&&b(c),c},function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend,d=b.Image.filters,e=b.util.createClass;d.Brightness=e(d.BaseFilter,{type:"Brightness",initialize:function(a){a=a||{},this.brightness=a.brightness||0},applyTo:function(a){for(var b=a.getContext("2d"),c=b.getImageData(0,0,a.width,a.height),d=c.data,e=this.brightness,f=0,g=d.length;f<g;f+=4)d[f]+=e,d[f+1]+=e,d[f+2]+=e;b.putImageData(c,0,0)},toObject:function(){return c(this.callSuper("toObject"),{brightness:this.brightness})}}),b.Image.filters.Brightness.fromObject=b.Image.filters.BaseFilter.fromObject}("undefined"!==typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend,d=b.Image.filters,e=b.util.createClass;d.Convolute=e(d.BaseFilter,{type:"Convolute",initialize:function(a){a=a||{},this.opaque=a.opaque,this.matrix=a.matrix||[0,0,0,0,1,0,0,0,0]},applyTo:function(a){for(var m,n,o,p,q,r,s,t,u,b=this.matrix,c=a.getContext("2d"),d=c.getImageData(0,0,a.width,a.height),e=Math.round(Math.sqrt(b.length)),f=Math.floor(e/2),g=d.data,h=d.width,i=d.height,j=c.createImageData(h,i),k=j.data,l=this.opaque?1:0,v=0;v<i;v++)for(var w=0;w<h;w++){q=4*(v*h+w),m=0,n=0,o=0,p=0;for(var x=0;x<e;x++)for(var y=0;y<e;y++)s=v+x-f,r=w+y-f,s<0||s>i||r<0||r>h||(t=4*(s*h+r),u=b[x*e+y],m+=g[t]*u,n+=g[t+1]*u,o+=g[t+2]*u,p+=g[t+3]*u);k[q]=m,k[q+1]=n,k[q+2]=o,k[q+3]=p+l*(255-p)}c.putImageData(j,0,0)},toObject:function(){return c(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),b.Image.filters.Convolute.fromObject=b.Image.filters.BaseFilter.fromObject}("undefined"!==typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend,d=b.Image.filters,e=b.util.createClass;d.GradientTransparency=e(d.BaseFilter,{type:"GradientTransparency",initialize:function(a){a=a||{},this.threshold=a.threshold||100},applyTo:function(a){for(var b=a.getContext("2d"),c=b.getImageData(0,0,a.width,a.height),d=c.data,e=this.threshold,f=d.length,g=0,h=d.length;g<h;g+=4)d[g+3]=e+255*(f-g)/f;b.putImageData(c,0,0)},toObject:function(){return c(this.callSuper("toObject"),{threshold:this.threshold})}}),b.Image.filters.GradientTransparency.fromObject=b.Image.filters.BaseFilter.fromObject}("undefined"!==typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.Image.filters,d=b.util.createClass;c.Grayscale=d(c.BaseFilter,{type:"Grayscale",applyTo:function(a){for(var g,b=a.getContext("2d"),c=b.getImageData(0,0,a.width,a.height),d=c.data,e=c.width*c.height*4,f=0;f<e;)g=(d[f]+d[f+1]+d[f+2])/3,d[f]=g,d[f+1]=g,d[f+2]=g,f+=4;b.putImageData(c,0,0)}}),b.Image.filters.Grayscale.fromObject=function(a,c){return a=a||{},a.type="Grayscale",b.Image.filters.BaseFilter.fromObject(a,c)}}("undefined"!==typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.Image.filters,d=b.util.createClass;c.Invert=d(c.BaseFilter,{type:"Invert",applyTo:function(a){var f,b=a.getContext("2d"),c=b.getImageData(0,0,a.width,a.height),d=c.data,e=d.length;for(f=0;f<e;f+=4)d[f]=255-d[f],d[f+1]=255-d[f+1],d[f+2]=255-d[f+2];b.putImageData(c,0,0)}}),b.Image.filters.Invert.fromObject=function(a,c){return a=a||{},a.type="Invert",b.Image.filters.BaseFilter.fromObject(a,c)}}("undefined"!==typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend,d=b.Image.filters,e=b.util.createClass;d.Mask=e(d.BaseFilter,{type:"Mask",initialize:function(a){a=a||{},this.mask=a.mask,this.channel=[0,1,2,3].indexOf(a.channel)>-1?a.channel:0},applyTo:function(a){if(this.mask){var i,c=a.getContext("2d"),d=c.getImageData(0,0,a.width,a.height),e=d.data,f=this.mask.getElement(),g=b.util.createCanvasElement(),h=this.channel,j=d.width*d.height*4;g.width=a.width,g.height=a.height,g.getContext("2d").drawImage(f,0,0,a.width,a.height);var k=g.getContext("2d").getImageData(0,0,a.width,a.height),l=k.data;for(i=0;i<j;i+=4)e[i+3]=l[i+h];c.putImageData(d,0,0)}},toObject:function(){return c(this.callSuper("toObject"),{mask:this.mask.toObject(),channel:this.channel})}}),b.Image.filters.Mask.fromObject=function(a,c){b.util.loadImage(a.mask.src,function(d){return a.mask=new b.Image(d,a.mask),b.Image.filters.BaseFilter.fromObject(a,c)})},b.Image.filters.Mask.async=!0}("undefined"!==typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend,d=b.Image.filters,e=b.util.createClass;d.Noise=e(d.BaseFilter,{type:"Noise",initialize:function(a){a=a||{},this.noise=a.noise||0},applyTo:function(a){for(var f,b=a.getContext("2d"),c=b.getImageData(0,0,a.width,a.height),d=c.data,e=this.noise,g=0,h=d.length;g<h;g+=4)f=(.5-Math.random())*e,d[g]+=f,d[g+1]+=f,d[g+2]+=f;b.putImageData(c,0,0)},toObject:function(){return c(this.callSuper("toObject"),{noise:this.noise})}}),b.Image.filters.Noise.fromObject=b.Image.filters.BaseFilter.fromObject}("undefined"!==typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend,d=b.Image.filters,e=b.util.createClass;d.Pixelate=e(d.BaseFilter,{type:"Pixelate",initialize:function(a){a=a||{},this.blocksize=a.blocksize||4},applyTo:function(a){var g,h,i,j,k,l,m,b=a.getContext("2d"),c=b.getImageData(0,0,a.width,a.height),d=c.data,e=c.height,f=c.width;for(h=0;h<e;h+=this.blocksize)for(i=0;i<f;i+=this.blocksize){g=4*h*f+4*i,j=d[g],k=d[g+1],l=d[g+2],m=d[g+3];for(var n=h,o=h+this.blocksize;n<o;n++)for(var p=i,q=i+this.blocksize;p<q;p++)g=4*n*f+4*p,d[g]=j,d[g+1]=k,d[g+2]=l,d[g+3]=m}b.putImageData(c,0,0)},toObject:function(){return c(this.callSuper("toObject"),{blocksize:this.blocksize})}}),b.Image.filters.Pixelate.fromObject=b.Image.filters.BaseFilter.fromObject}("undefined"!==typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend,d=b.Image.filters,e=b.util.createClass;d.RemoveWhite=e(d.BaseFilter,{type:"RemoveWhite",initialize:function(a){a=a||{},this.threshold=a.threshold||30,this.distance=a.distance||20},applyTo:function(a){for(var i,j,k,b=a.getContext("2d"),c=b.getImageData(0,0,a.width,a.height),d=c.data,e=this.threshold,f=this.distance,g=255-e,h=Math.abs,l=0,m=d.length;l<m;l+=4)i=d[l],j=d[l+1],k=d[l+2],i>g&&j>g&&k>g&&h(i-j)<f&&h(i-k)<f&&h(j-k)<f&&(d[l+3]=0);b.putImageData(c,0,0)},toObject:function(){return c(this.callSuper("toObject"),{threshold:this.threshold,distance:this.distance})}}),b.Image.filters.RemoveWhite.fromObject=b.Image.filters.BaseFilter.fromObject}("undefined"!==typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.Image.filters,d=b.util.createClass;c.Sepia=d(c.BaseFilter,{type:"Sepia",applyTo:function(a){var f,g,b=a.getContext("2d"),c=b.getImageData(0,0,a.width,a.height),d=c.data,e=d.length;for(f=0;f<e;f+=4)g=.3*d[f]+.59*d[f+1]+.11*d[f+2],d[f]=g+100,d[f+1]=g+50,d[f+2]=g+255;b.putImageData(c,0,0)}}),b.Image.filters.Sepia.fromObject=function(a,c){return a=a||{},a.type="Sepia",new b.Image.filters.BaseFilter.fromObject(a,c)}}("undefined"!==typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.Image.filters,d=b.util.createClass;c.Sepia2=d(c.BaseFilter,{type:"Sepia2",applyTo:function(a){var f,g,h,i,b=a.getContext("2d"),c=b.getImageData(0,0,a.width,a.height),d=c.data,e=d.length;for(f=0;f<e;f+=4)g=d[f],h=d[f+1],i=d[f+2],d[f]=(.393*g+.769*h+.189*i)/1.351,d[f+1]=(.349*g+.686*h+.168*i)/1.203,d[f+2]=(.272*g+.534*h+.131*i)/2.14;b.putImageData(c,0,0)}}),b.Image.filters.Sepia2.fromObject=function(a,c){return a=a||{},a.type="Sepia2",new b.Image.filters.BaseFilter.fromObject(a,c)}}("undefined"!==typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend,d=b.Image.filters,e=b.util.createClass;d.Tint=e(d.BaseFilter,{type:"Tint",initialize:function(a){a=a||{},this.color=a.color||"#000000",this.opacity="undefined"!==typeof a.opacity?a.opacity:new b.Color(this.color).getAlpha()},applyTo:function(a){var g,h,i,j,k,l,m,n,o,c=a.getContext("2d"),d=c.getImageData(0,0,a.width,a.height),e=d.data,f=e.length;for(o=new b.Color(this.color).getSource(),h=o[0]*this.opacity,i=o[1]*this.opacity,j=o[2]*this.opacity,n=1-this.opacity,g=0;g<f;g+=4)k=e[g],l=e[g+1],m=e[g+2],e[g]=h+k*n,e[g+1]=i+l*n,e[g+2]=j+m*n;c.putImageData(d,0,0)},toObject:function(){return c(this.callSuper("toObject"),{color:this.color,opacity:this.opacity})
}}),b.Image.filters.Tint.fromObject=b.Image.filters.BaseFilter.fromObject}("undefined"!==typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend,d=b.Image.filters,e=b.util.createClass;d.Multiply=e(d.BaseFilter,{type:"Multiply",initialize:function(a){a=a||{},this.color=a.color||"#000000"},applyTo:function(a){var g,h,c=a.getContext("2d"),d=c.getImageData(0,0,a.width,a.height),e=d.data,f=e.length;for(h=new b.Color(this.color).getSource(),g=0;g<f;g+=4)e[g]*=h[0]/255,e[g+1]*=h[1]/255,e[g+2]*=h[2]/255;c.putImageData(d,0,0)},toObject:function(){return c(this.callSuper("toObject"),{color:this.color})}}),b.Image.filters.Multiply.fromObject=b.Image.filters.BaseFilter.fromObject}("undefined"!==typeof exports?exports:this),function(a){"use strict";var b=a.fabric,c=b.Image.filters,d=b.util.createClass;c.Blend=d(c.BaseFilter,{type:"Blend",initialize:function(a){a=a||{},this.color=a.color||"#000",this.image=a.image||!1,this.mode=a.mode||"multiply",this.alpha=a.alpha||1},applyTo:function(a){var f,g,h,i,j,k,l,m,n,o,c=a.getContext("2d"),d=c.getImageData(0,0,a.width,a.height),e=d.data,p=!1;if(this.image){p=!0;var q=b.util.createCanvasElement();q.width=this.image.width,q.height=this.image.height;var r=new b.StaticCanvas(q);r.add(this.image);var s=r.getContext("2d");o=s.getImageData(0,0,r.width,r.height).data}else o=new b.Color(this.color).getSource(),f=o[0]*this.alpha,g=o[1]*this.alpha,h=o[2]*this.alpha;for(var t=0,u=e.length;t<u;t+=4)switch(i=e[t],j=e[t+1],k=e[t+2],p&&(f=o[t]*this.alpha,g=o[t+1]*this.alpha,h=o[t+2]*this.alpha),this.mode){case"multiply":e[t]=i*f/255,e[t+1]=j*g/255,e[t+2]=k*h/255;break;case"screen":e[t]=1-(1-i)*(1-f),e[t+1]=1-(1-j)*(1-g),e[t+2]=1-(1-k)*(1-h);break;case"add":e[t]=Math.min(255,i+f),e[t+1]=Math.min(255,j+g),e[t+2]=Math.min(255,k+h);break;case"diff":case"difference":e[t]=Math.abs(i-f),e[t+1]=Math.abs(j-g),e[t+2]=Math.abs(k-h);break;case"subtract":l=i-f,m=j-g,n=k-h,e[t]=l<0?0:l,e[t+1]=m<0?0:m,e[t+2]=n<0?0:n;break;case"darken":e[t]=Math.min(i,f),e[t+1]=Math.min(j,g),e[t+2]=Math.min(k,h);break;case"lighten":e[t]=Math.max(i,f),e[t+1]=Math.max(j,g),e[t+2]=Math.max(k,h)}c.putImageData(d,0,0)},toObject:function(){return{color:this.color,image:this.image,mode:this.mode,alpha:this.alpha}}}),b.Image.filters.Blend.fromObject=b.Image.filters.BaseFilter.fromObject}("undefined"!==typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=Math.pow,d=Math.floor,e=Math.sqrt,f=Math.abs,g=Math.max,h=Math.round,i=Math.sin,j=Math.ceil,k=b.Image.filters,l=b.util.createClass;k.Resize=l(k.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:0,scaleY:0,lanczosLobes:3,applyTo:function(a,b,c){if(1!==b||1!==c){this.rcpScaleX=1/b,this.rcpScaleY=1/c;var i,d=a.width,e=a.height,f=h(d*b),g=h(e*c);"sliceHack"===this.resizeType&&(i=this.sliceByTwo(a,d,e,f,g)),"hermite"===this.resizeType&&(i=this.hermiteFastResize(a,d,e,f,g)),"bilinear"===this.resizeType&&(i=this.bilinearFiltering(a,d,e,f,g)),"lanczos"===this.resizeType&&(i=this.lanczosResize(a,d,e,f,g)),a.width=f,a.height=g,a.getContext("2d").putImageData(i,0,0)}},sliceByTwo:function(a,c,e,f,h){var j,i=a.getContext("2d"),k=.5,l=.5,m=1,n=1,o=!1,p=!1,q=c,r=e,s=b.util.createCanvasElement(),t=s.getContext("2d");for(f=d(f),h=d(h),s.width=g(f,c),s.height=g(h,e),f>c&&(k=2,m=-1),h>e&&(l=2,n=-1),j=i.getImageData(0,0,c,e),a.width=g(f,c),a.height=g(h,e),i.putImageData(j,0,0);!o||!p;)c=q,e=r,f*m<d(q*k*m)?q=d(q*k):(q=f,o=!0),h*n<d(r*l*n)?r=d(r*l):(r=h,p=!0),j=i.getImageData(0,0,c,e),t.putImageData(j,0,0),i.clearRect(0,0,q,r),i.drawImage(s,0,0,c,e,0,0,q,r);return i.getImageData(0,0,f,h)},lanczosResize:function(a,b,g,h,k){function l(a){return function(b){if(b>a)return 0;if(b*=Math.PI,f(b)<1e-16)return 1;var c=b/a;return i(b)*i(c)/b/c}}function m(a){var i,j,l,n,o,C,D,E,F,G,H;for(A.x=(a+.5)*t,B.x=d(A.x),i=0;i<k;i++){for(A.y=(i+.5)*u,B.y=d(A.y),o=0,C=0,D=0,E=0,F=0,j=B.x-x;j<=B.x+x;j++)if(!(j<0||j>=b)){G=d(1e3*f(j-A.x)),z[G]||(z[G]={});for(var I=B.y-y;I<=B.y+y;I++)I<0||I>=g||(H=d(1e3*f(I-A.y)),z[G][H]||(z[G][H]=s(e(c(G*v,2)+c(H*w,2))/1e3)),l=z[G][H],l>0&&(n=4*(I*b+j),o+=l,C+=l*q[n],D+=l*q[n+1],E+=l*q[n+2],F+=l*q[n+3]))}n=4*(i*h+a),r[n]=C/o,r[n+1]=D/o,r[n+2]=E/o,r[n+3]=F/o}return++a<h?m(a):p}var n=a.getContext("2d"),o=n.getImageData(0,0,b,g),p=n.getImageData(0,0,h,k),q=o.data,r=p.data,s=l(this.lanczosLobes),t=this.rcpScaleX,u=this.rcpScaleY,v=2/this.rcpScaleX,w=2/this.rcpScaleY,x=j(t*this.lanczosLobes/2),y=j(u*this.lanczosLobes/2),z={},A={},B={};return m(0)},bilinearFiltering:function(a,b,c,e,f){var g,h,i,j,k,l,m,n,o,p,q,r,t,s=0,u=this.rcpScaleX,v=this.rcpScaleY,w=a.getContext("2d"),x=4*(b-1),y=w.getImageData(0,0,b,c),z=y.data,A=w.getImageData(0,0,e,f),B=A.data;for(m=0;m<f;m++)for(n=0;n<e;n++)for(k=d(u*n),l=d(v*m),o=u*n-k,p=v*m-l,t=4*(l*b+k),q=0;q<4;q++)g=z[t+q],h=z[t+4+q],i=z[t+x+q],j=z[t+x+4+q],r=g*(1-o)*(1-p)+h*o*(1-p)+i*p*(1-o)+j*o*p,B[s++]=r;return A},hermiteFastResize:function(a,b,c,g,h){for(var i=this.rcpScaleX,k=this.rcpScaleY,l=j(i/2),m=j(k/2),n=a.getContext("2d"),o=n.getImageData(0,0,b,c),p=o.data,q=n.getImageData(0,0,g,h),r=q.data,s=0;s<h;s++)for(var t=0;t<g;t++){for(var u=4*(t+s*g),v=0,w=0,x=0,y=0,z=0,A=0,B=0,C=(s+.5)*k,D=d(s*k);D<(s+1)*k;D++)for(var E=f(C-(D+.5))/m,F=(t+.5)*i,G=E*E,H=d(t*i);H<(t+1)*i;H++){var I=f(F-(H+.5))/l,J=e(G+I*I);J>1&&J<-1||(v=2*J*J*J-3*J*J+1,v>0&&(I=4*(H+D*b),B+=v*p[I+3],x+=v,p[I+3]<255&&(v=v*p[I+3]/250),y+=v*p[I],z+=v*p[I+1],A+=v*p[I+2],w+=v))}r[u]=y/w,r[u+1]=z/w,r[u+2]=A/w,r[u+3]=B/x}return q},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),b.Image.filters.Resize.fromObject=b.Image.filters.BaseFilter.fromObject}("undefined"!==typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend,d=b.Image.filters,e=b.util.createClass;d.ColorMatrix=e(d.BaseFilter,{type:"ColorMatrix",initialize:function(a){a||(a={}),this.matrix=a.matrix||[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]},applyTo:function(a){var f,g,h,i,j,b=a.getContext("2d"),c=b.getImageData(0,0,a.width,a.height),d=c.data,e=d.length,k=this.matrix;for(f=0;f<e;f+=4)g=d[f],h=d[f+1],i=d[f+2],j=d[f+3],d[f]=g*k[0]+h*k[1]+i*k[2]+j*k[3]+k[4],d[f+1]=g*k[5]+h*k[6]+i*k[7]+j*k[8]+k[9],d[f+2]=g*k[10]+h*k[11]+i*k[12]+j*k[13]+k[14],d[f+3]=g*k[15]+h*k[16]+i*k[17]+j*k[18]+k[19];b.putImageData(c,0,0)},toObject:function(){return c(this.callSuper("toObject"),{type:this.type,matrix:this.matrix})}}),b.Image.filters.ColorMatrix.fromObject=b.Image.filters.BaseFilter.fromObject}("undefined"!==typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend,d=b.Image.filters,e=b.util.createClass;d.Contrast=e(d.BaseFilter,{type:"Contrast",initialize:function(a){a=a||{},this.contrast=a.contrast||0},applyTo:function(a){for(var b=a.getContext("2d"),c=b.getImageData(0,0,a.width,a.height),d=c.data,e=259*(this.contrast+255)/(255*(259-this.contrast)),f=0,g=d.length;f<g;f+=4)d[f]=e*(d[f]-128)+128,d[f+1]=e*(d[f+1]-128)+128,d[f+2]=e*(d[f+2]-128)+128;b.putImageData(c,0,0)},toObject:function(){return c(this.callSuper("toObject"),{contrast:this.contrast})}}),b.Image.filters.Contrast.fromObject=b.Image.filters.BaseFilter.fromObject}("undefined"!==typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend,d=b.Image.filters,e=b.util.createClass;d.Saturate=e(d.BaseFilter,{type:"Saturate",initialize:function(a){a=a||{},this.saturate=a.saturate||0},applyTo:function(a){for(var e,b=a.getContext("2d"),c=b.getImageData(0,0,a.width,a.height),d=c.data,f=.01*-this.saturate,g=0,h=d.length;g<h;g+=4)e=Math.max(d[g],d[g+1],d[g+2]),d[g]+=e!==d[g]?(e-d[g])*f:0,d[g+1]+=e!==d[g+1]?(e-d[g+1])*f:0,d[g+2]+=e!==d[g+2]?(e-d[g+2])*f:0;b.putImageData(c,0,0)},toObject:function(){return c(this.callSuper("toObject"),{saturate:this.saturate})}}),b.Image.filters.Saturate.fromObject=b.Image.filters.BaseFilter.fromObject}("undefined"!==typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.toFixed,d=b.Object.NUM_FRACTION_DIGITS,e=2;if(b.Text)return void b.warn("fabric.Text is already defined");var f=b.Object.prototype.stateProperties.concat();f.push("fontFamily","fontWeight","fontSize","text","textDecoration","textAlign","fontStyle","lineHeight","textBackgroundColor","charSpacing");var g=b.Object.prototype.cacheProperties.concat();g.push("fontFamily","fontWeight","fontSize","text","textDecoration","textAlign","fontStyle","lineHeight","textBackgroundColor","charSpacing","styles"),b.Text=b.util.createClass(b.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",textDecoration:"",textAlign:"left",fontStyle:"",lineHeight:1.16,textBackgroundColor:"",stateProperties:f,cacheProperties:g,stroke:null,shadow:null,_fontSizeFraction:.25,_fontSizeMult:1.13,charSpacing:0,initialize:function(a,b){b=b||{},this.text=a,this.__skipDimension=!0,this.callSuper("initialize",b),this.__skipDimension=!1,this._initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},_initDimensions:function(a){this.__skipDimension||(a||(a=b.util.createCanvasElement().getContext("2d"),this._setTextStyles(a)),this._textLines=this._splitTextIntoLines(),this._clearCache(),this.width=this._getTextWidth(a)||this.cursorWidth||e,this.height=this._getTextHeight(a))},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var a=this.callSuper("_getCacheCanvasDimensions"),b=this.fontSize;return a.width+=b*a.zoomX,a.height+=b*a.zoomY,a},_render:function(a){this._setTextStyles(a),this.group&&"path-group"===this.group.type&&a.translate(this.left,this.top),this._renderTextLinesBackground(a),this._renderText(a),this._renderTextDecoration(a)},_renderText:function(a){this._renderTextFill(a),this._renderTextStroke(a)},_setTextStyles:function(a){a.textBaseline="alphabetic",a.font=this._getFontDeclaration()},_getTextHeight:function(){return this._getHeightOfSingleLine()+(this._textLines.length-1)*this._getHeightOfLine()},_getTextWidth:function(a){for(var b=this._getLineWidth(a,0),c=1,d=this._textLines.length;c<d;c++){var e=this._getLineWidth(a,c);e>b&&(b=e)}return b},_renderChars:function(a,b,c,d,e){var g,h,f=a.slice(0,-4);if(this[f].toLive){var i=-this.width/2+this[f].offsetX||0,j=-this.height/2+this[f].offsetY||0;b.save(),b.translate(i,j),d-=i,e-=j}if(0!==this.charSpacing){var k=this._getWidthOfCharSpacing();c=c.split("");for(var l=0,m=c.length;l<m;l++)g=c[l],h=b.measureText(g).width+k,b[a](g,d,e),d+=h>0?h:0}else b[a](c,d,e);this[f].toLive&&b.restore()},_renderTextLine:function(a,b,c,d,e,f){e-=this.fontSize*this._fontSizeFraction;var g=this._getLineWidth(b,f);if("justify"!==this.textAlign||this.width<g)return void this._renderChars(a,b,c,d,e,f);for(var o,h=c.split(/\s+/),i=0,j=this._getWidthOfWords(b,h.join(" "),f,0),k=this.width-j,l=h.length-1,m=l>0?k/l:0,n=0,p=0,q=h.length;p<q;p++){for(;" "===c[i]&&i<c.length;)i++;o=h[p],this._renderChars(a,b,o,d+n,e,f,i),n+=this._getWidthOfWords(b,o,f,i)+m,i+=o.length}},_getWidthOfWords:function(a,b){var d,e,c=a.measureText(b).width;return 0!==this.charSpacing&&(d=b.split("").length,e=d*this._getWidthOfCharSpacing(),c+=e),c>0?c:0},_getLeftOffset:function(){return-this.width/2},_getTopOffset:function(){return-this.height/2},isEmptyStyles:function(){return!0},_renderTextCommon:function(a,b){for(var c=0,d=this._getLeftOffset(),e=this._getTopOffset(),f=0,g=this._textLines.length;f<g;f++){var h=this._getHeightOfLine(a,f),i=h/this.lineHeight,j=this._getLineWidth(a,f),k=this._getLineLeftOffset(j);this._renderTextLine(b,a,this._textLines[f],d+k,e+c+i,f),c+=h}},_renderTextFill:function(a){(this.fill||!this.isEmptyStyles())&&this._renderTextCommon(a,"fillText")},_renderTextStroke:function(a){(this.stroke&&0!==this.strokeWidth||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(a),a.save(),this._setLineDash(a,this.strokeDashArray),a.beginPath(),this._renderTextCommon(a,"strokeText"),a.closePath(),a.restore())},_getHeightOfLine:function(){return this._getHeightOfSingleLine()*this.lineHeight},_getHeightOfSingleLine:function(){return this.fontSize*this._fontSizeMult},_renderTextLinesBackground:function(a){if(this.textBackgroundColor){var c,d,e,b=0,f=a.fillStyle;a.fillStyle=this.textBackgroundColor;for(var g=0,h=this._textLines.length;g<h;g++)c=this._getHeightOfLine(a,g),d=this._getLineWidth(a,g),d>0&&(e=this._getLineLeftOffset(d),a.fillRect(this._getLeftOffset()+e,this._getTopOffset()+b,d,c/this.lineHeight)),b+=c;a.fillStyle=f,this._removeShadow(a)}},_getLineLeftOffset:function(a){return"center"===this.textAlign?(this.width-a)/2:"right"===this.textAlign?this.width-a:0},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[]},_shouldClearDimensionCache:function(){var a=this._forceClearCache;return a||(a=this.hasStateChanged("_dimensionAffectingProps")),a&&(this.saveState({propertySet:"_dimensionAffectingProps"}),this.dirty=!0),a},_getLineWidth:function(a,b){if(this.__lineWidths[b])return-1===this.__lineWidths[b]?this.width:this.__lineWidths[b];var c,d,e=this._textLines[b];return c=""===e?0:this._measureLine(a,b),this.__lineWidths[b]=c,c&&"justify"===this.textAlign&&(d=e.split(/\s+/),d.length>1&&(this.__lineWidths[b]=-1)),c},_getWidthOfCharSpacing:function(){return 0!==this.charSpacing?this.fontSize*this.charSpacing/1e3:0},_measureLine:function(a,b){var f,g,c=this._textLines[b],d=a.measureText(c).width,e=0;return 0!==this.charSpacing&&(f=c.split("").length,e=(f-1)*this._getWidthOfCharSpacing()),g=d+e,g>0?g:0},_renderTextDecoration:function(a){function e(d){var e,g,h,i,j,k,l,f=0;for(e=0,g=c._textLines.length;e<g;e++){for(j=c._getLineWidth(a,e),k=c._getLineLeftOffset(j),l=c._getHeightOfLine(a,e),h=0,i=d.length;h<i;h++)a.fillRect(c._getLeftOffset()+k,f+(c._fontSizeMult-1+d[h])*c.fontSize-b,j,c.fontSize/15);f+=l}}if(this.textDecoration){var b=this.height/2,c=this,d=[];this.textDecoration.indexOf("underline")>-1&&d.push(.85),this.textDecoration.indexOf("line-through")>-1&&d.push(.43),this.textDecoration.indexOf("overline")>-1&&d.push(-.12),d.length>0&&e(d)}},_getFontDeclaration:function(){return[b.isLikelyNode?this.fontWeight:this.fontStyle,b.isLikelyNode?this.fontStyle:this.fontWeight,this.fontSize+"px",b.isLikelyNode?'"'+this.fontFamily+'"':this.fontFamily].join(" ")},render:function(a,b){this.visible&&(!this.canvas||!this.canvas.skipOffscreen||this.group||this.isOnScreen())&&(this._shouldClearDimensionCache()&&(this._setTextStyles(a),this._initDimensions(a)),this.callSuper("render",a,b))},_splitTextIntoLines:function(){return this.text.split(this._reNewline)},toObject:function(a){var b=["text","fontSize","fontWeight","fontFamily","fontStyle","lineHeight","textDecoration","textAlign","textBackgroundColor","charSpacing"].concat(a);return this.callSuper("toObject",b)},toSVG:function(a){this.ctx||(this.ctx=b.util.createCanvasElement().getContext("2d"));var c=this._createBaseSVGMarkup(),d=this._getSVGLeftTopOffsets(this.ctx),e=this._getSVGTextAndBg(d.textTop,d.textLeft);return this._wrapSVGTextAndBg(c,e),a?a(c.join("")):c.join("")},_getSVGLeftTopOffsets:function(a){var b=this._getHeightOfLine(a,0),c=-this.width/2,d=0;return{textLeft:c+(this.group&&"path-group"===this.group.type?this.left:0),textTop:d+(this.group&&"path-group"===this.group.type?-this.top:0),lineTop:b}},_wrapSVGTextAndBg:function(a,b){var c=!0,d=this.getSvgFilter(),e=""===d?"":' style="'+d+'"';a.push("	<g ",this.getSvgId(),'transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"',e,">\n",b.textBgRects.join(""),"		<text ",this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",this.textDecoration?'text-decoration="'+this.textDecoration+'" ':"",'style="',this.getSvgStyles(c),'" >\n',b.textSpans.join(""),"		</text>\n","	</g>\n")},_getSVGTextAndBg:function(a,b){var c=[],d=[],e=0;this._setSVGBg(d);for(var f=0,g=this._textLines.length;f<g;f++)this.textBackgroundColor&&this._setSVGTextLineBg(d,f,b,a,e),this._setSVGTextLineText(f,c,e,b,a,d),e+=this._getHeightOfLine(this.ctx,f);return{textSpans:c,textBgRects:d}},_setSVGTextLineText:function(a,e,f,g,h){var i=this.fontSize*(this._fontSizeMult-this._fontSizeFraction)-h+f-this.height/2;return"justify"===this.textAlign?void this._setSVGTextLineJustifed(a,e,i,g):void e.push('			<tspan x="',c(g+this._getLineLeftOffset(this._getLineWidth(this.ctx,a)),d),'" ','y="',c(i,d),'" ',this._getFillAttributes(this.fill),">",b.util.string.escapeXml(this._textLines[a]),"</tspan>\n")},_setSVGTextLineJustifed:function(a,e,f,g){var h=b.util.createCanvasElement().getContext("2d");this._setTextStyles(h);var o,q,i=this._textLines[a],j=i.split(/\s+/),k=this._getWidthOfWords(h,j.join("")),l=this.width-k,m=j.length-1,n=m>0?l/m:0,p=this._getFillAttributes(this.fill);for(g+=this._getLineLeftOffset(this._getLineWidth(h,a)),a=0,q=j.length;a<q;a++)o=j[a],e.push('			<tspan x="',c(g,d),'" ','y="',c(f,d),'" ',p,">",b.util.string.escapeXml(o),"</tspan>\n"),g+=this._getWidthOfWords(h,o)+n},_setSVGTextLineBg:function(a,b,e,f,g){a.push("		<rect ",this._getFillAttributes(this.textBackgroundColor),' x="',c(e+this._getLineLeftOffset(this._getLineWidth(this.ctx,b)),d),'" y="',c(g-this.height/2,d),'" width="',c(this._getLineWidth(this.ctx,b),d),'" height="',c(this._getHeightOfLine(this.ctx,b)/this.lineHeight,d),'"></rect>\n')},_setSVGBg:function(a){this.backgroundColor&&a.push("		<rect ",this._getFillAttributes(this.backgroundColor),' x="',c(-this.width/2,d),'" y="',c(-this.height/2,d),'" width="',c(this.width,d),'" height="',c(this.height,d),'"></rect>\n')},_getFillAttributes:function(a){var c=a&&"string"===typeof a?new b.Color(a):"";return c&&c.getSource()&&1!==c.getAlpha()?'opacity="'+c.getAlpha()+'" fill="'+c.setAlpha(1).toRgb()+'"':'fill="'+a+'"'},_set:function(a,b){this.callSuper("_set",a,b),this._dimensionAffectingProps.indexOf(a)>-1&&(this._initDimensions(),this.setCoords())},complexity:function(){return 1}}),b.Text.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size text-decoration text-anchor".split(" ")),b.Text.DEFAULT_SVG_FONT_SIZE=16,b.Text.fromElement=function(a,c){if(!a)return null;var d=b.parseAttributes(a,b.Text.ATTRIBUTE_NAMES);c=b.util.object.extend(c?b.util.object.clone(c):{},d),c.top=c.top||0,c.left=c.left||0,"dx"in d&&(c.left+=d.dx),"dy"in d&&(c.top+=d.dy),"fontSize"in c||(c.fontSize=b.Text.DEFAULT_SVG_FONT_SIZE),c.originX||(c.originX="left");var e="";"textContent"in a?e=a.textContent:"firstChild"in a&&null!==a.firstChild&&"data"in a.firstChild&&null!==a.firstChild.data&&(e=a.firstChild.data),e=e.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var f=new b.Text(e,c),g=f.getHeight()/f.height,h=(f.height+f.strokeWidth)*f.lineHeight-f.height,i=h*g,j=f.getHeight()+i,k=0;return"left"===f.originX&&(k=f.getWidth()/2),"right"===f.originX&&(k=-f.getWidth()/2),f.set({left:f.getLeft()+k,top:f.getTop()-j/2+f.fontSize*(.18+f._fontSizeFraction)/f.lineHeight}),f},b.Text.fromObject=function(a,c,d){return b.Object._fromObject("Text",a,c,d,"text")},b.util.createAccessors(b.Text)}("undefined"!==typeof exports?exports:this),function(){var a=fabric.util.object.clone;fabric.IText=fabric.util.createClass(fabric.Text,fabric.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"#333",cursorDelay:1e3,cursorDuration:600,styles:null,caching:!0,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],initialize:function(a,b){this.styles=b?b.styles||{}:{},this.callSuper("initialize",a,b),this.initBehavior()},_clearCache:function(){this.callSuper("_clearCache"),this.__widthOfSpace=[]},isEmptyStyles:function(){if(!this.styles)return!0;var a=this.styles;for(var b in a)for(var c in a[b])for(var d in a[b][c])return!1;return!0},setSelectionStart:function(a){a=Math.max(a,0),this._updateAndFire("selectionStart",a)},setSelectionEnd:function(a){a=Math.min(a,this.text.length),this._updateAndFire("selectionEnd",a)},_updateAndFire:function(a,b){this[a]!==b&&(this._fireSelectionChanged(),this[a]=b),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},getSelectionStyles:function(a,b){if(2===arguments.length){for(var c=[],d=a;d<b;d++)c.push(this.getSelectionStyles(d));return c}var e=this.get2DCursorLocation(a),f=this._getStyleDeclaration(e.lineIndex,e.charIndex);return f||{}},setSelectionStyles:function(a){if(this.selectionStart===this.selectionEnd)this._extendStyles(this.selectionStart,a);else for(var b=this.selectionStart;b<this.selectionEnd;b++)this._extendStyles(b,a);return this._forceClearCache=!0,this},_extendStyles:function(a,b){var c=this.get2DCursorLocation(a);this._getLineStyle(c.lineIndex)||this._setLineStyle(c.lineIndex,{}),this._getStyleDeclaration(c.lineIndex,c.charIndex)||this._setStyleDeclaration(c.lineIndex,c.charIndex,{}),fabric.util.object.extend(this._getStyleDeclaration(c.lineIndex,c.charIndex),b)},_initDimensions:function(a){a||this.clearContextTop(),this.callSuper("_initDimensions",a)},render:function(a,b){this.clearContextTop(),this.callSuper("render",a,b),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(a){this.callSuper("_render",a),this.ctx=a},clearContextTop:function(){if(this.active&&this.isEditing&&this.canvas&&this.canvas.contextTop){var a=this.canvas.contextTop;a.save(),a.transform.apply(a,this.canvas.viewportTransform),this.transform(a),this.transformMatrix&&a.transform.apply(a,this.transformMatrix),this._clearTextArea(a),a.restore()}},renderCursorOrSelection:function(){if(this.active&&this.isEditing){var b,c,a=this.text.split("");this.canvas&&this.canvas.contextTop?(c=this.canvas.contextTop,c.save(),c.transform.apply(c,this.canvas.viewportTransform),this.transform(c),this.transformMatrix&&c.transform.apply(c,this.transformMatrix),this._clearTextArea(c)):(c=this.ctx,c.save()),this.selectionStart===this.selectionEnd?(b=this._getCursorBoundaries(a,"cursor"),this.renderCursor(b,c)):(b=this._getCursorBoundaries(a,"selection"),this.renderSelection(a,b,c)),c.restore()}},_clearTextArea:function(a){var b=this.width+4,c=this.height+4;a.clearRect(-b/2,-c/2,b,c)},get2DCursorLocation:function(a){"undefined"===typeof a&&(a=this.selectionStart);for(var b=this._textLines.length,c=0;c<b;c++){if(a<=this._textLines[c].length)return{lineIndex:c,charIndex:a};a-=this._textLines[c].length+1}return{lineIndex:c-1,charIndex:this._textLines[c-1].length<a?this._textLines[c-1].length:a}},getCurrentCharStyle:function(a,b){var c=this._getStyleDeclaration(a,0===b?0:b-1);return{fontSize:c&&c.fontSize||this.fontSize,fill:c&&c.fill||this.fill,textBackgroundColor:c&&c.textBackgroundColor||this.textBackgroundColor,textDecoration:c&&c.textDecoration||this.textDecoration,fontFamily:c&&c.fontFamily||this.fontFamily,fontWeight:c&&c.fontWeight||this.fontWeight,fontStyle:c&&c.fontStyle||this.fontStyle,stroke:c&&c.stroke||this.stroke,strokeWidth:c&&c.strokeWidth||this.strokeWidth}},getCurrentCharFontSize:function(a,b){var c=this._getStyleDeclaration(a,0===b?0:b-1);return c&&c.fontSize?c.fontSize:this.fontSize},getCurrentCharColor:function(a,b){var c=this._getStyleDeclaration(a,0===b?0:b-1);return c&&c.fill?c.fill:this.cursorColor},_getCursorBoundaries:function(a,b){var c=Math.round(this._getLeftOffset()),d=this._getTopOffset(),e=this._getCursorBoundariesOffsets(a,b);return{left:c,top:d,leftOffset:e.left+e.lineLeft,topOffset:e.top}},_getCursorBoundariesOffsets:function(a,b){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;for(var h,c=0,d=0,e=0,f=0,g=0,i=0;i<this.selectionStart;i++)"\n"===a[i]?(g=0,f+=this._getHeightOfLine(this.ctx,d),d++,e=0):(g+=this._getWidthOfChar(this.ctx,a[i],d,e),e++),c=this._getLineLeftOffset(this._getLineWidth(this.ctx,d));return"cursor"===b&&(f+=(1-this._fontSizeFraction)*this._getHeightOfLine(this.ctx,d)/this.lineHeight-this.getCurrentCharFontSize(d,e)*(1-this._fontSizeFraction)),0!==this.charSpacing&&e===this._textLines[d].length&&(g-=this._getWidthOfCharSpacing()),h={top:f,left:g>0?g:0,lineLeft:c},this.cursorOffsetCache=h,this.cursorOffsetCache},renderCursor:function(a,b){var c=this.get2DCursorLocation(),d=c.lineIndex,e=c.charIndex,f=this.getCurrentCharFontSize(d,e),g=a.leftOffset,h=this.scaleX*this.canvas.getZoom(),i=this.cursorWidth/h;b.fillStyle=this.getCurrentCharColor(d,e),b.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,b.fillRect(a.left+g-i/2,a.top+a.topOffset,i,f)},renderSelection:function(a,b,c){c.fillStyle=this.selectionColor;for(var d=this.get2DCursorLocation(this.selectionStart),e=this.get2DCursorLocation(this.selectionEnd),f=d.lineIndex,g=e.lineIndex,h=f;h<=g;h++){var i=this._getLineLeftOffset(this._getLineWidth(c,h))||0,j=this._getHeightOfLine(this.ctx,h),k=0,l=0,m=this._textLines[h];if(h===f){for(var n=0,o=m.length;n<o;n++)n>=d.charIndex&&(h!==g||n<e.charIndex)&&(l+=this._getWidthOfChar(c,m[n],h,n)),n<d.charIndex&&(i+=this._getWidthOfChar(c,m[n],h,n));n===m.length&&(l-=this._getWidthOfCharSpacing())}else if(h>f&&h<g)l+=this._getLineWidth(c,h)||5;else if(h===g){for(var p=0,q=e.charIndex;p<q;p++)l+=this._getWidthOfChar(c,m[p],h,p);e.charIndex===m.length&&(l-=this._getWidthOfCharSpacing())}k=j,(this.lineHeight<1||h===g&&this.lineHeight>1)&&(j/=this.lineHeight),c.fillRect(b.left+i,b.top+b.topOffset,l>0?l:0,j),b.topOffset+=k}},_renderChars:function(a,b,c,d,e,f,g){if(this.isEmptyStyles())return this._renderCharsFast(a,b,c,d,e);g=g||0;var i,j,h=this._getHeightOfLine(b,f),k="";b.save(),e-=h/this.lineHeight*this._fontSizeFraction;for(var l=g,m=c.length+g;l<=m;l++)i=i||this.getCurrentCharStyle(f,l),j=this.getCurrentCharStyle(f,l+1),(this._hasStyleChanged(i,j)||l===m)&&(this._renderChar(a,b,f,l-1,k,d,e,h),k="",i=j),k+=c[l-g];b.restore()},_renderCharsFast:function(a,b,c,d,e){"fillText"===a&&this.fill&&this.callSuper("_renderChars",a,b,c,d,e),"strokeText"===a&&(this.stroke&&this.strokeWidth>0||this.skipFillStrokeCheck)&&this.callSuper("_renderChars",a,b,c,d,e)},_renderChar:function(a,b,c,d,e,f,g,h){var i,j,k,l,n,o,p,q,r,m=this._getStyleDeclaration(c,d);if(m?(j=this._getHeightOfChar(b,e,c,d),l=m.stroke,k=m.fill,o=m.textDecoration):j=this.fontSize,l=(l||this.stroke)&&"strokeText"===a,k=(k||this.fill)&&"fillText"===a,m&&b.save(),i=this._applyCharStylesGetWidth(b,e,c,d,m||null),o=o||this.textDecoration,m&&m.textBackgroundColor&&this._removeShadow(b),0!==this.charSpacing){q=this._getWidthOfCharSpacing(),p=e.split(""),i=0;for(var u,s=0,t=p.length;s<t;s++)u=p[s],k&&b.fillText(u,f+i,g),l&&b.strokeText(u,f+i,g),r=b.measureText(u).width+q,i+=r>0?r:0}else k&&b.fillText(e,f,g),l&&b.strokeText(e,f,g);(o||""!==o)&&(n=this._fontSizeFraction*h/this.lineHeight,this._renderCharDecoration(b,o,f,g,n,i,j)),m&&b.restore(),b.translate(i,0)},_hasStyleChanged:function(a,b){return a.fill!==b.fill||a.fontSize!==b.fontSize||a.textBackgroundColor!==b.textBackgroundColor||a.textDecoration!==b.textDecoration||a.fontFamily!==b.fontFamily||a.fontWeight!==b.fontWeight||a.fontStyle!==b.fontStyle||a.stroke!==b.stroke||a.strokeWidth!==b.strokeWidth},_renderCharDecoration:function(a,b,c,d,e,f,g){if(b){var k,l,h=g/15,i={underline:d+g/10,"line-through":d-g*(this._fontSizeFraction+this._fontSizeMult-1)+h,overline:d-(this._fontSizeMult-this._fontSizeFraction)*g},j=["underline","line-through","overline"];for(k=0;k<j.length;k++)l=j[k],b.indexOf(l)>-1&&a.fillRect(c,i[l],f,h)}},_renderTextLine:function(a,b,c,d,e,f){this.isEmptyStyles()||(e+=this.fontSize*(this._fontSizeFraction+.03)),this.callSuper("_renderTextLine",a,b,c,d,e,f)},_renderTextDecoration:function(a){return this.isEmptyStyles()?this.callSuper("_renderTextDecoration",a):void 0},_renderTextLinesBackground:function(a){this.callSuper("_renderTextLinesBackground",a);var c,d,e,i,j,k,l,m,n,o,b=0,f=this._getLeftOffset(),g=this._getTopOffset(),h="";a.save();for(var p=0,q=this._textLines.length;p<q;p++)if(c=this._getHeightOfLine(a,p),i=this._textLines[p],""!==i&&this.styles&&this._getLineStyle(p)){d=this._getLineWidth(a,p),e=this._getLineLeftOffset(d),l=m=n=o=0;for(var r=0,s=i.length;r<s;r++)k=this._getStyleDeclaration(p,r)||{},h!==k.textBackgroundColor&&(o&&n&&(a.fillStyle=h,a.fillRect(l,m,n,o)),l=m=n=o=0,h=k.textBackgroundColor||""),k.textBackgroundColor?(j=i[r],h===k.textBackgroundColor&&(h=k.textBackgroundColor,l||(l=f+e+this._getWidthOfCharsAt(a,p,r)),m=g+b,n+=this._getWidthOfChar(a,j,p,r),o=c/this.lineHeight)):h="";o&&n&&(a.fillStyle=h,a.fillRect(l,m,n,o),l=m=n=o=0),b+=c}else b+=c;a.restore()},_getCacheProp:function(a,b){return a+b.fontSize+b.fontWeight+b.fontStyle},_getFontCache:function(a){return fabric.charWidthsCache[a]||(fabric.charWidthsCache[a]={}),fabric.charWidthsCache[a]},_applyCharStylesGetWidth:function(b,c,d,e,f){var i,j,k,g=f||this._getStyleDeclaration(d,e),h=a(g);if(this._applyFontStyles(h),k=this._getFontCache(h.fontFamily),j=this._getCacheProp(c,h),!g&&k[j]&&this.caching)return k[j];"string"===typeof h.shadow&&(h.shadow=new fabric.Shadow(h.shadow));var l=h.fill||this.fill;return b.fillStyle=l.toLive?l.toLive(b,this):l,h.stroke&&(b.strokeStyle=h.stroke&&h.stroke.toLive?h.stroke.toLive(b,this):h.stroke),b.lineWidth=h.strokeWidth||this.strokeWidth,b.font=this._getFontDeclaration.call(h),h.shadow&&(h.scaleX=this.scaleX,h.scaleY=this.scaleY,h.canvas=this.canvas,h.getObjectScaling=this.getObjectScaling,this._setShadow.call(h,b)),this.caching&&k[j]?k[j]:(i=b.measureText(c).width,this.caching&&(k[j]=i),i)},_applyFontStyles:function(a){a.fontFamily||(a.fontFamily=this.fontFamily),a.fontSize||(a.fontSize=this.fontSize),a.fontWeight||(a.fontWeight=this.fontWeight),a.fontStyle||(a.fontStyle=this.fontStyle)},_getStyleDeclaration:function(b,c,d){return d?this.styles[b]&&this.styles[b][c]?a(this.styles[b][c]):{}:this.styles[b]&&this.styles[b][c]?this.styles[b][c]:null},_setStyleDeclaration:function(a,b,c){this.styles[a][b]=c},_deleteStyleDeclaration:function(a,b){delete this.styles[a][b]},_getLineStyle:function(a){return this.styles[a]},_setLineStyle:function(a,b){this.styles[a]=b},_deleteLineStyle:function(a){delete this.styles[a]},_getWidthOfChar:function(a,b,c,d){if(!this._isMeasuring&&"justify"===this.textAlign&&this._reSpacesAndTabs.test(b))return this._getWidthOfSpace(a,c);a.save();var e=this._applyCharStylesGetWidth(a,b,c,d);return 0!==this.charSpacing&&(e+=this._getWidthOfCharSpacing()),a.restore(),e>0?e:0},_getHeightOfChar:function(a,b,c){var d=this._getStyleDeclaration(b,c);return d&&d.fontSize?d.fontSize:this.fontSize},_getWidthOfCharsAt:function(a,b,c){var e,f,d=0;for(e=0;e<c;e++)f=this._textLines[b][e],d+=this._getWidthOfChar(a,f,b,e);return d},_measureLine:function(a,b){this._isMeasuring=!0;var c=this._getWidthOfCharsAt(a,b,this._textLines[b].length);return 0!==this.charSpacing&&(c-=this._getWidthOfCharSpacing()),this._isMeasuring=!1,c>0?c:0},_getWidthOfSpace:function(a,b){if(this.__widthOfSpace[b])return this.__widthOfSpace[b];var c=this._textLines[b],d=this._getWidthOfWords(a,c,b,0),e=this.width-d,f=c.length-c.replace(this._reSpacesAndTabs,"").length,g=Math.max(e/f,a.measureText(" ").width);return this.__widthOfSpace[b]=g,g},_getWidthOfWords:function(a,b,c,d){for(var e=0,f=0;f<b.length;f++){var g=b[f];g.match(/\s/)||(e+=this._getWidthOfChar(a,g,c,f+d))}return e},_getHeightOfLine:function(a,b){if(this.__lineHeights[b])return this.__lineHeights[b];for(var c=this._textLines[b],d=this._getHeightOfChar(a,b,0),e=1,f=c.length;e<f;e++){var g=this._getHeightOfChar(a,b,e);
g>d&&(d=g)}return this.__lineHeights[b]=d*this.lineHeight*this._fontSizeMult,this.__lineHeights[b]},_getTextHeight:function(a){for(var b,c=0,d=0,e=this._textLines.length;d<e;d++)b=this._getHeightOfLine(a,d),c+=d===e-1?b/this.lineHeight:b;return c},toObject:function(b){return fabric.util.object.extend(this.callSuper("toObject",b),{styles:a(this.styles,!0)})}}),fabric.IText.fromObject=function(a,b,c){return fabric.Object._fromObject("IText",a,b,c,"text")}}(),function(){var a=fabric.util.object.clone;fabric.util.object.extend(fabric.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing(),this.selected=!1,this.callSuper("onDeselect")},initAddedHandler:function(){var a=this;this.on("added",function(){var b=a.canvas;b&&(b._hasITextHandlers||(b._hasITextHandlers=!0,a._initCanvasHandlers(b)),b._iTextInstances=b._iTextInstances||[],b._iTextInstances.push(a))})},initRemovedHandler:function(){var a=this;this.on("removed",function(){var b=a.canvas;b&&(b._iTextInstances=b._iTextInstances||[],fabric.util.removeFromArray(b._iTextInstances,a),0===b._iTextInstances.length&&(b._hasITextHandlers=!1,a._removeCanvasHandlers(b)))})},_initCanvasHandlers:function(a){a._mouseUpITextHandler=function(){a._iTextInstances&&a._iTextInstances.forEach(function(a){a.__isMousedown=!1})}.bind(this),a.on("mouse:up",a._mouseUpITextHandler)},_removeCanvasHandlers:function(a){a.off("mouse:up",a._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(a,b,c,d){var e;return e={isAborted:!1,abort:function(){this.isAborted=!0}},a.animate("_currentCursorOpacity",b,{duration:c,onComplete:function(){e.isAborted||a[d]()},onChange:function(){a.canvas&&a.selectionStart===a.selectionEnd&&a.renderCursorOrSelection()},abort:function(){return e.isAborted}}),e},_onTickComplete:function(){var a=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){a._currentTickCompleteState=a._animateCursor(a,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(a){var b=this,c=a?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){b._tick()},c)},abortCursorAnimation:function(){var a=this._currentTickState||this._currentTickCompleteState;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,a&&this.canvas&&this.canvas.clearContext(this.canvas.contextTop||this.ctx)},selectAll:function(){this.selectionStart=0,this.selectionEnd=this.text.length,this._fireSelectionChanged(),this._updateTextarea()},getSelectedText:function(){return this.text.slice(this.selectionStart,this.selectionEnd)},findWordBoundaryLeft:function(a){var b=0,c=a-1;if(this._reSpace.test(this.text.charAt(c)))for(;this._reSpace.test(this.text.charAt(c));)b++,c--;for(;/\S/.test(this.text.charAt(c))&&c>-1;)b++,c--;return a-b},findWordBoundaryRight:function(a){var b=0,c=a;if(this._reSpace.test(this.text.charAt(c)))for(;this._reSpace.test(this.text.charAt(c));)b++,c++;for(;/\S/.test(this.text.charAt(c))&&c<this.text.length;)b++,c++;return a+b},findLineBoundaryLeft:function(a){for(var b=0,c=a-1;!/\n/.test(this.text.charAt(c))&&c>-1;)b++,c--;return a-b},findLineBoundaryRight:function(a){for(var b=0,c=a;!/\n/.test(this.text.charAt(c))&&c<this.text.length;)b++,c++;return a+b},getNumNewLinesInSelectedText:function(){for(var a=this.getSelectedText(),b=0,c=0,d=a.length;c<d;c++)"\n"===a[c]&&b++;return b},searchWordBoundary:function(a,b){for(var c=this._reSpace.test(this.text.charAt(a))?a-1:a,d=this.text.charAt(c),e=/[ \n\.,;!\?\-]/;!e.test(d)&&c>0&&c<this.text.length;)c+=b,d=this.text.charAt(c);return e.test(d)&&"\n"!==d&&(c+=1===b?0:1),c},selectWord:function(a){a=a||this.selectionStart;var b=this.searchWordBoundary(a,-1),c=this.searchWordBoundary(a,1);this.selectionStart=b,this.selectionEnd=c,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(a){a=a||this.selectionStart;var b=this.findLineBoundaryLeft(a),c=this.findLineBoundaryRight(a);this.selectionStart=b,this.selectionEnd=c,this._fireSelectionChanged(),this._updateTextarea()},enterEditing:function(a){return!this.isEditing&&this.editable?(this.canvas&&this.exitEditingOnOthers(this.canvas),this.isEditing=!0,this.selected=!0,this.initHiddenTextarea(a),this.hiddenTextarea.focus(),this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.renderAll(),this):this):void 0},exitEditingOnOthers:function(a){a._iTextInstances&&a._iTextInstances.forEach(function(a){a.selected=!1,a.isEditing&&a.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(a){if(this.__isMousedown&&this.isEditing){var b=this.getSelectionStartFromPointer(a.e),c=this.selectionStart,d=this.selectionEnd;(b===this.__selectionStartOnMouseDown&&c!==d||c!==b&&d!==b)&&(b>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=b):(this.selectionStart=b,this.selectionEnd=this.__selectionStartOnMouseDown),(this.selectionStart!==c||this.selectionEnd!==d)&&(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},_updateTextarea:function(){if(this.hiddenTextarea&&!this.inCompositionMode&&(this.cursorOffsetCache={},this.hiddenTextarea.value=this.text,this.hiddenTextarea.selectionStart=this.selectionStart,this.hiddenTextarea.selectionEnd=this.selectionEnd,this.selectionStart===this.selectionEnd)){var a=this._calcTextareaPosition();this.hiddenTextarea.style.left=a.left,this.hiddenTextarea.style.top=a.top,this.hiddenTextarea.style.fontSize=a.fontSize}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var a=this.text.split(""),b=this._getCursorBoundaries(a,"cursor"),c=this.get2DCursorLocation(),d=c.lineIndex,e=c.charIndex,f=this.getCurrentCharFontSize(d,e),g=b.leftOffset,h=this.calcTransformMatrix(),i={x:b.left+g,y:b.top+b.topOffset+f},j=this.canvas.upperCanvasEl,k=j.width-f,l=j.height-f;return i=fabric.util.transformPoint(i,h),i=fabric.util.transformPoint(i,this.canvas.viewportTransform),i.x<0&&(i.x=0),i.x>k&&(i.x=k),i.y<0&&(i.y=0),i.y>l&&(i.y=l),i.x+=this.canvas._offset.left,i.y+=this.canvas._offset.top,{left:i.x+"px",top:i.y+"px",fontSize:f}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.overCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var a=this._textBeforeEdit!==this.text;return this.selected=!1,this.isEditing=!1,this.selectable=!0,this.selectionEnd=this.selectionStart,this.hiddenTextarea&&(this.hiddenTextarea.blur&&this.hiddenTextarea.blur(),this.canvas&&this.hiddenTextarea.parentNode.removeChild(this.hiddenTextarea),this.hiddenTextarea=null),this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this.fire("editing:exited"),a&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),a&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var a in this.styles)this._textLines[a]||delete this.styles[a]},_removeCharsFromTo:function(a,b){for(;b!==a;)this._removeSingleCharAndStyle(a+1),b--;this.selectionStart=a,this.selectionEnd=a},_removeSingleCharAndStyle:function(a){var b="\n"===this.text[a-1],c=b?a:a-1;this.removeStyleObject(b,c),this.text=this.text.slice(0,a-1)+this.text.slice(a),this._textLines=this._splitTextIntoLines()},insertChars:function(a,b){var c;if(this.selectionEnd-this.selectionStart>1&&this._removeCharsFromTo(this.selectionStart,this.selectionEnd),!b&&this.isEmptyStyles())return void this.insertChar(a,!1);for(var d=0,e=a.length;d<e;d++)b&&(c=fabric.util.object.clone(fabric.copiedTextStyle[d],!0)),this.insertChar(a[d],d<e-1,c)},insertChar:function(a,b,c){var d="\n"===this.text[this.selectionStart];this.text=this.text.slice(0,this.selectionStart)+a+this.text.slice(this.selectionEnd),this._textLines=this._splitTextIntoLines(),this.insertStyleObjects(a,d,c),this.selectionStart+=a.length,this.selectionEnd=this.selectionStart,b||(this._updateTextarea(),this.setCoords(),this._fireSelectionChanged(),this.fire("changed"),this.restartCursorIfNeeded(),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.renderAll()))},restartCursorIfNeeded:function(){(!this._currentTickState||this._currentTickState.isAborted||!this._currentTickCompleteState||this._currentTickCompleteState.isAborted)&&this.initDelayedCursor()},insertNewlineStyleObject:function(b,c,d){this.shiftLineStyles(b,1);var e={},f={};if(this.styles[b]&&this.styles[b][c-1]&&(e=this.styles[b][c-1]),d&&e)f[0]=a(e),this.styles[b+1]=f;else{var g=!1;for(var h in this.styles[b]){var i=parseInt(h,10);i>=c&&(g=!0,f[i-c]=this.styles[b][h],delete this.styles[b][h])}g&&(this.styles[b+1]=f)}this._forceClearCache=!0},insertCharStyleObject:function(b,c,d){var e=this.styles[b],f=a(e);0!==c||d||(c=1);for(var g in f){var h=parseInt(g,10);h>=c&&(e[h+1]=f[h],f[h-1]||delete e[h])}var i=d||a(e[c-1]);i&&(this.styles[b][c]=i),this._forceClearCache=!0},insertStyleObjects:function(a,b,c){var d=this.get2DCursorLocation(),e=d.lineIndex,f=d.charIndex;this._getLineStyle(e)||this._setLineStyle(e,{}),"\n"===a?this.insertNewlineStyleObject(e,f,b):this.insertCharStyleObject(e,f,c)},shiftLineStyles:function(b,c){var d=a(this.styles);for(var e in d){var f=parseInt(e,10);f<=b&&delete d[f]}for(var e in this.styles){var f=parseInt(e,10);f>b&&(this.styles[f+c]=d[f],d[f-c]||delete this.styles[f])}},removeStyleObject:function(a,b){var c=this.get2DCursorLocation(b),d=c.lineIndex,e=c.charIndex;this._removeStyleObject(a,c,d,e)},_getTextOnPreviousLine:function(a){return this._textLines[a-1]},_removeStyleObject:function(b,c,d,e){if(b){var f=this._getTextOnPreviousLine(c.lineIndex),g=f?f.length:0;this.styles[d-1]||(this.styles[d-1]={});for(e in this.styles[d])this.styles[d-1][parseInt(e,10)+g]=this.styles[d][e];this.shiftLineStyles(c.lineIndex,-1)}else{var h=this.styles[d];h&&delete h[e];var i=a(h);for(var j in i){var k=parseInt(j,10);k>=e&&0!==k&&(h[k-1]=i[k],delete h[k])}}},insertNewline:function(){this.insertChars("\n")},setSelectionStartEndWithShift:function(a,b,c){c<=a?(b===a?this._selectionDirection="left":"right"===this._selectionDirection&&(this._selectionDirection="left",this.selectionEnd=a),this.selectionStart=c):c>a&&c<b?"right"===this._selectionDirection?this.selectionEnd=c:this.selectionStart=c:(b===a?this._selectionDirection="right":"left"===this._selectionDirection&&(this._selectionDirection="right",this.selectionStart=b),this.selectionEnd=c)},setSelectionInBoundaries:function(){var a=this.text.length;this.selectionStart>a?this.selectionStart=a:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>a?this.selectionEnd=a:this.selectionEnd<0&&(this.selectionEnd=0)}})}(),fabric.util.object.extend(fabric.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown.bind(this))},onMouseDown:function(a){this.__newClickTime=+new Date;var b=this.canvas.getPointer(a.e);this.isTripleClick(b,a.e)?(this.fire("tripleclick",a),this._stopEvent(a.e)):this.isDoubleClick(b)&&(this.fire("dblclick",a),this._stopEvent(a.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=b,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected},isDoubleClick:function(a){return this.__newClickTime-this.__lastClickTime<500&&this.__lastPointer.x===a.x&&this.__lastPointer.y===a.y&&this.__lastIsEditing},isTripleClick:function(a){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===a.x&&this.__lastPointer.y===a.y},_stopEvent:function(a){a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},initClicks:function(){this.on("dblclick",function(a){this.selectWord(this.getSelectionStartFromPointer(a.e))}),this.on("tripleclick",function(a){this.selectLine(this.getSelectionStartFromPointer(a.e))})},initMousedownHandler:function(){this.on("mousedown",function(a){if(this.editable&&(!a.e.button||1===a.e.button)){var b=this.canvas.getPointer(a.e);this.__mousedownX=b.x,this.__mousedownY=b.y,this.__isMousedown=!0,this.selected&&this.setCursorByClick(a.e),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection())}})},_isObjectMoved:function(a){var b=this.canvas.getPointer(a);return this.__mousedownX!==b.x||this.__mousedownY!==b.y},initMouseupHandler:function(){this.on("mouseup",function(a){this.__isMousedown=!1,!this.editable||this._isObjectMoved(a.e)||a.e.button&&1!==a.e.button||(this.__lastSelected&&!this.__corner&&(this.enterEditing(a.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()),this.selected=!0)})},setCursorByClick:function(a){var b=this.getSelectionStartFromPointer(a),c=this.selectionStart,d=this.selectionEnd;a.shiftKey?this.setSelectionStartEndWithShift(c,d,b):(this.selectionStart=b,this.selectionEnd=b),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(a){for(var g,h,b=this.getLocalPointer(a),c=0,d=0,e=0,f=0,i=0,j=this._textLines.length;i<j;i++){h=this._textLines[i],e+=this._getHeightOfLine(this.ctx,i)*this.scaleY;var k=this._getLineWidth(this.ctx,i),l=this._getLineLeftOffset(k);d=l*this.scaleX;for(var m=0,n=h.length;m<n;m++){if(c=d,d+=this._getWidthOfChar(this.ctx,h[m],i,this.flipX?n-m:m)*this.scaleX,!(e<=b.y||d<=b.x))return this._getNewSelectionStartFromOffset(b,c,d,f+i,n);f++}if(b.y<e)return this._getNewSelectionStartFromOffset(b,c,d,f+i-1,n)}return"undefined"===typeof g?this.text.length:void 0},_getNewSelectionStartFromOffset:function(a,b,c,d,e){var f=a.x-b,g=c-a.x,h=g>f?0:1,i=d+h;return this.flipX&&(i=e-i),i>this.text.length&&(i=this.text.length),i}}),fabric.util.object.extend(fabric.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=fabric.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off");var a=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="white-space: nowrap; position: absolute; top: "+a.top+"; left: "+a.left+"; opacity: 0; width: 1px; height: 1px; z-index: -999;",fabric.document.body.appendChild(this.hiddenTextarea),fabric.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),fabric.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),fabric.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),fabric.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),fabric.util.addListener(this.hiddenTextarea,"cut",this.cut.bind(this)),fabric.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),fabric.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),fabric.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),fabric.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(fabric.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},_keysMap:{8:"removeChars",9:"exitEditing",27:"exitEditing",13:"insertNewline",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown",46:"forwardDelete"},_ctrlKeysMapUp:{67:"copy",88:"cut"},_ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(a){if(this.isEditing){if(a.keyCode in this._keysMap)this[this._keysMap[a.keyCode]](a);else{if(!(a.keyCode in this._ctrlKeysMapDown&&(a.ctrlKey||a.metaKey)))return;this[this._ctrlKeysMapDown[a.keyCode]](a)}a.stopImmediatePropagation(),a.preventDefault(),a.keyCode>=33&&a.keyCode<=40?(this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.renderAll()}},onKeyUp:function(a){return!this.isEditing||this._copyDone?void(this._copyDone=!1):void(a.keyCode in this._ctrlKeysMapUp&&(a.ctrlKey||a.metaKey)&&(this[this._ctrlKeysMapUp[a.keyCode]](a),a.stopImmediatePropagation(),a.preventDefault(),this.canvas&&this.canvas.renderAll()))},onInput:function(a){if(this.isEditing&&!this.inCompositionMode){var f,g,h,b=this.selectionStart||0,c=this.selectionEnd||0,d=this.text.length,e=this.hiddenTextarea.value.length;e>d?(h="left"===this._selectionDirection?c:b,f=e-d,g=this.hiddenTextarea.value.slice(h,h+f)):(f=e-d+c-b,g=this.hiddenTextarea.value.slice(b,b+f)),this.insertChars(g),a.stopPropagation()}},onCompositionStart:function(){this.inCompositionMode=!0,this.prevCompositionLength=0,this.compositionStart=this.selectionStart},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(a){var b=a.data;this.selectionStart=this.compositionStart,this.selectionEnd=this.selectionEnd===this.selectionStart?this.compositionStart+this.prevCompositionLength:this.selectionEnd,this.insertChars(b,!1),this.prevCompositionLength=b.length},forwardDelete:function(a){if(this.selectionStart===this.selectionEnd){if(this.selectionStart===this.text.length)return;this.moveCursorRight(a)}this.removeChars(a)},copy:function(a){if(this.selectionStart!==this.selectionEnd){var b=this.getSelectedText(),c=this._getClipboardData(a);c&&c.setData("text",b),fabric.copiedText=b,fabric.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd),a.stopImmediatePropagation(),a.preventDefault(),this._copyDone=!0}},paste:function(a){var b=null,c=this._getClipboardData(a),d=!0;c?(b=c.getData("text").replace(/\r/g,""),fabric.copiedTextStyle&&fabric.copiedText===b||(d=!1)):b=fabric.copiedText,b&&this.insertChars(b,d),a.stopImmediatePropagation(),a.preventDefault()},cut:function(a){this.selectionStart!==this.selectionEnd&&(this.copy(a),this.removeChars(a))},_getClipboardData:function(a){return a&&a.clipboardData||fabric.window.clipboardData},_getWidthBeforeCursor:function(a,b){for(var f,c=this._textLines[a].slice(0,b),d=this._getLineWidth(this.ctx,a),e=this._getLineLeftOffset(d),g=0,h=c.length;g<h;g++)f=c[g],e+=this._getWidthOfChar(this.ctx,f,a,g);return e},getDownCursorOffset:function(a,b){var c=this._getSelectionForOffset(a,b),d=this.get2DCursorLocation(c),e=d.lineIndex;if(e===this._textLines.length-1||a.metaKey||34===a.keyCode)return this.text.length-c;var f=d.charIndex,g=this._getWidthBeforeCursor(e,f),h=this._getIndexOnLine(e+1,g),i=this._textLines[e].slice(f);return i.length+h+2},_getSelectionForOffset:function(a,b){return a.shiftKey&&this.selectionStart!==this.selectionEnd&&b?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(a,b){var c=this._getSelectionForOffset(a,b),d=this.get2DCursorLocation(c),e=d.lineIndex;if(0===e||a.metaKey||33===a.keyCode)return-c;var f=d.charIndex,g=this._getWidthBeforeCursor(e,f),h=this._getIndexOnLine(e-1,g),i=this._textLines[e].slice(0,f);return-this._textLines[e-1].length+h-i.length},_getIndexOnLine:function(a,b){for(var h,c=this._getLineWidth(this.ctx,a),d=this._textLines[a],e=this._getLineLeftOffset(c),f=e,g=0,i=0,j=d.length;i<j;i++){var k=d[i],l=this._getWidthOfChar(this.ctx,k,a,i);if(f+=l,f>b){h=!0;var m=f-l,n=f,o=Math.abs(m-b),p=Math.abs(n-b);g=p<o?i:i-1;break}}return h||(g=d.length-1),g},moveCursorDown:function(a){this.selectionStart>=this.text.length&&this.selectionEnd>=this.text.length||this._moveCursorUpOrDown("Down",a)},moveCursorUp:function(a){(0!==this.selectionStart||0!==this.selectionEnd)&&this._moveCursorUpOrDown("Up",a)},_moveCursorUpOrDown:function(a,b){var c="get"+a+"CursorOffset",d=this[c](b,"right"===this._selectionDirection);b.shiftKey?this.moveCursorWithShift(d):this.moveCursorWithoutShift(d),0!==d&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(a){var b="left"===this._selectionDirection?this.selectionStart+a:this.selectionEnd+a;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,b),0!==a},moveCursorWithoutShift:function(a){return a<0?(this.selectionStart+=a,this.selectionEnd=this.selectionStart):(this.selectionEnd+=a,this.selectionStart=this.selectionEnd),0!==a},moveCursorLeft:function(a){(0!==this.selectionStart||0!==this.selectionEnd)&&this._moveCursorLeftOrRight("Left",a)},_move:function(a,b,c){var d;if(a.altKey)d=this["findWordBoundary"+c](this[b]);else{if(!a.metaKey&&35!==a.keyCode&&36!==a.keyCode)return this[b]+="Left"===c?-1:1,!0;d=this["findLineBoundary"+c](this[b])}return void 0!==typeof d&&this[b]!==d?(this[b]=d,!0):void 0},_moveLeft:function(a,b){return this._move(a,b,"Left")},_moveRight:function(a,b){return this._move(a,b,"Right")},moveCursorLeftWithoutShift:function(a){var b=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&0!==this.selectionStart&&(b=this._moveLeft(a,"selectionStart")),this.selectionEnd=this.selectionStart,b},moveCursorLeftWithShift:function(a){return"right"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveLeft(a,"selectionEnd"):0!==this.selectionStart?(this._selectionDirection="left",this._moveLeft(a,"selectionStart")):void 0},moveCursorRight:function(a){this.selectionStart>=this.text.length&&this.selectionEnd>=this.text.length||this._moveCursorLeftOrRight("Right",a)},_moveCursorLeftOrRight:function(a,b){var c="moveCursor"+a+"With";this._currentCursorOpacity=1,c+=b.shiftKey?"Shift":"outShift",this[c](b)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(a){return"left"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveRight(a,"selectionStart"):this.selectionEnd!==this.text.length?(this._selectionDirection="right",this._moveRight(a,"selectionEnd")):void 0},moveCursorRightWithoutShift:function(a){var b=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(b=this._moveRight(a,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,b},removeChars:function(a){this.selectionStart===this.selectionEnd?this._removeCharsNearCursor(a):this._removeCharsFromTo(this.selectionStart,this.selectionEnd),this.set("dirty",!0),this.setSelectionEnd(this.selectionStart),this._removeExtraneousStyles(),this.canvas&&this.canvas.renderAll(),this.setCoords(),this.fire("changed"),this.canvas&&this.canvas.fire("text:changed",{target:this})},_removeCharsNearCursor:function(a){if(0!==this.selectionStart)if(a.metaKey){var b=this.findLineBoundaryLeft(this.selectionStart);this._removeCharsFromTo(b,this.selectionStart),this.setSelectionStart(b)}else if(a.altKey){var c=this.findWordBoundaryLeft(this.selectionStart);this._removeCharsFromTo(c,this.selectionStart),this.setSelectionStart(c)}else this._removeSingleCharAndStyle(this.selectionStart),this.setSelectionStart(this.selectionStart-1)}}),function(){var a=fabric.util.toFixed,b=fabric.Object.NUM_FRACTION_DIGITS;fabric.util.object.extend(fabric.IText.prototype,{_setSVGTextLineText:function(a,b,c,d,e,f){this._getLineStyle(a)?this._setSVGTextLineChars(a,b,c,d,f):fabric.Text.prototype._setSVGTextLineText.call(this,a,b,c,d,e)},_setSVGTextLineChars:function(a,b,c,d,e){for(var f=this._textLines[a],g=0,h=this._getLineLeftOffset(this._getLineWidth(this.ctx,a))-this.width/2,i=this._getSVGLineTopOffset(a),j=this._getHeightOfLine(this.ctx,a),k=0,l=f.length;k<l;k++){var m=this._getStyleDeclaration(a,k)||{};b.push(this._createTextCharSpan(f[k],m,h,i.lineTop+i.offset,g));var n=this._getWidthOfChar(this.ctx,f[k],a,k);m.textBackgroundColor&&e.push(this._createTextCharBg(m,h,i.lineTop,j,n,g)),g+=n}},_getSVGLineTopOffset:function(a){for(var b=0,c=0,d=0;d<a;d++)b+=this._getHeightOfLine(this.ctx,d);return c=this._getHeightOfLine(this.ctx,d),{lineTop:b,offset:(this._fontSizeMult-this._fontSizeFraction)*c/(this.lineHeight*this._fontSizeMult)}},_createTextCharBg:function(c,d,e,f,g,h){return['		<rect fill="',c.textBackgroundColor,'" x="',a(d+h,b),'" y="',a(e-this.height/2,b),'" width="',a(g,b),'" height="',a(f/this.lineHeight,b),'"></rect>\n'].join("")},_createTextCharSpan:function(c,d,e,f,g){var h=this.getSvgStyles.call(fabric.util.object.extend({visible:!0,fill:this.fill,stroke:this.stroke,type:"text",getSvgFilter:fabric.Object.prototype.getSvgFilter},d));return['			<tspan x="',a(e+g,b),'" y="',a(f-this.height/2,b),'" ',d.fontFamily?'font-family="'+d.fontFamily.replace(/"/g,"'")+'" ':"",d.fontSize?'font-size="'+d.fontSize+'" ':"",d.fontStyle?'font-style="'+d.fontStyle+'" ':"",d.fontWeight?'font-weight="'+d.fontWeight+'" ':"",d.textDecoration?'text-decoration="'+d.textDecoration+'" ':"",'style="',h,'">',fabric.util.string.escapeXml(c),"</tspan>\n"].join("")}})}(),function(a){"use strict";var b=a.fabric||(a.fabric={});b.Textbox=b.util.createClass(b.IText,b.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingY:!0,lockScalingFlip:!0,noScaleCache:!1,initialize:function(a,c){this.callSuper("initialize",a,c),this.setControlsVisibility(b.Textbox.getTextboxControlVisibility()),this.ctx=this.objectCaching?this._cacheContext:b.util.createCanvasElement().getContext("2d"),this._dimensionAffectingProps.push("width")},_initDimensions:function(a){this.__skipDimension||(a||(a=b.util.createCanvasElement().getContext("2d"),this._setTextStyles(a),this.clearContextTop()),this.dynamicMinWidth=0,this._textLines=this._splitTextIntoLines(a),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this._clearCache(),this.height=this._getTextHeight(a))},_generateStyleMap:function(){for(var a=0,b=0,c=0,d={},e=0;e<this._textLines.length;e++)"\n"===this.text[c]&&e>0?(b=0,c++,a++):" "===this.text[c]&&e>0&&(b++,c++),d[e]={line:a,offset:b},c+=this._textLines[e].length,b+=this._textLines[e].length;return d},_getStyleDeclaration:function(a,b,c){if(this._styleMap){var d=this._styleMap[a];if(!d)return c?{}:null;a=d.line,b=d.offset+b}return this.callSuper("_getStyleDeclaration",a,b,c)},_setStyleDeclaration:function(a,b,c){var d=this._styleMap[a];a=d.line,b=d.offset+b,this.styles[a][b]=c},_deleteStyleDeclaration:function(a,b){var c=this._styleMap[a];a=c.line,b=c.offset+b,delete this.styles[a][b]},_getLineStyle:function(a){var b=this._styleMap[a];return this.styles[b.line]},_setLineStyle:function(a,b){var c=this._styleMap[a];this.styles[c.line]=b},_deleteLineStyle:function(a){var b=this._styleMap[a];delete this.styles[b.line]},_wrapText:function(a,b){var e,c=b.split(this._reNewline),d=[];for(e=0;e<c.length;e++)d=d.concat(this._wrapLine(a,c[e],e));return d},_measureText:function(a,b,c,d){var e=0;d=d||0;for(var f=0,g=b.length;f<g;f++)e+=this._getWidthOfChar(a,b[f],c,f+d);return e},_wrapLine:function(a,b,c){for(var d=0,e=[],f="",g=b.split(" "),h="",i=0,j=" ",k=0,l=0,m=0,n=!0,o=this._getWidthOfCharSpacing(),p=0;p<g.length;p++)h=g[p],k=this._measureText(a,h,c,i),i+=h.length,d+=l+k-o,d>=this.width&&!n?(e.push(f),f="",d=k,n=!0):d+=o,n||(f+=j),f+=h,l=this._measureText(a,j,c,i),i++,n=!1,k>m&&(m=k);return p&&e.push(f),m>this.dynamicMinWidth&&(this.dynamicMinWidth=m-o),e},_splitTextIntoLines:function(a){a=a||this.ctx;var b=this.textAlign;this._styleMap=null,a.save(),this._setTextStyles(a),this.textAlign="left";var c=this._wrapText(a,this.text);return this.textAlign=b,a.restore(),this._textLines=c,this._styleMap=this._generateStyleMap(),c},setOnGroup:function(a,b){"scaleX"===a&&(this.set("scaleX",Math.abs(1/b)),this.set("width",this.get("width")*b/("undefined"===typeof this.__oldScaleX?1:this.__oldScaleX)),this.__oldScaleX=b)},get2DCursorLocation:function(a){"undefined"===typeof a&&(a=this.selectionStart);for(var b=this._textLines.length,c=0,d=0;d<b;d++){var e=this._textLines[d],f=e.length;if(a<=c+f)return{lineIndex:d,charIndex:a-c};c+=f,("\n"===this.text[c]||" "===this.text[c])&&c++}return{lineIndex:b-1,charIndex:this._textLines[b-1].length}},_getCursorBoundariesOffsets:function(a,b){for(var c=0,d=0,e=this.get2DCursorLocation(),f=this._textLines[e.lineIndex].split(""),g=this._getLineLeftOffset(this._getLineWidth(this.ctx,e.lineIndex)),h=0;h<e.charIndex;h++)d+=this._getWidthOfChar(this.ctx,f[h],e.lineIndex,h);for(h=0;h<e.lineIndex;h++)c+=this._getHeightOfLine(this.ctx,h);return"cursor"===b&&(c+=(1-this._fontSizeFraction)*this._getHeightOfLine(this.ctx,e.lineIndex)/this.lineHeight-this.getCurrentCharFontSize(e.lineIndex,e.charIndex)*(1-this._fontSizeFraction)),{top:c,left:d,lineLeft:g}},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},toObject:function(a){return this.callSuper("toObject",["minWidth"].concat(a))}}),b.Textbox.fromObject=function(a,c,d){return b.Object._fromObject("Textbox",a,c,d,"text")},b.Textbox.getTextboxControlVisibility=function(){return{tl:!1,tr:!1,br:!1,bl:!1,ml:!0,mt:!1,mr:!0,mb:!1,mtr:!0}}}("undefined"!==typeof exports?exports:this),function(){var a=fabric.Canvas.prototype._setObjectScale;fabric.Canvas.prototype._setObjectScale=function(b,c,d,e,f,g,h){var i=c.target;if(!(i instanceof fabric.Textbox))return a.call(fabric.Canvas.prototype,b,c,d,e,f,g,h);var j=i.width*(b.x/c.scaleX/(i.width+i.strokeWidth));return j>=i.getMinWidth()?(i.set("width",j),!0):void 0},fabric.Group.prototype._refreshControlsVisibility=function(){if("undefined"!==typeof fabric.Textbox)for(var a=this._objects.length;a--;)if(this._objects[a]instanceof fabric.Textbox)return void this.setControlsVisibility(fabric.Textbox.getTextboxControlVisibility())},fabric.util.object.extend(fabric.Textbox.prototype,{_removeExtraneousStyles:function(){for(var a in this._styleMap)this._textLines[a]||delete this.styles[this._styleMap[a].line]},insertCharStyleObject:function(a,b,c){var d=this._styleMap[a];a=d.line,b=d.offset+b,fabric.IText.prototype.insertCharStyleObject.apply(this,[a,b,c])},insertNewlineStyleObject:function(a,b,c){var d=this._styleMap[a];a=d.line,b=d.offset+b,fabric.IText.prototype.insertNewlineStyleObject.apply(this,[a,b,c])},shiftLineStyles:function(a,b){var c=this._styleMap[a];a=c.line,fabric.IText.prototype.shiftLineStyles.call(this,a,b)},_getTextOnPreviousLine:function(a){for(var b=this._textLines[a-1];this._styleMap[a-2]&&this._styleMap[a-2].line===this._styleMap[a-1].line;)b=this._textLines[a-2]+b,a--;
return b},removeStyleObject:function(a,b){var c=this.get2DCursorLocation(b),d=this._styleMap[c.lineIndex],e=d.line,f=d.offset+c.charIndex;this._removeStyleObject(a,c,e,f)}})}(),function(){var a=fabric.IText.prototype._getNewSelectionStartFromOffset;fabric.IText.prototype._getNewSelectionStartFromOffset=function(b,c,d,e,f){e=a.call(this,b,c,d,e,f);for(var g=0,h=0,i=0;i<this._textLines.length&&(g+=this._textLines[i].length,!(g+h>=e));i++)("\n"===this.text[g+h]||" "===this.text[g+h])&&h++;return e-i+h}}(),function(){function request(a,b,c){var d=URL.parse(a);d.port||(d.port=0===d.protocol.indexOf("https:")?443:80);var e=0===d.protocol.indexOf("https:")?HTTPS:HTTP,f=e.request({hostname:d.hostname,port:d.port,path:d.path,method:"GET"},function(a){var d="";b&&a.setEncoding(b),a.on("end",function(){c(d)}),a.on("data",function(b){200===a.statusCode&&(d+=b)})});f.on("error",function(a){fabric.log(a.errno===process.ECONNREFUSED?"ECONNREFUSED: connection refused to "+d.hostname+":"+d.port:a.message),c(null)}),f.end()}function requestFs(a,b){var c=require("fs");c.readFile(a,function(a,c){if(a)throw fabric.log(a),a;b(c)})}if("undefined"===typeof document||"undefined"===typeof window){var DOMParser=require("xmldom").DOMParser,URL=require("url"),HTTP=require("http"),HTTPS=require("https"),Canvas=require("canvas"),Image=require("canvas").Image;fabric.util.loadImage=function(a,b,c){function d(d){d?(e.src=new Buffer(d,"binary"),e._src=a,b&&b.call(c,e)):(e=null,b&&b.call(c,null,!0))}var e=new Image;a&&(a instanceof Buffer||0===a.indexOf("data"))?(e.src=e._src=a,b&&b.call(c,e)):a&&0!==a.indexOf("http")?requestFs(a,d):a?request(a,"binary",d):b&&b.call(c,a)},fabric.loadSVGFromURL=function(a,b,c){a=a.replace(/^\n\s*/,"").replace(/\?.*$/,"").trim(),0!==a.indexOf("http")?requestFs(a,function(a){fabric.loadSVGFromString(a.toString(),b,c)}):request(a,"",function(a){fabric.loadSVGFromString(a,b,c)})},fabric.loadSVGFromString=function(a,b,c){var d=(new DOMParser).parseFromString(a);fabric.parseSVGDocument(d.documentElement,function(a,c){b&&b(a,c)},c)},fabric.util.getScript=function(url,callback){request(url,"",function(body){eval(body),callback&&callback()})},fabric.createCanvasForNode=function(a,b,c,d){d=d||c;var e=fabric.document.createElement("canvas"),f=new Canvas(a||600,b||600,d),g=new Canvas(a||600,b||600,d);e.style={},e.width=f.width,e.height=f.height,c=c||{},c.nodeCanvas=f,c.nodeCacheCanvas=g;var h=fabric.Canvas||fabric.StaticCanvas,i=new h(e,c);return i.nodeCanvas=f,i.nodeCacheCanvas=g,i.contextContainer=f.getContext("2d"),i.contextCache=g.getContext("2d"),i.Font=Canvas.Font,i};var originaInitStatic=fabric.StaticCanvas.prototype._initStatic;fabric.StaticCanvas.prototype._initStatic=function(a,b){a=a||fabric.document.createElement("canvas"),this.nodeCanvas=new Canvas(a.width,a.height),this.nodeCacheCanvas=new Canvas(a.width,a.height),originaInitStatic.call(this,a,b),this.contextContainer=this.nodeCanvas.getContext("2d"),this.contextCache=this.nodeCacheCanvas.getContext("2d"),this.Font=Canvas.Font},fabric.StaticCanvas.prototype.createPNGStream=function(){return this.nodeCanvas.createPNGStream()},fabric.StaticCanvas.prototype.createJPEGStream=function(a){return this.nodeCanvas.createJPEGStream(a)},fabric.StaticCanvas.prototype._initRetinaScaling=function(){return this._isRetinaScaling()?(this.lowerCanvasEl.setAttribute("width",this.width*fabric.devicePixelRatio),this.lowerCanvasEl.setAttribute("height",this.height*fabric.devicePixelRatio),this.nodeCanvas.width=this.width*fabric.devicePixelRatio,this.nodeCanvas.height=this.height*fabric.devicePixelRatio,this.contextContainer.scale(fabric.devicePixelRatio,fabric.devicePixelRatio),this):void 0},fabric.Canvas&&(fabric.Canvas.prototype._initRetinaScaling=fabric.StaticCanvas.prototype._initRetinaScaling);var origSetBackstoreDimension=fabric.StaticCanvas.prototype._setBackstoreDimension;fabric.StaticCanvas.prototype._setBackstoreDimension=function(a,b){return origSetBackstoreDimension.call(this,a,b),this.nodeCanvas[a]=b,this},fabric.Canvas&&(fabric.Canvas.prototype._setBackstoreDimension=fabric.StaticCanvas.prototype._setBackstoreDimension)}}(),window.fabric=fabric,"function"===typeof define&&define.amd&&define([],function(){return fabric});